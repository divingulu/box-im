{"remainingRequest":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js!/home/d/github/box-im/im-web/node_modules/eslint-loader/index.js??ref--14-0!/home/d/github/box-im/im-web/src/api/webrtc.js","dependencies":[{"path":"/home/d/github/box-im/im-web/src/api/webrtc.js","mtime":1727013808912},{"path":"/home/d/github/box-im/im-web/babel.config.js","mtime":1727013808912},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js","mtime":1727014166227},{"path":"/home/d/github/box-im/im-web/node_modules/eslint-loader/index.js","mtime":1727014164203}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Y2xhc3MgSW1XZWJSdGMgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5jb25maWd1cmF0aW9uID0ge307CiAgICB0aGlzLnN0cmVhbSA9IG51bGw7CiAgfQp9CkltV2ViUnRjLnByb3RvdHlwZS5pc0VuYWJsZSA9IGZ1bmN0aW9uICgpIHsKICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gfHwgd2luZG93LndlYmtpdFJUQ1BlZXJDb25uZWN0aW9uIHx8IHdpbmRvdy5tb3pSVENQZWVyQ29ubmVjdGlvbjsKICB3aW5kb3cuUlRDU2Vzc2lvbkRlc2NyaXB0aW9uID0gd2luZG93LlJUQ1Nlc3Npb25EZXNjcmlwdGlvbiB8fCB3aW5kb3cud2Via2l0UlRDU2Vzc2lvbkRlc2NyaXB0aW9uIHx8IHdpbmRvdy5tb3pSVENTZXNzaW9uRGVzY3JpcHRpb247CiAgd2luZG93LlJUQ0ljZUNhbmRpZGF0ZSA9IHdpbmRvdy5SVENJY2VDYW5kaWRhdGUgfHwgd2luZG93LndlYmtpdFJUQ0ljZUNhbmRpZGF0ZSB8fCB3aW5kb3cubW96UlRDSWNlQ2FuZGlkYXRlOwogIHJldHVybiAhIXdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbjsKfTsKSW1XZWJSdGMucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoY29uZmlndXJhdGlvbikgewogIHRoaXMuY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247Cn07CkltV2ViUnRjLnByb3RvdHlwZS5zZXR1cFBlZXJDb25uZWN0aW9uID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgdGhpcy5wZWVyQ29ubmVjdGlvbiA9IG5ldyBSVENQZWVyQ29ubmVjdGlvbih0aGlzLmNvbmZpZ3VyYXRpb24pOwogIHRoaXMucGVlckNvbm5lY3Rpb24ub250cmFjayA9IGUgPT4gewogICAgLy8g5a+55pa555qE6KeG6aKR5rWBCiAgICBjYWxsYmFjayhlLnN0cmVhbXNbMF0pOwogIH07Cn07CkltV2ViUnRjLnByb3RvdHlwZS5zZXRTdHJlYW0gPSBmdW5jdGlvbiAoc3RyZWFtKSB7CiAgaWYgKHRoaXMuc3RyZWFtKSB7CiAgICB0aGlzLnBlZXJDb25uZWN0aW9uLnJlbW92ZVN0cmVhbSh0aGlzLnN0cmVhbSk7CiAgfQogIGlmIChzdHJlYW0pIHsKICAgIHN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKHRyYWNrID0+IHsKICAgICAgdGhpcy5wZWVyQ29ubmVjdGlvbi5hZGRUcmFjayh0cmFjaywgc3RyZWFtKTsKICAgIH0pOwogIH0KICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKfTsKSW1XZWJSdGMucHJvdG90eXBlLm9uSWNlY2FuZGlkYXRlID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgdGhpcy5wZWVyQ29ubmVjdGlvbi5vbmljZWNhbmRpZGF0ZSA9IGV2ZW50ID0+IHsKICAgIC8vIOi/vei4quWIsOWAmemAieS/oeaBrwogICAgaWYgKGV2ZW50LmNhbmRpZGF0ZSkgewogICAgICBjYWxsYmFjayhldmVudC5jYW5kaWRhdGUpOwogICAgfQogIH07Cn07CkltV2ViUnRjLnByb3RvdHlwZS5vblN0YXRlQ2hhbmdlID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgLy8g55uR5ZCs6L+e5o6l54q25oCBCiAgdGhpcy5wZWVyQ29ubmVjdGlvbi5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZSA9IGV2ZW50ID0+IHsKICAgIGxldCBzdGF0ZSA9IGV2ZW50LnRhcmdldC5pY2VDb25uZWN0aW9uU3RhdGU7CiAgICBjb25zb2xlLmxvZygiSUNF6L+e5o6l54q25oCB5Y+Y5YyWOiA6ICIgKyBzdGF0ZSk7CiAgICBjYWxsYmFjayhzdGF0ZSk7CiAgfTsKfTsKSW1XZWJSdGMucHJvdG90eXBlLmNyZWF0ZU9mZmVyID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICBjb25zdCBvZmZlclBhcmFtID0ge307CiAgICBvZmZlclBhcmFtLm9mZmVyVG9SZWNpZXZlQXVkaW8gPSAxOwogICAgb2ZmZXJQYXJhbS5vZmZlclRvUmVjaWV2ZVZpZGVvID0gMTsKICAgIC8vIOWIm+W7uuacrOWcsHNkcOS/oeaBrwogICAgdGhpcy5wZWVyQ29ubmVjdGlvbi5jcmVhdGVPZmZlcihvZmZlclBhcmFtKS50aGVuKG9mZmVyID0+IHsKICAgICAgLy8g6K6+572u5pys5Zywc2Rw5L+h5oGvCiAgICAgIHRoaXMucGVlckNvbm5lY3Rpb24uc2V0TG9jYWxEZXNjcmlwdGlvbihvZmZlcik7CiAgICAgIC8vIOWPkei1t+WRvOWPq+ivt+axggogICAgICByZXNvbHZlKG9mZmVyKTsKICAgIH0pLmNhdGNoKGUgPT4gewogICAgICByZWplY3QoZSk7CiAgICB9KTsKICB9KTsKfTsKSW1XZWJSdGMucHJvdG90eXBlLmNyZWF0ZUFuc3dlciA9IGZ1bmN0aW9uIChvZmZlcikgewogIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAvLyDorr7nva7ov5znq6/nmoRzZHAKICAgIHRoaXMuc2V0UmVtb3RlRGVzY3JpcHRpb24ob2ZmZXIpOwogICAgLy8g5Yib5bu65pys5ZywZHNwCiAgICBjb25zdCBvZmZlclBhcmFtID0ge307CiAgICBvZmZlclBhcmFtLm9mZmVyVG9SZWNpZXZlQXVkaW8gPSAxOwogICAgb2ZmZXJQYXJhbS5vZmZlclRvUmVjaWV2ZVZpZGVvID0gMTsKICAgIHRoaXMucGVlckNvbm5lY3Rpb24uY3JlYXRlQW5zd2VyKG9mZmVyUGFyYW0pLnRoZW4oYW5zd2VyID0+IHsKICAgICAgLy8g6K6+572u5pys5Zywc2Rw5L+h5oGvCiAgICAgIHRoaXMucGVlckNvbm5lY3Rpb24uc2V0TG9jYWxEZXNjcmlwdGlvbihhbnN3ZXIpOwogICAgICAvLyDmjqXlj5flkbzlj6vor7fmsYIKICAgICAgcmVzb2x2ZShhbnN3ZXIpOwogICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgIHJlamVjdChlKTsKICAgIH0pOwogIH0pOwp9OwpJbVdlYlJ0Yy5wcm90b3R5cGUuc2V0UmVtb3RlRGVzY3JpcHRpb24gPSBmdW5jdGlvbiAob2ZmZXIpIHsKICAvLyDorr7nva7lr7nmlrnnmoRzZHDkv6Hmga8KICB0aGlzLnBlZXJDb25uZWN0aW9uLnNldFJlbW90ZURlc2NyaXB0aW9uKG5ldyBSVENTZXNzaW9uRGVzY3JpcHRpb24ob2ZmZXIpKTsKfTsKSW1XZWJSdGMucHJvdG90eXBlLmFkZEljZUNhbmRpZGF0ZSA9IGZ1bmN0aW9uIChjYW5kaWRhdGUpIHsKICAvLyDmt7vliqDlr7nmlrnnmoTlgJnpgInkurrkv6Hmga8KICB0aGlzLnBlZXJDb25uZWN0aW9uLmFkZEljZUNhbmRpZGF0ZShuZXcgUlRDSWNlQ2FuZGlkYXRlKGNhbmRpZGF0ZSkpOwp9OwpJbVdlYlJ0Yy5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAodWlkKSB7CiAgLy8g5YWz6ZetUlRD6L+e5o6lCiAgaWYgKHRoaXMucGVlckNvbm5lY3Rpb24pIHsKICAgIHRoaXMucGVlckNvbm5lY3Rpb24uY2xvc2UoKTsKICAgIHRoaXMucGVlckNvbm5lY3Rpb24ub25pY2VjYW5kaWRhdGUgPSBudWxsOwogICAgdGhpcy5wZWVyQ29ubmVjdGlvbi5vbmFkZHN0cmVhbSA9IG51bGw7CiAgICB0aGlzLnBlZXJDb25uZWN0aW9uID0gbnVsbDsKICB9Cn07CmV4cG9ydCBkZWZhdWx0IEltV2ViUnRjOw=="},{"version":3,"names":["ImWebRtc","constructor","configuration","stream","prototype","isEnable","window","RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCSessionDescription","webkitRTCSessionDescription","mozRTCSessionDescription","RTCIceCandidate","webkitRTCIceCandidate","mozRTCIceCandidate","init","setupPeerConnection","callback","peerConnection","ontrack","e","streams","setStream","removeStream","getTracks","forEach","track","addTrack","onIcecandidate","onicecandidate","event","candidate","onStateChange","oniceconnectionstatechange","state","target","iceConnectionState","console","log","createOffer","Promise","resolve","reject","offerParam","offerToRecieveAudio","offerToRecieveVideo","then","offer","setLocalDescription","catch","createAnswer","setRemoteDescription","answer","addIceCandidate","close","uid","onaddstream"],"sources":["/home/d/github/box-im/im-web/src/api/webrtc.js"],"sourcesContent":["\nclass ImWebRtc {\n\tconstructor() {\n\t\tthis.configuration = {}\n\t\tthis.stream = null;\n\t}\n}\n\nImWebRtc.prototype.isEnable = function() {\n\twindow.RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection || window\n\t\t.mozRTCPeerConnection;\n\twindow.RTCSessionDescription = window.RTCSessionDescription || window.webkitRTCSessionDescription || window\n\t\t.mozRTCSessionDescription;\n\twindow.RTCIceCandidate = window.RTCIceCandidate || window.webkitRTCIceCandidate || window\n\t\t.mozRTCIceCandidate;\n\treturn !!window.RTCPeerConnection;\n}\n\nImWebRtc.prototype.init = function(configuration) {\n\tthis.configuration = configuration;\n}\n\nImWebRtc.prototype.setupPeerConnection = function(callback) {\n\tthis.peerConnection = new RTCPeerConnection(this.configuration);\n\tthis.peerConnection.ontrack = (e) => {\n\t\t// 对方的视频流\n\t\tcallback(e.streams[0]);\n\t};\n}\n\n\nImWebRtc.prototype.setStream = function(stream) {\n\tif(this.stream){\n\t\tthis.peerConnection.removeStream(this.stream)\n\t}\n\tif(stream){\n\t\tstream.getTracks().forEach((track) => {\n\t\t\tthis.peerConnection.addTrack(track, stream);\n\t\t});\n\t}\n\tthis.stream = stream;\n}\n\n\nImWebRtc.prototype.onIcecandidate = function(callback) {\n\tthis.peerConnection.onicecandidate = (event) => {\n\t\t// 追踪到候选信息\n\t\tif (event.candidate) {\n\t\t\tcallback(event.candidate)\n\t\t}\n\t}\n}\n\nImWebRtc.prototype.onStateChange = function(callback) {\n\t// 监听连接状态\n\tthis.peerConnection.oniceconnectionstatechange = (event) => {\n\t\tlet state = event.target.iceConnectionState;\n\t\tconsole.log(\"ICE连接状态变化: : \" + state)\n\t\tcallback(state)\n\t};\n}\n\nImWebRtc.prototype.createOffer = function() {\n\treturn new Promise((resolve, reject) => {\n\t\tconst offerParam = {};\n\t\tofferParam.offerToRecieveAudio = 1;\n\t\tofferParam.offerToRecieveVideo = 1;\n\t\t// 创建本地sdp信息\n\t\tthis.peerConnection.createOffer(offerParam).then((offer) => {\n\t\t\t// 设置本地sdp信息\n\t\t\tthis.peerConnection.setLocalDescription(offer);\n\t\t\t// 发起呼叫请求\n\t\t\tresolve(offer)\n\t\t}).catch((e) => {\n\t\t\treject(e)\n\t\t})\n\t});\n}\n\n\nImWebRtc.prototype.createAnswer = function(offer) {\n\treturn new Promise((resolve, reject) => {\n\t\t// 设置远端的sdp\n\t\tthis.setRemoteDescription(offer);\n\t\t// 创建本地dsp\n\t\tconst offerParam = {};\n\t\tofferParam.offerToRecieveAudio = 1;\n\t\tofferParam.offerToRecieveVideo = 1;\n\t\tthis.peerConnection.createAnswer(offerParam).then((answer) => {\n\t\t\t// 设置本地sdp信息\n\t\t\tthis.peerConnection.setLocalDescription(answer);\n\t\t\t// 接受呼叫请求\n\t\t\tresolve(answer)\n\t\t}).catch((e) => {\n\t\t\treject(e)\n\t\t})\n\t});\n}\n\nImWebRtc.prototype.setRemoteDescription = function(offer) {\n\t// 设置对方的sdp信息\n\tthis.peerConnection.setRemoteDescription(new RTCSessionDescription(offer));\n}\n\nImWebRtc.prototype.addIceCandidate = function(candidate) {\n\t// 添加对方的候选人信息\n\tthis.peerConnection.addIceCandidate(new RTCIceCandidate(candidate));\n}\n\nImWebRtc.prototype.close = function(uid) {\n\t// 关闭RTC连接\n\tif (this.peerConnection) {\n\t\tthis.peerConnection.close();\n\t\tthis.peerConnection.onicecandidate = null;\n\t\tthis.peerConnection.onaddstream = null;\n\t\tthis.peerConnection = null;\n\t}\n}\n\nexport default ImWebRtc;"],"mappings":"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","ignoreList":[]}]}