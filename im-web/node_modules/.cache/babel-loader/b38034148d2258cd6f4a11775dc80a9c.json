{"remainingRequest":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js!/home/d/github/box-im/im-web/node_modules/eslint-loader/index.js??ref--14-0!/home/d/github/box-im/im-web/src/store/friendStore.js","dependencies":[{"path":"/home/d/github/box-im/im-web/src/store/friendStore.js","mtime":1727013808920},{"path":"/home/d/github/box-im/im-web/babel.config.js","mtime":1727013808912},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js","mtime":1727014166227},{"path":"/home/d/github/box-im/im-web/node_modules/eslint-loader/index.js","mtime":1727014164203}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCBodHRwIGZyb20gJy4uL2FwaS9odHRwUmVxdWVzdC5qcyc7CmltcG9ydCB7IFRFUk1JTkFMX1RZUEUgfSBmcm9tICIuLi9hcGkvZW51bXMuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgc3RhdGU6IHsKICAgIGZyaWVuZHM6IFtdLAogICAgYWN0aXZlRnJpZW5kOiBudWxsLAogICAgdGltZXI6IG51bGwKICB9LAogIG11dGF0aW9uczogewogICAgc2V0RnJpZW5kcyhzdGF0ZSwgZnJpZW5kcykgewogICAgICBmcmllbmRzLmZvckVhY2goZiA9PiB7CiAgICAgICAgZi5vbmxpbmUgPSBmYWxzZTsKICAgICAgICBmLm9ubGluZVdlYiA9IGZhbHNlOwogICAgICAgIGYub25saW5lQXBwID0gZmFsc2U7CiAgICAgIH0pOwogICAgICBzdGF0ZS5mcmllbmRzID0gZnJpZW5kczsKICAgIH0sCiAgICB1cGRhdGVGcmllbmQoc3RhdGUsIGZyaWVuZCkgewogICAgICBzdGF0ZS5mcmllbmRzLmZvckVhY2goKGYsIGluZGV4KSA9PiB7CiAgICAgICAgaWYgKGYuaWQgPT0gZnJpZW5kLmlkKSB7CiAgICAgICAgICAvLyDmi7fotJ3lsZ7mgKcKICAgICAgICAgIGxldCBvbmxpbmUgPSBzdGF0ZS5mcmllbmRzW2luZGV4XS5vbmxpbmU7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHN0YXRlLmZyaWVuZHNbaW5kZXhdLCBmcmllbmQpOwogICAgICAgICAgc3RhdGUuZnJpZW5kc1tpbmRleF0ub25saW5lID0gb25saW5lOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgYWN0aXZlRnJpZW5kKHN0YXRlLCBpZHgpIHsKICAgICAgc3RhdGUuYWN0aXZlRnJpZW5kID0gc3RhdGUuZnJpZW5kc1tpZHhdOwogICAgfSwKICAgIHJlbW92ZUZyaWVuZChzdGF0ZSwgaWR4KSB7CiAgICAgIGlmIChzdGF0ZS5mcmllbmRzW2lkeF0gPT0gc3RhdGUuYWN0aXZlRnJpZW5kKSB7CiAgICAgICAgc3RhdGUuYWN0aXZlRnJpZW5kID0gbnVsbDsKICAgICAgfQogICAgICBzdGF0ZS5mcmllbmRzLnNwbGljZShpZHgsIDEpOwogICAgfSwKICAgIGFkZEZyaWVuZChzdGF0ZSwgZnJpZW5kKSB7CiAgICAgIHN0YXRlLmZyaWVuZHMucHVzaChmcmllbmQpOwogICAgfSwKICAgIHJlZnJlc2hPbmxpbmVTdGF0dXMoc3RhdGUpIHsKICAgICAgbGV0IHVzZXJJZHMgPSBbXTsKICAgICAgaWYgKHN0YXRlLmZyaWVuZHMubGVuZ3RoID09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgc3RhdGUuZnJpZW5kcy5mb3JFYWNoKGYgPT4gewogICAgICAgIHVzZXJJZHMucHVzaChmLmlkKTsKICAgICAgfSk7CiAgICAgIGh0dHAoewogICAgICAgIHVybDogJy91c2VyL3Rlcm1pbmFsL29ubGluZScsCiAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgIHVzZXJJZHM6IHVzZXJJZHMuam9pbignLCcpCiAgICAgICAgfQogICAgICB9KS50aGVuKG9ubGluZVRlcm1pbmFscyA9PiB7CiAgICAgICAgdGhpcy5jb21taXQoInNldE9ubGluZVN0YXR1cyIsIG9ubGluZVRlcm1pbmFscyk7CiAgICAgIH0pOwoKICAgICAgLy8gMzBz5ZCO6YeN5paw5ouJ5Y+WCiAgICAgIHN0YXRlLnRpbWVyICYmIGNsZWFyVGltZW91dChzdGF0ZS50aW1lcik7CiAgICAgIHN0YXRlLnRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy5jb21taXQoInJlZnJlc2hPbmxpbmVTdGF0dXMiKTsKICAgICAgfSwgMzAwMDApOwogICAgfSwKICAgIHNldE9ubGluZVN0YXR1cyhzdGF0ZSwgb25saW5lVGVybWluYWxzKSB7CiAgICAgIHN0YXRlLmZyaWVuZHMuZm9yRWFjaChmID0+IHsKICAgICAgICBsZXQgdXNlclRlcm1pbmFsID0gb25saW5lVGVybWluYWxzLmZpbmQobyA9PiBmLmlkID09IG8udXNlcklkKTsKICAgICAgICBpZiAodXNlclRlcm1pbmFsKSB7CiAgICAgICAgICBmLm9ubGluZSA9IHRydWU7CiAgICAgICAgICBmLm9ubGluZVdlYiA9IHVzZXJUZXJtaW5hbC50ZXJtaW5hbHMuaW5kZXhPZihURVJNSU5BTF9UWVBFLldFQikgPj0gMDsKICAgICAgICAgIGYub25saW5lQXBwID0gdXNlclRlcm1pbmFsLnRlcm1pbmFscy5pbmRleE9mKFRFUk1JTkFMX1RZUEUuQVBQKSA+PSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmLm9ubGluZSA9IGZhbHNlOwogICAgICAgICAgZi5vbmxpbmVXZWIgPSBmYWxzZTsKICAgICAgICAgIGYub25saW5lQXBwID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgLy8g5Zyo57q/55qE5Zyo5YmN6Z2iCiAgICAgIHN0YXRlLmZyaWVuZHMuc29ydCgoZjEsIGYyKSA9PiB7CiAgICAgICAgaWYgKGYxLm9ubGluZSAmJiAhZjIub25saW5lKSB7CiAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQogICAgICAgIGlmIChmMi5vbmxpbmUgJiYgIWYxLm9ubGluZSkgewogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgICB9KTsKICAgIH0sCiAgICBjbGVhcihzdGF0ZSkgewogICAgICBzdGF0ZS50aW1lciAmJiBjbGVhclRpbWVvdXQoc3RhdGUudGltZXIpOwogICAgICBzdGF0ZS5mcmllbmRzID0gW107CiAgICAgIHN0YXRlLnRpbWVyID0gbnVsbDsKICAgICAgc3RhdGUuYWN0aXZlRnJpZW5kID0gW107CiAgICB9CiAgfSwKICBhY3Rpb25zOiB7CiAgICBsb2FkRnJpZW5kKGNvbnRleHQpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBodHRwKHsKICAgICAgICAgIHVybDogJy9mcmllbmQvbGlzdCcsCiAgICAgICAgICBtZXRob2Q6ICdHRVQnCiAgICAgICAgfSkudGhlbihmcmllbmRzID0+IHsKICAgICAgICAgIGNvbnRleHQuY29tbWl0KCJzZXRGcmllbmRzIiwgZnJpZW5kcyk7CiAgICAgICAgICBjb250ZXh0LmNvbW1pdCgicmVmcmVzaE9ubGluZVN0YXR1cyIpOwogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pLmNhdGNoKHJlcyA9PiB7CiAgICAgICAgICByZWplY3QoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"names":["http","TERMINAL_TYPE","state","friends","activeFriend","timer","mutations","setFriends","forEach","f","online","onlineWeb","onlineApp","updateFriend","friend","index","id","Object","assign","idx","removeFriend","splice","addFriend","push","refreshOnlineStatus","userIds","length","url","method","params","join","then","onlineTerminals","commit","clearTimeout","setTimeout","setOnlineStatus","userTerminal","find","o","userId","terminals","indexOf","WEB","APP","sort","f1","f2","clear","actions","loadFriend","context","Promise","resolve","reject","catch","res"],"sources":["/home/d/github/box-im/im-web/src/store/friendStore.js"],"sourcesContent":["import http from '../api/httpRequest.js'\nimport {TERMINAL_TYPE} from \"../api/enums.js\"\n\nexport default {\n\n\tstate: {\n\t\tfriends: [],\n\t\tactiveFriend: null,\n\t\ttimer: null\n\t},\n\tmutations: {\n\t\tsetFriends(state, friends) {\n\t\t\tfriends.forEach((f)=>{\n\t\t\t\tf.online = false;\n\t\t\t\tf.onlineWeb = false;\n\t\t\t\tf.onlineApp = false;\n\t\t\t})\n\t\t\tstate.friends = friends;\n\t\t},\n\t\tupdateFriend(state,friend){\n\t\t\tstate.friends.forEach((f,index)=>{\n\t\t\t\tif(f.id==friend.id){\n\t\t\t\t\t// 拷贝属性\n\t\t\t\t\tlet online = state.friends[index].online;\n\t\t\t\t\tObject.assign(state.friends[index], friend);\n\t\t\t\t\tstate.friends[index].online =online;\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tactiveFriend(state, idx) {\n\t\t\tstate.activeFriend = state.friends[idx];\n\t\t},\n\t\tremoveFriend(state, idx) {\n\t\t\tif (state.friends[idx] == state.activeFriend) {\n\t\t\t\tstate.activeFriend = null;\n\t\t\t}\n\t\t\tstate.friends.splice(idx, 1);\n\t\t},\n\t\taddFriend(state, friend) {\n\t\t\tstate.friends.push(friend);\n\t\t},\n\t\trefreshOnlineStatus(state){\n\t\t\tlet userIds = [];\n\t\t\tif(state.friends.length ==0){\n\t\t\t\treturn; \n\t\t\t}\n\t\t\tstate.friends.forEach((f)=>{userIds.push(f.id)});\n\t\t\thttp({\n\t\t\t\turl: '/user/terminal/online',\n\t\t\t\tmethod: 'get',\n\t\t\t\tparams: {userIds: userIds.join(',')}\n\t\t\t}).then((onlineTerminals) => {\n\t\t\t\tthis.commit(\"setOnlineStatus\",onlineTerminals);\n\t\t\t})\n\t\t\t\n\t\t\t// 30s后重新拉取\n\t\t\tstate.timer && clearTimeout(state.timer);\n\t\t\tstate.timer = setTimeout(()=>{\n\t\t\t\tthis.commit(\"refreshOnlineStatus\");\n\t\t\t},30000)\n\t\t},\n\t\tsetOnlineStatus(state,onlineTerminals){\n\t\t\tstate.friends.forEach((f)=>{\n\t\t\t\tlet userTerminal = onlineTerminals.find((o)=> f.id==o.userId);\n\t\t\t\tif(userTerminal){\n\t\t\t\t\tf.online = true;\n\t\t\t\t\tf.onlineWeb = userTerminal.terminals.indexOf(TERMINAL_TYPE.WEB)>=0\n\t\t\t\t\tf.onlineApp = userTerminal.terminals.indexOf(TERMINAL_TYPE.APP)>=0\n\t\t\t\t}else{\n\t\t\t\t\tf.online = false;\n\t\t\t\t\tf.onlineWeb = false;\n\t\t\t\t\tf.onlineApp = false;\n\t\t\t\t}\n\t\t\t});\n\t\t\t// 在线的在前面\n\t\t\tstate.friends.sort((f1,f2)=>{\n\t\t\t\tif(f1.online&&!f2.online){\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif(f2.online&&!f1.online){\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t});\n\t\t},\n\t\tclear(state) {\n\t\t\tstate.timer && clearTimeout(state.timer);\n\t\t\tstate.friends = [];\n\t\t\tstate.timer = null;\n\t\t\tstate.activeFriend = [];\n\t\t}\n\t},\n\tactions: {\n\t\tloadFriend(context) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\thttp({\n\t\t\t\t\turl: '/friend/list',\n\t\t\t\t\tmethod: 'GET'\n\t\t\t\t}).then((friends) => {\n\t\t\t\t\tcontext.commit(\"setFriends\", friends);\n\t\t\t\t\tcontext.commit(\"refreshOnlineStatus\");\n\t\t\t\t\tresolve()\n\t\t\t\t}).catch((res) => {\n\t\t\t\t\treject();\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]}]}