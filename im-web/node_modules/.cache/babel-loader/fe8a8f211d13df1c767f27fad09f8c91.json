{"remainingRequest":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js!/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js??ref--1-0!/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/d/github/box-im/im-web/src/components/chat/ChatGroupReaded.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/d/github/box-im/im-web/src/components/chat/ChatGroupReaded.vue","mtime":1727013808920},{"path":"/home/d/github/box-im/im-web/babel.config.js","mtime":1727013808912},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js","mtime":1727014166227},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js","mtime":1727014163811}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCBDaGF0R3JvdXBNZW1iZXIgZnJvbSAiLi9DaGF0R3JvdXBNZW1iZXIudnVlIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJjaGF0R3JvdXBSZWFkZWQiLAogIGNvbXBvbmVudHM6IHsKICAgIENoYXRHcm91cE1lbWJlcgogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHNob3c6IGZhbHNlLAogICAgICBwb3M6IHsKICAgICAgICB4OiAwLAogICAgICAgIHk6IDAsCiAgICAgICAgYXJyb3dZOiAwCiAgICAgIH0sCiAgICAgIHJlYWRlZE1lbWJlcnM6IFtdLAogICAgICB1bnJlYWRNZW1iZXJzOiBbXQogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBncm91cE1lbWJlcnM6IHsKICAgICAgdHlwZTogQXJyYXkKICAgIH0sCiAgICBtc2dJbmZvOiB7CiAgICAgIHR5cGU6IE9iamVjdAogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgY2xvc2UoKSB7CiAgICAgIHRoaXMuc2hvdyA9IGZhbHNlOwogICAgfSwKICAgIG9wZW4ocmVjdCkgewogICAgICB0aGlzLnNob3cgPSB0cnVlOwogICAgICB0aGlzLnBvcy5hcnJvd1kgPSAyMDA7CiAgICAgIC8vIOiuoeeul+eql+WPo+S9jee9rgogICAgICBpZiAodGhpcy5tc2dJbmZvLnNlbGZTZW5kKSB7CiAgICAgICAgLy8g6Ieq5bex5Y+R55qE5raI5oGv5by55Ye65Zyo5raI5oGv55qE5bem6L65CiAgICAgICAgdGhpcy5wb3MueCA9IHJlY3QubGVmdCAtIDMxMDsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDliKvkurrlj5HnmoTmtojmga/lvLnnqpflnKjmtojmga/lj7PovrkKICAgICAgICB0aGlzLnBvcy54ID0gcmVjdC5yaWdodCArIDIwOwogICAgICB9CiAgICAgIHRoaXMucG9zLnkgPSByZWN0LnRvcCArIHJlY3QuaGVpZ2h0IC8gMiAtIDIxNTsKICAgICAgLy8g6Ziy5q2i56qX5Y+j5rqi5Ye6CiAgICAgIGlmICh0aGlzLnBvcy55IDwgMCkgewogICAgICAgIHRoaXMucG9zLmFycm93WSArPSB0aGlzLnBvcy55OwogICAgICAgIHRoaXMucG9zLnkgPSAwOwogICAgICB9CiAgICAgIHRoaXMubG9hZFJlYWRlZFVzZXIoKTsKICAgIH0sCiAgICBsb2FkUmVhZGVkVXNlcigpIHsKICAgICAgdGhpcy5yZWFkZWRNZW1iZXJzID0gW107CiAgICAgIHRoaXMudW5yZWFkTWVtYmVycyA9IFtdOwogICAgICB0aGlzLiRodHRwKHsKICAgICAgICB1cmw6ICIvbWVzc2FnZS9ncm91cC9maW5kUmVhZGVkVXNlcnMiLAogICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBncm91cElkOiB0aGlzLm1zZ0luZm8uZ3JvdXBJZCwKICAgICAgICAgIG1lc3NhZ2VJZDogdGhpcy5tc2dJbmZvLmlkCiAgICAgICAgfQogICAgICB9KS50aGVuKHVzZXJJZHMgPT4gewogICAgICAgIHRoaXMuZ3JvdXBNZW1iZXJzLmZvckVhY2gobWVtYmVyID0+IHsKICAgICAgICAgIC8vIOWPkemAgeiAheWSjOW3sumAgOe+pOeahOS4jeaYvuekugogICAgICAgICAgaWYgKG1lbWJlci51c2VySWQgPT0gdGhpcy5tc2dJbmZvLnNlbmRJZCB8fCBtZW1iZXIucXVpdCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICAvLyDljLrliIblt7Lor7vov5jmmK/mnKror7sKICAgICAgICAgIGlmICh1c2VySWRzLmZpbmQodXNlcklkID0+IG1lbWJlci51c2VySWQgPT0gdXNlcklkKSkgewogICAgICAgICAgICB0aGlzLnJlYWRlZE1lbWJlcnMucHVzaChtZW1iZXIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy51bnJlYWRNZW1iZXJzLnB1c2gobWVtYmVyKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAvLyDmm7TmlrDlt7Lor7vkurrmlbAKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoInVwZGF0ZU1lc3NhZ2UiLCB7CiAgICAgICAgICBpZDogdGhpcy5tc2dJbmZvLmlkLAogICAgICAgICAgZ3JvdXBJZDogdGhpcy5tc2dJbmZvLmdyb3VwSWQsCiAgICAgICAgICByZWFkZWRDb3VudDogdGhpcy5yZWFkZWRNZW1iZXJzLmxlbmd0aAogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9Cn07"},{"version":3,"names":["ChatGroupMember","name","components","data","show","pos","x","y","arrowY","readedMembers","unreadMembers","props","groupMembers","type","Array","msgInfo","Object","methods","close","open","rect","selfSend","left","right","top","height","loadReadedUser","$http","url","method","params","groupId","messageId","id","then","userIds","forEach","member","userId","sendId","quit","find","push","$store","commit","readedCount","length"],"sources":["src/components/chat/ChatGroupReaded.vue"],"sourcesContent":["<template>\n    <div v-show=\"show\">\n        <div class=\"chat-group-readed-mask\" @click.self=\"close()\">\n            <div class=\"chat-group-readed\" :style=\"{ 'left': pos.x + 'px', 'top': pos.y + 'px' }\" @click.prevent=\"\">\n                <el-tabs type=\"border-card\" :stretch=\"true\">\n                    <el-tab-pane :label=\"`已读(${readedMembers.length})`\">\n                        <el-scrollbar class=\"scroll-box\">\n                            <div v-for=\"(member) in readedMembers\" :key=\"member.id\">\n                                <chat-group-member :member=\"member\"></chat-group-member>\n                            </div>\n                        </el-scrollbar>\n                    </el-tab-pane>\n                    <el-tab-pane :label=\"`未读(${unreadMembers.length})`\">\n                        <el-scrollbar class=\"scroll-box\">\n                            <div v-for=\"(member) in unreadMembers\" :key=\"member.id\">\n                                <chat-group-member :member=\"member\"></chat-group-member>\n                            </div>\n                        </el-scrollbar>\n                    </el-tab-pane>\n                </el-tabs>\n                <div v-show=\"msgInfo.selfSend\" class=\"arrow-right\" :style=\"{ 'top': pos.arrowY + 'px' }\">\n                    <div class=\"arrow-right-inner\">\n                    </div>\n                </div>\n                <div v-show=\"!msgInfo.selfSend\" class=\"arrow-left\" :style=\"{ 'top': pos.arrowY + 'px' }\">\n                    <div class=\"arrow-left-inner\">\n                    </div>\n                </div>\n            </div>\n        </div>\n\n    </div>\n</template>\n\n\n<script>\nimport ChatGroupMember from \"./ChatGroupMember.vue\";\n\nexport default {\n    name: \"chatGroupReaded\",\n    components: {\n        ChatGroupMember\n    },\n    data() {\n        return {\n            show: false,\n            pos: {\n                x: 0,\n                y: 0,\n                arrowY: 0\n            },\n            readedMembers: [],\n            unreadMembers: []\n        }\n    },\n    props: {\n        groupMembers: {\n            type: Array\n        },\n\t\tmsgInfo: {\n\t\t\ttype: Object\n\t\t}\n    },\n    methods: {\n        close() {\n            this.show = false;\n        },\n        open(rect) {\n            this.show = true;\n            this.pos.arrowY = 200;\n            // 计算窗口位置\n            if (this.msgInfo.selfSend) {\n                // 自己发的消息弹出在消息的左边\n                this.pos.x = rect.left - 310;\n            } else {\n                // 别人发的消息弹窗在消息右边\n                this.pos.x = rect.right + 20;\n            }\n            this.pos.y = rect.top + rect.height / 2 - 215;\n            // 防止窗口溢出\n            if (this.pos.y < 0) {\n                this.pos.arrowY += this.pos.y\n                this.pos.y = 0;\n            }\n            this.loadReadedUser()\n        },\n        loadReadedUser() {\n            this.readedMembers = [];\n            this.unreadMembers = [];\n            this.$http({\n                url: \"/message/group/findReadedUsers\",\n                method: 'get',\n                params: { groupId: this.msgInfo.groupId, messageId: this.msgInfo.id }\n            }).then(userIds => {\n                this.groupMembers.forEach(member => {\n                    // 发送者和已退群的不显示\n                    if (member.userId == this.msgInfo.sendId || member.quit) {\n                        return;\n                    }\n                    // 区分已读还是未读\n                    if (userIds.find(userId => member.userId == userId)) {\n                        this.readedMembers.push(member);\n                    } else  {\n                        this.unreadMembers.push(member);\n                    }\n                })\n\t\t\t\t// 更新已读人数\n\t\t\t\tthis.$store.commit(\"updateMessage\", {\n\t\t\t\t    id: this.msgInfo.id,\n\t\t\t\t    groupId: this.msgInfo.groupId,\n\t\t\t\t    readedCount: this.readedMembers.length\n\t\t\t\t})\n            })\n        }\n    }\n}\n</script>\n\n<style lang=\"scss\">\n.chat-group-readed-mask {\n    position: fixed;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 9999;\n}\n\n.chat-group-readed {\n    position: fixed;\n    box-shadow: 0px 0px 10px #ccc;\n    width: 300px;\n    background-color: #fafafa;\n    border-radius: 8px;\n\n    .scroll-box {\n        height: 400px;\n    }\n\n    .arrow-left {\n\n        position: absolute;\n        left: -15px;\n        width: 0;\n        height: 0;\n        border-top: 15px solid transparent;\n        border-bottom: 15px solid transparent;\n        border-right: 15px solid #ccc;\n\n        .arrow-left-inner {\n            position: absolute;\n            top: -12px;\n            left: 3px;\n            width: 0;\n            height: 0;\n            overflow: hidden;\n            border-top: 12px solid transparent;\n            border-bottom: 12px solid transparent;\n            border-right: 12px solid white;\n        }\n    }\n\n    .arrow-right {\n        position: absolute;\n        right: -15px;\n        width: 0;\n        height: 0;\n        border-top: 15px solid transparent;\n        border-bottom: 15px solid transparent;\n        border-left: 15px solid #ccc;\n\n        .arrow-right-inner {\n            position: absolute;\n            top: -12px;\n            right: 3px;\n            width: 0;\n            height: 0;\n            overflow: hidden;\n            border-top: 12px solid transparent;\n            border-bottom: 12px solid transparent;\n            border-left: 12px solid white;\n        }\n    }\n}\n</style>"],"mappings":";AAoCA,OAAAA,eAAA;AAEA;EACAC,IAAA;EACAC,UAAA;IACAF;EACA;EACAG,KAAA;IACA;MACAC,IAAA;MACAC,GAAA;QACAC,CAAA;QACAC,CAAA;QACAC,MAAA;MACA;MACAC,aAAA;MACAC,aAAA;IACA;EACA;EACAC,KAAA;IACAC,YAAA;MACAC,IAAA,EAAAC;IACA;IACAC,OAAA;MACAF,IAAA,EAAAG;IACA;EACA;EACAC,OAAA;IACAC,MAAA;MACA,KAAAd,IAAA;IACA;IACAe,KAAAC,IAAA;MACA,KAAAhB,IAAA;MACA,KAAAC,GAAA,CAAAG,MAAA;MACA;MACA,SAAAO,OAAA,CAAAM,QAAA;QACA;QACA,KAAAhB,GAAA,CAAAC,CAAA,GAAAc,IAAA,CAAAE,IAAA;MACA;QACA;QACA,KAAAjB,GAAA,CAAAC,CAAA,GAAAc,IAAA,CAAAG,KAAA;MACA;MACA,KAAAlB,GAAA,CAAAE,CAAA,GAAAa,IAAA,CAAAI,GAAA,GAAAJ,IAAA,CAAAK,MAAA;MACA;MACA,SAAApB,GAAA,CAAAE,CAAA;QACA,KAAAF,GAAA,CAAAG,MAAA,SAAAH,GAAA,CAAAE,CAAA;QACA,KAAAF,GAAA,CAAAE,CAAA;MACA;MACA,KAAAmB,cAAA;IACA;IACAA,eAAA;MACA,KAAAjB,aAAA;MACA,KAAAC,aAAA;MACA,KAAAiB,KAAA;QACAC,GAAA;QACAC,MAAA;QACAC,MAAA;UAAAC,OAAA,OAAAhB,OAAA,CAAAgB,OAAA;UAAAC,SAAA,OAAAjB,OAAA,CAAAkB;QAAA;MACA,GAAAC,IAAA,CAAAC,OAAA;QACA,KAAAvB,YAAA,CAAAwB,OAAA,CAAAC,MAAA;UACA;UACA,IAAAA,MAAA,CAAAC,MAAA,SAAAvB,OAAA,CAAAwB,MAAA,IAAAF,MAAA,CAAAG,IAAA;YACA;UACA;UACA;UACA,IAAAL,OAAA,CAAAM,IAAA,CAAAH,MAAA,IAAAD,MAAA,CAAAC,MAAA,IAAAA,MAAA;YACA,KAAA7B,aAAA,CAAAiC,IAAA,CAAAL,MAAA;UACA;YACA,KAAA3B,aAAA,CAAAgC,IAAA,CAAAL,MAAA;UACA;QACA;QACA;QACA,KAAAM,MAAA,CAAAC,MAAA;UACAX,EAAA,OAAAlB,OAAA,CAAAkB,EAAA;UACAF,OAAA,OAAAhB,OAAA,CAAAgB,OAAA;UACAc,WAAA,OAAApC,aAAA,CAAAqC;QACA;MACA;IACA;EACA;AACA","ignoreList":[]}]}