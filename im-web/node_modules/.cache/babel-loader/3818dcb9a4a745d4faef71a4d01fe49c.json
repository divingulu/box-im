{"remainingRequest":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js!/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js??ref--1-0!/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/d/github/box-im/im-web/src/components/chat/ChatRecord.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/d/github/box-im/im-web/src/components/chat/ChatRecord.vue","mtime":1727013808920},{"path":"/home/d/github/box-im/im-web/babel.config.js","mtime":1727013808912},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js","mtime":1727014166227},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js","mtime":1727014163811}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC1zZWFyY2gtcGFyYW1zLmRlbGV0ZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5oYXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuc2l6ZS5qcyI7CmltcG9ydCBSZWNvcmRlciBmcm9tICdqcy1hdWRpby1yZWNvcmRlcic7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnY2hhdFJlY29yZCcsCiAgcHJvcHM6IHsKICAgIHZpc2libGU6IHsKICAgICAgdHlwZTogQm9vbGVhbgogICAgfQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJjOiBuZXcgUmVjb3JkZXIoKSwKICAgICAgYXVkaW86IG5ldyBBdWRpbygpLAogICAgICBzdGF0ZTogJ1NUT1AnLAogICAgICAvLyBTVE9Q44CBUlVOTklOR+OAgVBBVVNF44CBQ09NUExFVEUKICAgICAgc3RhdGVUaXA6ICLmnKrlvIDlp4siLAogICAgICBtb2RlOiAnUkVDT1JEJywKICAgICAgLy8gUkVDT1JEIOOAgVBMQVkKICAgICAgZHVyYXRpb246IDAsCiAgICAgIHVybDogIiIKICAgIH07CiAgfSwKICBtZXRob2RzOiB7CiAgICBvbkNsb3NlKCkgewogICAgICAvLyDlhbPpl63liY3muIXpmaTmlbDmja4KICAgICAgdGhpcy5yYy5kZXN0cm95KCk7CiAgICAgIHRoaXMucmMgPSBuZXcgUmVjb3JkZXIoKTsKICAgICAgdGhpcy5hdWRpby5wYXVzZSgpOwogICAgICB0aGlzLm1vZGUgPSAnUkVDT1JEJzsKICAgICAgdGhpcy5zdGF0ZSA9ICdTVE9QJzsKICAgICAgdGhpcy5zdGF0ZVRpcCA9ICfmnKrlvIDlp4snOwogICAgICB0aGlzLiRlbWl0KCJjbG9zZSIpOwogICAgfSwKICAgIG9uU3RhcnRSZWNvcmQoKSB7CiAgICAgIHRoaXMucmMuc3RhcnQoKS50aGVuKHN0cmVhbSA9PiB7CiAgICAgICAgdGhpcy5zdGF0ZSA9ICdSVU5OSU5HJzsKICAgICAgICB0aGlzLnN0YXRlVGlwID0gIuato+WcqOW9lemfsy4uLiI7CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGVycm9yKTsKICAgICAgfSk7CiAgICB9LAogICAgb25QYXVzZVJlY29yZCgpIHsKICAgICAgdGhpcy5yYy5wYXVzZSgpOwogICAgICB0aGlzLnN0YXRlID0gJ1BBVVNFJzsKICAgICAgdGhpcy5zdGF0ZVRpcCA9ICLlt7LmmoLlgZzlvZXpn7MiOwogICAgfSwKICAgIG9uUmVzdW1lUmVjb3JkKCkgewogICAgICB0aGlzLnJjLnJlc3VtZSgpOwogICAgICB0aGlzLnN0YXRlID0gJ1JVTk5JTkcnOwogICAgICB0aGlzLnN0YXRlVGlwID0gIuato+WcqOW9lemfsy4uLiI7CiAgICB9LAogICAgb25Db21wbGV0ZVJlY29yZCgpIHsKICAgICAgdGhpcy5yYy5wYXVzZSgpOwogICAgICB0aGlzLnN0YXRlID0gJ0NPTVBMRVRFJzsKICAgICAgdGhpcy5zdGF0ZVRpcCA9ICLlt7Lnu5PmnZ/lvZXpn7MiOwogICAgfSwKICAgIG9uUGxheUF1ZGlvKCkgewogICAgICBsZXQgd2F2ID0gdGhpcy5yYy5nZXRXQVZCbG9iKCk7CiAgICAgIGxldCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKHdhdik7CiAgICAgIHRoaXMuJHJlZnMuYXVkaW8uc3JjID0gdXJsOwogICAgICB0aGlzLiRyZWZzLmF1ZGlvLnBsYXkoKTsKICAgICAgdGhpcy5tb2RlID0gJ1BMQVknOwogICAgfSwKICAgIG9uU3RvcEF1ZGlvKCkgewogICAgICB0aGlzLiRyZWZzLmF1ZGlvLnBhdXNlKCk7CiAgICAgIHRoaXMubW9kZSA9ICdSRUNPUkQnOwogICAgfSwKICAgIG9uUmVzdGFydFJlY29yZCgpIHsKICAgICAgdGhpcy5yYy5kZXN0cm95KCk7CiAgICAgIHRoaXMucmMgPSBuZXcgUmVjb3JkZXIoKTsKICAgICAgdGhpcy5yYy5zdGFydCgpOwogICAgICB0aGlzLnN0YXRlID0gJ1JVTk5JTkcnOwogICAgICB0aGlzLm1vZGUgPSAnUkVDT1JEJzsKICAgICAgdGhpcy5zdGF0ZVRpcCA9ICLmraPlnKjlvZXpn7MuLi4iOwogICAgfSwKICAgIG9uU2VuZFJlY29yZCgpIHsKICAgICAgbGV0IHdhdiA9IHRoaXMucmMuZ2V0V0FWQmxvYigpOwogICAgICBsZXQgbmFtZSA9IG5ldyBEYXRlKCkuZ2V0RGF0ZSgpICsgJy53YXYnOwogICAgICB2YXIgZm9ybURhdGEgPSBuZXcgd2luZG93LkZvcm1EYXRhKCk7CiAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIHdhdiwgbmFtZSk7CiAgICAgIHRoaXMuJGh0dHAoewogICAgICAgIHVybDogJy9maWxlL3VwbG9hZCcsCiAgICAgICAgZGF0YTogZm9ybURhdGEsCiAgICAgICAgbWV0aG9kOiAncG9zdCcsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdtdWx0aXBhcnQvZm9ybS1kYXRhJwogICAgICAgIH0KICAgICAgfSkudGhlbih1cmwgPT4gewogICAgICAgIGxldCBkYXRhID0gewogICAgICAgICAgZHVyYXRpb246IHBhcnNlSW50KHRoaXMucmMuZHVyYXRpb24pLAogICAgICAgICAgdXJsOiB1cmwKICAgICAgICB9OwogICAgICAgIHRoaXMuJGVtaXQoInNlbmQiLCBkYXRhKTsKICAgICAgICB0aGlzLm9uQ2xvc2UoKTsKICAgICAgfSk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"names":["Recorder","name","props","visible","type","Boolean","data","rc","audio","Audio","state","stateTip","mode","duration","url","methods","onClose","destroy","pause","$emit","onStartRecord","start","then","stream","catch","error","$message","onPauseRecord","onResumeRecord","resume","onCompleteRecord","onPlayAudio","wav","getWAVBlob","URL","createObjectURL","$refs","src","play","onStopAudio","onRestartRecord","onSendRecord","Date","getDate","formData","window","FormData","append","$http","method","headers","parseInt"],"sources":["src/components/chat/ChatRecord.vue"],"sourcesContent":["<template>\n\t<el-dialog class=\"chat-record\" title=\"语音录制\" :visible.sync=\"visible\" width=\"600px\" :before-close=\"onClose\">\n\t\t<div v-show=\"mode=='RECORD'\">\n\t\t\t<div class=\"tip\">{{stateTip}}</div>\n\t\t\t<div>时长: {{state=='STOP'?0:parseInt(rc.duration)}}s</div>\n\t\t</div>\n\t\t<audio v-show=\"mode=='PLAY'\" :src=\"url\" controls ref=\"audio\" @ended=\"onStopAudio()\"></audio>\n\t\t<el-divider content-position=\"center\"></el-divider>\n\t\t<el-row class=\"btn-group\">\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='STOP'\" @click=\"onStartRecord()\">开始录音</el-button>\n\t\t\t<el-button round type=\"warning\" v-show=\"state=='RUNNING'\" @click=\"onPauseRecord()\">暂停录音</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='PAUSE'\" @click=\"onResumeRecord()\">继续录音</el-button>\n\t\t\t<el-button round type=\"danger\" v-show=\"state=='RUNNING'||state=='PAUSE'\" @click=\"onCompleteRecord()\">\n\t\t\t\t结束录音</el-button>\n\t\t\t<el-button round type=\"success\" v-show=\"state=='COMPLETE' && mode!='PLAY'\" @click=\"onPlayAudio()\">播放录音\n\t\t\t</el-button>\n\t\t\t<el-button round type=\"warning\" v-show=\"state=='COMPLETE' && mode=='PLAY'\" @click=\"onStopAudio()\">停止播放\n\t\t\t</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='COMPLETE'\" @click=\"onRestartRecord()\">重新录音</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='COMPLETE'\" @click=\"onSendRecord()\">立即发送</el-button>\n\t\t</el-row>\n\t</el-dialog>\n\n</template>\n\n<script>\n\timport Recorder from 'js-audio-recorder';\n\n\texport default {\n\t\tname: 'chatRecord',\n\t\tprops: {\n\t\t\tvisible: {\n\t\t\t\ttype: Boolean\n\t\t\t}\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\trc: new Recorder(),\n\t\t\t\taudio: new Audio(),\n\t\t\t\tstate: 'STOP', // STOP、RUNNING、PAUSE、COMPLETE\n\t\t\t\tstateTip: \"未开始\",\n\t\t\t\tmode: 'RECORD', // RECORD 、PLAY\n\t\t\t\tduration: 0,\n\t\t\t\turl: \"\"\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tonClose() {\n\t\t\t\t// 关闭前清除数据\n\t\t\t\tthis.rc.destroy();\n\t\t\t\tthis.rc = new Recorder();\n\t\t\t\tthis.audio.pause();\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t\tthis.state = 'STOP';\n\t\t\t\tthis.stateTip = '未开始';\n\t\t\t\tthis.$emit(\"close\");\n\t\t\t},\n\t\t\tonStartRecord() {\n\t\t\t\tthis.rc.start().then((stream) => {\n\t\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tthis.$message.error(error);\n\t\t\t\t});\n\n\n\t\t\t},\n\t\t\tonPauseRecord() {\n\t\t\t\tthis.rc.pause();\n\t\t\t\tthis.state = 'PAUSE';\n\t\t\t\tthis.stateTip = \"已暂停录音\";\n\t\t\t},\n\t\t\tonResumeRecord() {\n\t\t\t\tthis.rc.resume();\n\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t},\n\t\t\tonCompleteRecord() {\n\t\t\t\tthis.rc.pause();\n\t\t\t\tthis.state = 'COMPLETE';\n\t\t\t\tthis.stateTip = \"已结束录音\";\n\t\t\t},\n\t\t\tonPlayAudio() {\n\t\t\t\tlet wav = this.rc.getWAVBlob();\n\t\t\t\tlet url = URL.createObjectURL(wav);\n\t\t\t\tthis.$refs.audio.src = url;\n\t\t\t\tthis.$refs.audio.play();\n\t\t\t\tthis.mode = 'PLAY';\n\t\t\t},\n\t\t\tonStopAudio() {\n\t\t\t\tthis.$refs.audio.pause();\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t},\n\t\t\tonRestartRecord() {\n\t\t\t\tthis.rc.destroy();\n\t\t\t\tthis.rc = new Recorder()\n\t\t\t\tthis.rc.start();\n\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t},\n\t\t\tonSendRecord() {\n\t\t\t\tlet wav = this.rc.getWAVBlob();\n\t\t\t\tlet name = new Date().getDate() + '.wav';\n\t\t\t\tvar formData = new window.FormData()\n\t\t\t\tformData.append('file', wav, name);\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: '/file/upload',\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'multipart/form-data'\n\t\t\t\t\t}\n\t\t\t\t}).then((url) => {\n\t\t\t\t\tlet data = {\n\t\t\t\t\t\tduration: parseInt(this.rc.duration),\n\t\t\t\t\t\turl: url\n\t\t\t\t\t}\n\t\t\t\t\tthis.$emit(\"send\", data);\n\t\t\t\t\tthis.onClose();\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.chat-record {\n\n\t\t.tip {\n\t\t\tfont-size: 18px;\n\t\t}\n\n\t\t.btn-group {\n\t\t\tmargin-bottom: 20px;\n\t\t}\n\t}\n</style>\n"],"mappings":";;;AA0BA,OAAAA,QAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACAC,OAAA;MACAC,IAAA,EAAAC;IACA;EACA;EACAC,KAAA;IACA;MACAC,EAAA,MAAAP,QAAA;MACAQ,KAAA,MAAAC,KAAA;MACAC,KAAA;MAAA;MACAC,QAAA;MACAC,IAAA;MAAA;MACAC,QAAA;MACAC,GAAA;IACA;EACA;EACAC,OAAA;IACAC,QAAA;MACA;MACA,KAAAT,EAAA,CAAAU,OAAA;MACA,KAAAV,EAAA,OAAAP,QAAA;MACA,KAAAQ,KAAA,CAAAU,KAAA;MACA,KAAAN,IAAA;MACA,KAAAF,KAAA;MACA,KAAAC,QAAA;MACA,KAAAQ,KAAA;IACA;IACAC,cAAA;MACA,KAAAb,EAAA,CAAAc,KAAA,GAAAC,IAAA,CAAAC,MAAA;QACA,KAAAb,KAAA;QACA,KAAAC,QAAA;MACA,GAAAa,KAAA,CAAAC,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA,CAAAA,KAAA;MACA;IAGA;IACAE,cAAA;MACA,KAAApB,EAAA,CAAAW,KAAA;MACA,KAAAR,KAAA;MACA,KAAAC,QAAA;IACA;IACAiB,eAAA;MACA,KAAArB,EAAA,CAAAsB,MAAA;MACA,KAAAnB,KAAA;MACA,KAAAC,QAAA;IACA;IACAmB,iBAAA;MACA,KAAAvB,EAAA,CAAAW,KAAA;MACA,KAAAR,KAAA;MACA,KAAAC,QAAA;IACA;IACAoB,YAAA;MACA,IAAAC,GAAA,QAAAzB,EAAA,CAAA0B,UAAA;MACA,IAAAnB,GAAA,GAAAoB,GAAA,CAAAC,eAAA,CAAAH,GAAA;MACA,KAAAI,KAAA,CAAA5B,KAAA,CAAA6B,GAAA,GAAAvB,GAAA;MACA,KAAAsB,KAAA,CAAA5B,KAAA,CAAA8B,IAAA;MACA,KAAA1B,IAAA;IACA;IACA2B,YAAA;MACA,KAAAH,KAAA,CAAA5B,KAAA,CAAAU,KAAA;MACA,KAAAN,IAAA;IACA;IACA4B,gBAAA;MACA,KAAAjC,EAAA,CAAAU,OAAA;MACA,KAAAV,EAAA,OAAAP,QAAA;MACA,KAAAO,EAAA,CAAAc,KAAA;MACA,KAAAX,KAAA;MACA,KAAAE,IAAA;MACA,KAAAD,QAAA;IACA;IACA8B,aAAA;MACA,IAAAT,GAAA,QAAAzB,EAAA,CAAA0B,UAAA;MACA,IAAAhC,IAAA,OAAAyC,IAAA,GAAAC,OAAA;MACA,IAAAC,QAAA,OAAAC,MAAA,CAAAC,QAAA;MACAF,QAAA,CAAAG,MAAA,SAAAf,GAAA,EAAA/B,IAAA;MACA,KAAA+C,KAAA;QACAlC,GAAA;QACAR,IAAA,EAAAsC,QAAA;QACAK,MAAA;QACAC,OAAA;UACA;QACA;MACA,GAAA5B,IAAA,CAAAR,GAAA;QACA,IAAAR,IAAA;UACAO,QAAA,EAAAsC,QAAA,MAAA5C,EAAA,CAAAM,QAAA;UACAC,GAAA,EAAAA;QACA;QACA,KAAAK,KAAA,SAAAb,IAAA;QACA,KAAAU,OAAA;MACA;IACA;EACA;AAEA","ignoreList":[]}]}