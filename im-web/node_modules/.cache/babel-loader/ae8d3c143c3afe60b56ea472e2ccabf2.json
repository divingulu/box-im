{"remainingRequest":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js!/home/d/github/box-im/im-web/node_modules/eslint-loader/index.js??ref--14-0!/home/d/github/box-im/im-web/src/store/chatStore.js","dependencies":[{"path":"/home/d/github/box-im/im-web/src/store/chatStore.js","mtime":1727013808920},{"path":"/home/d/github/box-im/im-web/babel.config.js","mtime":1727013808912},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js","mtime":1727014166227},{"path":"/home/d/github/box-im/im-web/node_modules/eslint-loader/index.js","mtime":1727014164203}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCB7IE1FU1NBR0VfVFlQRSwgTUVTU0FHRV9TVEFUVVMgfSBmcm9tICIuLi9hcGkvZW51bXMuanMiOwppbXBvcnQgdXNlclN0b3JlIGZyb20gJy4vdXNlclN0b3JlJzsKaW1wb3J0IGxvY2FsRm9yYWdlIGZyb20gJ2xvY2FsZm9yYWdlJzsKCi8qIOS4uuS6huWKoOmAn+aLieWPluemu+e6v+a2iOaBr+aViOeOh++8jOaLieWPluaXtua2iOaBr+aaguaXtuWtmOWCqOWIsGNhY2hlQ2hhdHMs562JCuW+heaJgOacieemu+e6v+a2iOaBr+aLieWPluWujOaIkOWQju+8jOWGjee7n+S4gOaUvuiHs3Z1ZXjkuK3ov5vooYzmuLLmn5MqLwpsZXQgY2FjaGVDaGF0cyA9IFtdOwpleHBvcnQgZGVmYXVsdCB7CiAgc3RhdGU6IHsKICAgIGFjdGl2ZUNoYXQ6IG51bGwsCiAgICBwcml2YXRlTXNnTWF4SWQ6IDAsCiAgICBncm91cE1zZ01heElkOiAwLAogICAgbG9hZGluZ1ByaXZhdGVNc2c6IGZhbHNlLAogICAgbG9hZGluZ0dyb3VwTXNnOiBmYWxzZSwKICAgIGNoYXRzOiBbXQogIH0sCiAgbXV0YXRpb25zOiB7CiAgICBpbml0Q2hhdHMoc3RhdGUsIGNoYXRzRGF0YSkgewogICAgICBzdGF0ZS5jaGF0cyA9IFtdOwogICAgICBzdGF0ZS5wcml2YXRlTXNnTWF4SWQgPSBjaGF0c0RhdGEucHJpdmF0ZU1zZ01heElkIHx8IDA7CiAgICAgIHN0YXRlLmdyb3VwTXNnTWF4SWQgPSBjaGF0c0RhdGEuZ3JvdXBNc2dNYXhJZCB8fCAwOwogICAgICBjYWNoZUNoYXRzID0gY2hhdHNEYXRhLmNoYXRzIHx8IFtdOwogICAgICAvLyDpmLLmraLlm77niYfkuIDnm7TlpITlnKjliqDovb3kuK3nirbmgIEKICAgICAgY2FjaGVDaGF0cy5mb3JFYWNoKGNoYXQgPT4gewogICAgICAgIGNoYXQubWVzc2FnZXMuZm9yRWFjaChtc2cgPT4gewogICAgICAgICAgaWYgKG1zZy5sb2FkU3RhdHVzID09ICJsb2FkaW5nIikgewogICAgICAgICAgICBtc2cubG9hZFN0YXR1cyA9ICJmYWlsIjsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgb3BlbkNoYXQoc3RhdGUsIGNoYXRJbmZvKSB7CiAgICAgIGxldCBjaGF0cyA9IHRoaXMuZ2V0dGVycy5maW5kQ2hhdHMoKTsKICAgICAgbGV0IGNoYXQgPSBudWxsOwogICAgICBmb3IgKGxldCBpZHggaW4gY2hhdHMpIHsKICAgICAgICBpZiAoY2hhdHNbaWR4XS50eXBlID09IGNoYXRJbmZvLnR5cGUgJiYgY2hhdHNbaWR4XS50YXJnZXRJZCA9PT0gY2hhdEluZm8udGFyZ2V0SWQpIHsKICAgICAgICAgIGNoYXQgPSBjaGF0c1tpZHhdOwogICAgICAgICAgLy8g5pS+572u5aS06YOoCiAgICAgICAgICB0aGlzLmNvbW1pdCgibW92ZVRvcCIsIGlkeCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8g5Yib5bu65Lya6K+dCiAgICAgIGlmIChjaGF0ID09IG51bGwpIHsKICAgICAgICBjaGF0ID0gewogICAgICAgICAgdGFyZ2V0SWQ6IGNoYXRJbmZvLnRhcmdldElkLAogICAgICAgICAgdHlwZTogY2hhdEluZm8udHlwZSwKICAgICAgICAgIHNob3dOYW1lOiBjaGF0SW5mby5zaG93TmFtZSwKICAgICAgICAgIGhlYWRJbWFnZTogY2hhdEluZm8uaGVhZEltYWdlLAogICAgICAgICAgbGFzdENvbnRlbnQ6ICIiLAogICAgICAgICAgbGFzdFNlbmRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKICAgICAgICAgIHVucmVhZENvdW50OiAwLAogICAgICAgICAgbWVzc2FnZXM6IFtdLAogICAgICAgICAgYXRNZTogZmFsc2UsCiAgICAgICAgICBhdEFsbDogZmFsc2UsCiAgICAgICAgICBzdG9yZWQ6IGZhbHNlLAogICAgICAgICAgZGVsZXRlOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgY2hhdHMudW5zaGlmdChjaGF0KTsKICAgICAgfQogICAgfSwKICAgIGFjdGl2ZUNoYXQoc3RhdGUsIGlkeCkgewogICAgICBsZXQgY2hhdHMgPSB0aGlzLmdldHRlcnMuZmluZENoYXRzKCk7CiAgICAgIHN0YXRlLmFjdGl2ZUNoYXQgPSBjaGF0c1tpZHhdOwogICAgfSwKICAgIHJlc2V0VW5yZWFkQ291bnQoc3RhdGUsIGNoYXRJbmZvKSB7CiAgICAgIGxldCBjaGF0cyA9IHRoaXMuZ2V0dGVycy5maW5kQ2hhdHMoKTsKICAgICAgZm9yIChsZXQgaWR4IGluIGNoYXRzKSB7CiAgICAgICAgaWYgKGNoYXRzW2lkeF0udHlwZSA9PSBjaGF0SW5mby50eXBlICYmIGNoYXRzW2lkeF0udGFyZ2V0SWQgPT0gY2hhdEluZm8udGFyZ2V0SWQpIHsKICAgICAgICAgIGNoYXRzW2lkeF0udW5yZWFkQ291bnQgPSAwOwogICAgICAgICAgY2hhdHNbaWR4XS5hdE1lID0gZmFsc2U7CiAgICAgICAgICBjaGF0c1tpZHhdLmF0QWxsID0gZmFsc2U7CiAgICAgICAgICBjaGF0c1tpZHhdLnN0b3JlZCA9IGZhbHNlOwogICAgICAgICAgdGhpcy5jb21taXQoInNhdmVUb1N0b3JhZ2UiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHJlYWRlZE1lc3NhZ2Uoc3RhdGUsIHBvcykgewogICAgICBsZXQgY2hhdCA9IHRoaXMuZ2V0dGVycy5maW5kQ2hhdEJ5RnJpZW5kKHBvcy5mcmllbmRJZCk7CiAgICAgIGNoYXQubWVzc2FnZXMuZm9yRWFjaChtID0+IHsKICAgICAgICBpZiAobS5pZCAmJiBtLnNlbGZTZW5kICYmIG0uc3RhdHVzIDwgTUVTU0FHRV9TVEFUVVMuUkVDQUxMKSB7CiAgICAgICAgICAvLyBwb3MubWF4SWTkuLrnqbrooajnpLrmlbTkuKrkvJror53lt7Lor7sKICAgICAgICAgIGlmICghcG9zLm1heElkIHx8IG0uaWQgPD0gcG9zLm1heElkKSB7CiAgICAgICAgICAgIG0uc3RhdHVzID0gTUVTU0FHRV9TVEFUVVMuUkVBREVEOwogICAgICAgICAgICBjaGF0LnN0b3JlZCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuY29tbWl0KCJzYXZlVG9TdG9yYWdlIik7CiAgICB9LAogICAgcmVtb3ZlQ2hhdChzdGF0ZSwgaWR4KSB7CiAgICAgIGxldCBjaGF0cyA9IHRoaXMuZ2V0dGVycy5maW5kQ2hhdHMoKTsKICAgICAgaWYgKGNoYXRzW2lkeF0gPT0gc3RhdGUuYWN0aXZlQ2hhdCkgewogICAgICAgIHN0YXRlLmFjdGl2ZUNoYXQgPSBudWxsOwogICAgICB9CiAgICAgIGNoYXRzW2lkeF0uZGVsZXRlID0gdHJ1ZTsKICAgICAgY2hhdHNbaWR4XS5zdG9yZWQgPSBmYWxzZTsKICAgICAgdGhpcy5jb21taXQoInNhdmVUb1N0b3JhZ2UiKTsKICAgIH0sCiAgICByZW1vdmVQcml2YXRlQ2hhdChzdGF0ZSwgZnJpZW5kSWQpIHsKICAgICAgbGV0IGNoYXRzID0gdGhpcy5nZXR0ZXJzLmZpbmRDaGF0cygpOwogICAgICBmb3IgKGxldCBpZHggaW4gY2hhdHMpIHsKICAgICAgICBpZiAoY2hhdHNbaWR4XS50eXBlID09ICdQUklWQVRFJyAmJiBjaGF0c1tpZHhdLnRhcmdldElkID09PSBmcmllbmRJZCkgewogICAgICAgICAgdGhpcy5jb21taXQoInJlbW92ZUNoYXQiLCBpZHgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgcmVtb3ZlR3JvdXBDaGF0KHN0YXRlLCBncm91cElkKSB7CiAgICAgIGxldCBjaGF0cyA9IHRoaXMuZ2V0dGVycy5maW5kQ2hhdHMoKTsKICAgICAgZm9yIChsZXQgaWR4IGluIGNoYXRzKSB7CiAgICAgICAgaWYgKGNoYXRzW2lkeF0udHlwZSA9PSAnR1JPVVAnICYmIGNoYXRzW2lkeF0udGFyZ2V0SWQgPT09IGdyb3VwSWQpIHsKICAgICAgICAgIHRoaXMuY29tbWl0KCJyZW1vdmVDaGF0IiwgaWR4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIG1vdmVUb3Aoc3RhdGUsIGlkeCkgewogICAgICAvLyDliqDovb3kuK3kuI3np7vliqjvvIzlvojogJfmgKfog70KICAgICAgaWYgKHRoaXMuZ2V0dGVycy5pc0xvYWRpbmcoKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoaWR4ID4gMCkgewogICAgICAgIGxldCBjaGF0cyA9IHRoaXMuZ2V0dGVycy5maW5kQ2hhdHMoKTsKICAgICAgICBsZXQgY2hhdCA9IGNoYXRzW2lkeF07CiAgICAgICAgY2hhdHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgICAgY2hhdHMudW5zaGlmdChjaGF0KTsKICAgICAgICBjaGF0Lmxhc3RTZW5kVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIGNoYXQuc3RvcmVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5jb21taXQoInNhdmVUb1N0b3JhZ2UiKTsKICAgICAgfQogICAgfSwKICAgIGluc2VydE1lc3NhZ2Uoc3RhdGUsIG1zZ0luZm8pIHsKICAgICAgbGV0IHR5cGUgPSBtc2dJbmZvLmdyb3VwSWQgPyAnR1JPVVAnIDogJ1BSSVZBVEUnOwogICAgICAvLyDorrDlvZXmtojmga/nmoTmnIDlpKdpZAogICAgICBpZiAobXNnSW5mby5pZCAmJiB0eXBlID09ICJQUklWQVRFIiAmJiBtc2dJbmZvLmlkID4gc3RhdGUucHJpdmF0ZU1zZ01heElkKSB7CiAgICAgICAgc3RhdGUucHJpdmF0ZU1zZ01heElkID0gbXNnSW5mby5pZDsKICAgICAgfQogICAgICBpZiAobXNnSW5mby5pZCAmJiB0eXBlID09ICJHUk9VUCIgJiYgbXNnSW5mby5pZCA+IHN0YXRlLmdyb3VwTXNnTWF4SWQpIHsKICAgICAgICBzdGF0ZS5ncm91cE1zZ01heElkID0gbXNnSW5mby5pZDsKICAgICAgfQogICAgICAvLyDlpoLmnpzmmK/lt7LlrZjlnKjmtojmga/vvIzliJnopobnm5bml6fnmoTmtojmga/mlbDmja4KICAgICAgbGV0IGNoYXQgPSB0aGlzLmdldHRlcnMuZmluZENoYXQobXNnSW5mbyk7CiAgICAgIGxldCBtZXNzYWdlID0gdGhpcy5nZXR0ZXJzLmZpbmRNZXNzYWdlKGNoYXQsIG1zZ0luZm8pOwogICAgICBpZiAobWVzc2FnZSkgewogICAgICAgIE9iamVjdC5hc3NpZ24obWVzc2FnZSwgbXNnSW5mbyk7CiAgICAgICAgLy8g5pKk5Zue5raI5oGv6ZyA6KaB5pi+56S6CiAgICAgICAgaWYgKG1zZ0luZm8udHlwZSA9PSBNRVNTQUdFX1RZUEUuUkVDQUxMKSB7CiAgICAgICAgICBjaGF0Lmxhc3RDb250ZW50ID0gbXNnSW5mby5jb250ZW50OwogICAgICAgIH0KICAgICAgICBjaGF0LnN0b3JlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuY29tbWl0KCJzYXZlVG9TdG9yYWdlIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIC8vIOaPkuWFpeaWsOeahOaVsOaNrgogICAgICBpZiAobXNnSW5mby50eXBlID09IE1FU1NBR0VfVFlQRS5JTUFHRSkgewogICAgICAgIGNoYXQubGFzdENvbnRlbnQgPSAiW+WbvueJh10iOwogICAgICB9IGVsc2UgaWYgKG1zZ0luZm8udHlwZSA9PSBNRVNTQUdFX1RZUEUuRklMRSkgewogICAgICAgIGNoYXQubGFzdENvbnRlbnQgPSAiW+aWh+S7tl0iOwogICAgICB9IGVsc2UgaWYgKG1zZ0luZm8udHlwZSA9PSBNRVNTQUdFX1RZUEUuQVVESU8pIHsKICAgICAgICBjaGF0Lmxhc3RDb250ZW50ID0gIlvor63pn7NdIjsKICAgICAgfSBlbHNlIGlmIChtc2dJbmZvLnR5cGUgPT0gTUVTU0FHRV9UWVBFLkFDVF9SVF9WT0lDRSkgewogICAgICAgIGNoYXQubGFzdENvbnRlbnQgPSAiW+ivremfs+mAmuivnV0iOwogICAgICB9IGVsc2UgaWYgKG1zZ0luZm8udHlwZSA9PSBNRVNTQUdFX1RZUEUuQUNUX1JUX1ZJREVPKSB7CiAgICAgICAgY2hhdC5sYXN0Q29udGVudCA9ICJb6KeG6aKR6YCa6K+dXSI7CiAgICAgIH0gZWxzZSBpZiAobXNnSW5mby50eXBlID09IE1FU1NBR0VfVFlQRS5URVhUIHx8IG1zZ0luZm8udHlwZSA9PSBNRVNTQUdFX1RZUEUuUkVDQUxMIHx8IG1zZ0luZm8udHlwZSA9PSBNRVNTQUdFX1RZUEUuVElQX1RFWFQpIHsKICAgICAgICBjaGF0Lmxhc3RDb250ZW50ID0gbXNnSW5mby5jb250ZW50OwogICAgICB9CiAgICAgIGNoYXQubGFzdFNlbmRUaW1lID0gbXNnSW5mby5zZW5kVGltZTsKICAgICAgY2hhdC5zZW5kTmlja05hbWUgPSBtc2dJbmZvLnNlbmROaWNrTmFtZTsKICAgICAgLy8g5pyq6K+75YqgMQogICAgICBpZiAoIW1zZ0luZm8uc2VsZlNlbmQgJiYgbXNnSW5mby5zdGF0dXMgIT0gTUVTU0FHRV9TVEFUVVMuUkVBREVEICYmIG1zZ0luZm8udHlwZSAhPSBNRVNTQUdFX1RZUEUuVElQX1RFWFQpIHsKICAgICAgICBjaGF0LnVucmVhZENvdW50Kys7CiAgICAgIH0KICAgICAgLy8g5piv5ZCm5pyJ5Lq6QOaIkQogICAgICBpZiAoIW1zZ0luZm8uc2VsZlNlbmQgJiYgY2hhdC50eXBlID09ICJHUk9VUCIgJiYgbXNnSW5mby5hdFVzZXJJZHMgJiYgbXNnSW5mby5zdGF0dXMgIT0gTUVTU0FHRV9TVEFUVVMuUkVBREVEKSB7CiAgICAgICAgbGV0IHVzZXJJZCA9IHVzZXJTdG9yZS5zdGF0ZS51c2VySW5mby5pZDsKICAgICAgICBpZiAobXNnSW5mby5hdFVzZXJJZHMuaW5kZXhPZih1c2VySWQpID49IDApIHsKICAgICAgICAgIGNoYXQuYXRNZSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChtc2dJbmZvLmF0VXNlcklkcy5pbmRleE9mKC0xKSA+PSAwKSB7CiAgICAgICAgICBjaGF0LmF0QWxsID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8g6Ze06ZqU5aSn5LqOMTDliIbpkp/mj5LlhaXml7bpl7TmmL7npLoKICAgICAgaWYgKCFjaGF0Lmxhc3RUaW1lVGlwIHx8IGNoYXQubGFzdFRpbWVUaXAgPCBtc2dJbmZvLnNlbmRUaW1lIC0gNjAwICogMTAwMCkgewogICAgICAgIGNoYXQubWVzc2FnZXMucHVzaCh7CiAgICAgICAgICBzZW5kVGltZTogbXNnSW5mby5zZW5kVGltZSwKICAgICAgICAgIHR5cGU6IE1FU1NBR0VfVFlQRS5USVBfVElNRQogICAgICAgIH0pOwogICAgICAgIGNoYXQubGFzdFRpbWVUaXAgPSBtc2dJbmZvLnNlbmRUaW1lOwogICAgICB9CiAgICAgIC8vIOagueaNrmlk6aG65bqP5o+S5YWl77yM6Ziy5q2i5raI5oGv5Lmx5bqPCiAgICAgIGxldCBpbnNlcnRQb3MgPSBjaGF0Lm1lc3NhZ2VzLmxlbmd0aDsKICAgICAgLy8g6Ziy5q2iIOWbvueJh+OAgeaWh+S7tiDlnKjlj5HpgIHmlrkg5pi+56S6IOWcqOmhtuerryAg5Zug5Li66L+Y5rKh5a2Y5bqT77yMaWQ9MAogICAgICBpZiAobXNnSW5mby5pZCAmJiBtc2dJbmZvLmlkID4gMCkgewogICAgICAgIGZvciAobGV0IGlkeCBpbiBjaGF0Lm1lc3NhZ2VzKSB7CiAgICAgICAgICBpZiAoY2hhdC5tZXNzYWdlc1tpZHhdLmlkICYmIG1zZ0luZm8uaWQgPCBjaGF0Lm1lc3NhZ2VzW2lkeF0uaWQpIHsKICAgICAgICAgICAgaW5zZXJ0UG9zID0gaWR4OwogICAgICAgICAgICBjb25zb2xlLmxvZyhg5raI5oGv5Ye6546w5Lmx5bqPLOS9jee9rjoke2NoYXQubWVzc2FnZXMubGVuZ3RofSzkv67mraPoh7M6JHtpbnNlcnRQb3N9YCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjaGF0Lm1lc3NhZ2VzLnNwbGljZShpbnNlcnRQb3MsIDAsIG1zZ0luZm8pOwogICAgICBjaGF0LnN0b3JlZCA9IGZhbHNlOwogICAgICB0aGlzLmNvbW1pdCgic2F2ZVRvU3RvcmFnZSIpOwogICAgfSwKICAgIHVwZGF0ZU1lc3NhZ2Uoc3RhdGUsIG1zZ0luZm8pIHsKICAgICAgLy8g6I635Y+W5a+55pa5aWTmiJbnvqRpZAogICAgICBsZXQgY2hhdCA9IHRoaXMuZ2V0dGVycy5maW5kQ2hhdChtc2dJbmZvKTsKICAgICAgbGV0IG1lc3NhZ2UgPSB0aGlzLmdldHRlcnMuZmluZE1lc3NhZ2UoY2hhdCwgbXNnSW5mbyk7CiAgICAgIGlmIChtZXNzYWdlKSB7CiAgICAgICAgLy8g5bGe5oCn5ou36LSdCiAgICAgICAgT2JqZWN0LmFzc2lnbihtZXNzYWdlLCBtc2dJbmZvKTsKICAgICAgICBjaGF0LnN0b3JlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuY29tbWl0KCJzYXZlVG9TdG9yYWdlIik7CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVNZXNzYWdlKHN0YXRlLCBtc2dJbmZvKSB7CiAgICAgIGxldCBjaGF0ID0gdGhpcy5nZXR0ZXJzLmZpbmRDaGF0KG1zZ0luZm8pOwogICAgICBmb3IgKGxldCBpZHggaW4gY2hhdC5tZXNzYWdlcykgewogICAgICAgIC8vIOW3sue7j+WPkemAgeaIkOWKn+eahO+8jOagueaNrmlk5Yig6ZmkCiAgICAgICAgaWYgKGNoYXQubWVzc2FnZXNbaWR4XS5pZCAmJiBjaGF0Lm1lc3NhZ2VzW2lkeF0uaWQgPT0gbXNnSW5mby5pZCkgewogICAgICAgICAgY2hhdC5tZXNzYWdlcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAvLyDmraPlnKjlj5HpgIHkuK3nmoTmtojmga/lj6/og73msqHmnIlpZO+8jOagueaNruWPkemAgeaXtumXtOWIoOmZpAogICAgICAgIGlmIChtc2dJbmZvLnNlbGZTZW5kICYmIGNoYXQubWVzc2FnZXNbaWR4XS5zZWxmU2VuZCAmJiBjaGF0Lm1lc3NhZ2VzW2lkeF0uc2VuZFRpbWUgPT0gbXNnSW5mby5zZW5kVGltZSkgewogICAgICAgICAgY2hhdC5tZXNzYWdlcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBjaGF0LnN0b3JlZCA9IGZhbHNlOwogICAgICB0aGlzLmNvbW1pdCgic2F2ZVRvU3RvcmFnZSIpOwogICAgfSwKICAgIHVwZGF0ZUNoYXRGcm9tRnJpZW5kKHN0YXRlLCBmcmllbmQpIHsKICAgICAgbGV0IGNoYXQgPSB0aGlzLmdldHRlcnMuZmluZENoYXRCeUZyaWVuZChmcmllbmQuaWQpOwogICAgICAvLyDmm7TmlrDkvJror53kuK3nmoTnvqTlkI3lkozlpLTlg48KICAgICAgaWYgKGNoYXQgJiYgKGNoYXQuaGVhZEltYWdlICE9IGZyaWVuZC5oZWFkSW1hZ2VUaHVtYiB8fCBjaGF0LnNob3dOYW1lICE9IGZyaWVuZC5uaWNrTmFtZSkpIHsKICAgICAgICBjaGF0LmhlYWRJbWFnZSA9IGZyaWVuZC5oZWFkSW1hZ2VUaHVtYjsKICAgICAgICBjaGF0LnNob3dOYW1lID0gZnJpZW5kLm5pY2tOYW1lOwogICAgICAgIGNoYXQuc3RvcmVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5jb21taXQoInNhdmVUb1N0b3JhZ2UiKTsKICAgICAgfQogICAgfSwKICAgIHVwZGF0ZUNoYXRGcm9tR3JvdXAoc3RhdGUsIGdyb3VwKSB7CiAgICAgIGxldCBjaGF0ID0gdGhpcy5nZXR0ZXJzLmZpbmRDaGF0QnlHcm91cChncm91cC5pZCk7CiAgICAgIGlmIChjaGF0ICYmIChjaGF0LmhlYWRJbWFnZSAhPSBncm91cC5oZWFkSW1hZ2VUaHVtYiB8fCBjaGF0LnNob3dOYW1lICE9IGdyb3VwLnNob3dHcm91cE5hbWUpKSB7CiAgICAgICAgLy8g5pu05paw5Lya6K+d5Lit55qE576k5ZCN56ew5ZKM5aS05YOPCiAgICAgICAgY2hhdC5oZWFkSW1hZ2UgPSBncm91cC5oZWFkSW1hZ2VUaHVtYjsKICAgICAgICBjaGF0LnNob3dOYW1lID0gZ3JvdXAuc2hvd0dyb3VwTmFtZTsKICAgICAgICBjaGF0LnN0b3JlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuY29tbWl0KCJzYXZlVG9TdG9yYWdlIik7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkaW5nUHJpdmF0ZU1zZyhzdGF0ZSwgbG9hZGluZykgewogICAgICBzdGF0ZS5sb2FkaW5nUHJpdmF0ZU1zZyA9IGxvYWRpbmc7CiAgICAgIGlmICghdGhpcy5nZXR0ZXJzLmlzTG9hZGluZygpKSB7CiAgICAgICAgdGhpcy5jb21taXQoInJlZnJlc2hDaGF0cyIpOwogICAgICB9CiAgICB9LAogICAgbG9hZGluZ0dyb3VwTXNnKHN0YXRlLCBsb2FkaW5nKSB7CiAgICAgIHN0YXRlLmxvYWRpbmdHcm91cE1zZyA9IGxvYWRpbmc7CiAgICAgIGlmICghdGhpcy5nZXR0ZXJzLmlzTG9hZGluZygpKSB7CiAgICAgICAgdGhpcy5jb21taXQoInJlZnJlc2hDaGF0cyIpOwogICAgICB9CiAgICB9LAogICAgcmVmcmVzaENoYXRzKHN0YXRlKSB7CiAgICAgIC8vIOaOkuW6jwogICAgICBjYWNoZUNoYXRzLnNvcnQoKGNoYXQxLCBjaGF0MikgPT4gewogICAgICAgIHJldHVybiBjaGF0Mi5sYXN0U2VuZFRpbWUgLSBjaGF0MS5sYXN0U2VuZFRpbWU7CiAgICAgIH0pOwogICAgICAvLyDlsIbmtojmga/kuIDmrKHmgKfoo4Xovb3lm57mnaUKICAgICAgc3RhdGUuY2hhdHMgPSBjYWNoZUNoYXRzOwogICAgICAvLyDmlq3nur/ph43ov57lkI7kuI3og73kvb/nlKjnvJPlrZjmqKHlvI/vvIzlkKbliJnkvJrlr7zoh7TogYrlpKnnqpflj6PnmoTmtojmga/kuI3liLfmlrAKICAgICAgY2FjaGVDaGF0cyA9IHN0YXRlLmNoYXRzOwogICAgICB0aGlzLmNvbW1pdCgic2F2ZVRvU3RvcmFnZSIpOwogICAgfSwKICAgIHNhdmVUb1N0b3JhZ2Uoc3RhdGUpIHsKICAgICAgLy8g5Yqg6L295Lit5LiN5L+d5a2Y77yM6Ziy5q2i5Y2h6aG/CiAgICAgIGlmICh0aGlzLmdldHRlcnMuaXNMb2FkaW5nKCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbGV0IHVzZXJJZCA9IHVzZXJTdG9yZS5zdGF0ZS51c2VySW5mby5pZDsKICAgICAgbGV0IGtleSA9ICJjaGF0cy0iICsgdXNlcklkOwogICAgICBsZXQgY2hhdEtleXMgPSBbXTsKICAgICAgLy8g5oyJ5Lya6K+d5Li65Y2V5L2N5a2Y5YKo77yMCiAgICAgIHN0YXRlLmNoYXRzLmZvckVhY2goY2hhdCA9PiB7CiAgICAgICAgLy8g5Y+q5a2Y5YKo5pyJ5pS55Yqo55qE5Lya6K+dCiAgICAgICAgbGV0IGNoYXRLZXkgPSBgJHtrZXl9LSR7Y2hhdC50eXBlfS0ke2NoYXQudGFyZ2V0SWR9YDsKICAgICAgICBpZiAoIWNoYXQuc3RvcmVkKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhjaGF0S2V5KTsKICAgICAgICAgIGlmIChjaGF0LmRlbGV0ZSkgewogICAgICAgICAgICBsb2NhbEZvcmFnZS5yZW1vdmVJdGVtKGNoYXRLZXkpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbG9jYWxGb3JhZ2Uuc2V0SXRlbShjaGF0S2V5LCBjaGF0KTsKICAgICAgICAgIH0KICAgICAgICAgIGNoYXQuc3RvcmVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjaGF0LmRlbGV0ZSkgewogICAgICAgICAgY2hhdEtleXMucHVzaChjaGF0S2V5KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICAvLyDkvJror53moLjlv4Pkv6Hmga8KICAgICAgbGV0IGNoYXRzRGF0YSA9IHsKICAgICAgICBwcml2YXRlTXNnTWF4SWQ6IHN0YXRlLnByaXZhdGVNc2dNYXhJZCwKICAgICAgICBncm91cE1zZ01heElkOiBzdGF0ZS5ncm91cE1zZ01heElkLAogICAgICAgIGNoYXRLZXlzOiBjaGF0S2V5cwogICAgICB9OwogICAgICBsb2NhbEZvcmFnZS5zZXRJdGVtKGtleSwgY2hhdHNEYXRhKTsKICAgICAgLy8g5riF55CG5bey5Yig6Zmk55qE5Lya6K+dCiAgICAgIHN0YXRlLmNoYXRzID0gc3RhdGUuY2hhdHMuZmlsdGVyKGNoYXQgPT4gIWNoYXQuZGVsZXRlKTsKICAgIH0sCiAgICBjbGVhcihzdGF0ZSkgewogICAgICBjYWNoZUNoYXRzID0gW107CiAgICAgIHN0YXRlLmNoYXRzID0gW107CiAgICAgIHN0YXRlLmFjdGl2ZUNoYXQgPSBudWxsOwogICAgfQogIH0sCiAgYWN0aW9uczogewogICAgbG9hZENoYXQoY29udGV4dCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgIGxldCB1c2VySWQgPSB1c2VyU3RvcmUuc3RhdGUudXNlckluZm8uaWQ7CiAgICAgICAgbGV0IGtleSA9ICJjaGF0cy0iICsgdXNlcklkOwogICAgICAgIGxvY2FsRm9yYWdlLmdldEl0ZW0oa2V5KS50aGVuKGNoYXRzRGF0YSA9PiB7CiAgICAgICAgICBpZiAoIWNoYXRzRGF0YSkgewogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGNoYXRzRGF0YS5jaGF0cykgewogICAgICAgICAgICAvLyDlhbzlrrnml6fniYjmnKwKICAgICAgICAgICAgY29udGV4dC5jb21taXQoImluaXRDaGF0cyIsIGNoYXRzRGF0YSk7CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoY2hhdHNEYXRhLmNoYXRLZXlzKSB7CiAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICAgICAgICAgIGNoYXRzRGF0YS5jaGF0S2V5cy5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaChsb2NhbEZvcmFnZS5nZXRJdGVtKGtleSkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oY2hhdHMgPT4gewogICAgICAgICAgICAgIGNoYXRzRGF0YS5jaGF0cyA9IGNoYXRzLmZpbHRlcihvID0+IG8pOwogICAgICAgICAgICAgIGNvbnRleHQuY29tbWl0KCJpbml0Q2hhdHMiLCBjaGF0c0RhdGEpOwogICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZygi5Yqg6L295raI5oGv5aSx6LSlIik7CiAgICAgICAgICByZWplY3QoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwKICBnZXR0ZXJzOiB7CiAgICBpc0xvYWRpbmc6IHN0YXRlID0+ICgpID0+IHsKICAgICAgcmV0dXJuIHN0YXRlLmxvYWRpbmdQcml2YXRlTXNnIHx8IHN0YXRlLmxvYWRpbmdHcm91cE1zZzsKICAgIH0sCiAgICBmaW5kQ2hhdHM6IChzdGF0ZSwgZ2V0dGVycykgPT4gKCkgPT4gewogICAgICByZXR1cm4gZ2V0dGVycy5pc0xvYWRpbmcoKSA/IGNhY2hlQ2hhdHMgOiBzdGF0ZS5jaGF0czsKICAgIH0sCiAgICBmaW5kQ2hhdElkeDogKHN0YXRlLCBnZXR0ZXJzKSA9PiBjaGF0ID0+IHsKICAgICAgbGV0IGNoYXRzID0gZ2V0dGVycy5maW5kQ2hhdHMoKTsKICAgICAgZm9yIChsZXQgaWR4IGluIGNoYXRzKSB7CiAgICAgICAgaWYgKGNoYXRzW2lkeF0udHlwZSA9PSBjaGF0LnR5cGUgJiYgY2hhdHNbaWR4XS50YXJnZXRJZCA9PT0gY2hhdC50YXJnZXRJZCkgewogICAgICAgICAgY2hhdCA9IGNoYXRzW2lkeF07CiAgICAgICAgICByZXR1cm4gaWR4OwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGZpbmRDaGF0OiAoc3RhdGUsIGdldHRlcnMpID0+IG1zZ0luZm8gPT4gewogICAgICBsZXQgY2hhdHMgPSBnZXR0ZXJzLmZpbmRDaGF0cygpOwogICAgICAvLyDojrflj5blr7nmlrlpZOaIlue+pGlkCiAgICAgIGxldCB0eXBlID0gbXNnSW5mby5ncm91cElkID8gJ0dST1VQJyA6ICdQUklWQVRFJzsKICAgICAgbGV0IHRhcmdldElkID0gbXNnSW5mby5ncm91cElkID8gbXNnSW5mby5ncm91cElkIDogbXNnSW5mby5zZWxmU2VuZCA/IG1zZ0luZm8ucmVjdklkIDogbXNnSW5mby5zZW5kSWQ7CiAgICAgIGxldCBjaGF0ID0gbnVsbDsKICAgICAgZm9yIChsZXQgaWR4IGluIGNoYXRzKSB7CiAgICAgICAgaWYgKGNoYXRzW2lkeF0udHlwZSA9PSB0eXBlICYmIGNoYXRzW2lkeF0udGFyZ2V0SWQgPT09IHRhcmdldElkKSB7CiAgICAgICAgICBjaGF0ID0gY2hhdHNbaWR4XTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gY2hhdDsKICAgIH0sCiAgICBmaW5kQ2hhdEJ5RnJpZW5kOiAoc3RhdGUsIGdldHRlcnMpID0+IGZpZCA9PiB7CiAgICAgIGxldCBjaGF0cyA9IGdldHRlcnMuZmluZENoYXRzKCk7CiAgICAgIHJldHVybiBjaGF0cy5maW5kKGNoYXQgPT4gY2hhdC50eXBlID09ICdQUklWQVRFJyAmJiBjaGF0LnRhcmdldElkID09IGZpZCk7CiAgICB9LAogICAgZmluZENoYXRCeUdyb3VwOiAoc3RhdGUsIGdldHRlcnMpID0+IGdpZCA9PiB7CiAgICAgIGxldCBjaGF0cyA9IGdldHRlcnMuZmluZENoYXRzKCk7CiAgICAgIHJldHVybiBjaGF0cy5maW5kKGNoYXQgPT4gY2hhdC50eXBlID09ICdHUk9VUCcgJiYgY2hhdC50YXJnZXRJZCA9PSBnaWQpOwogICAgfSwKICAgIGZpbmRNZXNzYWdlOiBzdGF0ZSA9PiAoY2hhdCwgbXNnSW5mbykgPT4gewogICAgICBpZiAoIWNoYXQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBmb3IgKGxldCBpZHggaW4gY2hhdC5tZXNzYWdlcykgewogICAgICAgIC8vIOmAmui/h2lk5Yik5patCiAgICAgICAgaWYgKG1zZ0luZm8uaWQgJiYgY2hhdC5tZXNzYWdlc1tpZHhdLmlkID09IG1zZ0luZm8uaWQpIHsKICAgICAgICAgIHJldHVybiBjaGF0Lm1lc3NhZ2VzW2lkeF07CiAgICAgICAgfQogICAgICAgIC8vIOato+WcqOWPkemAgeS4reeahOa2iOaBr+WPr+iDveayoeaciWlkLOWPquaciXRtcElkCiAgICAgICAgaWYgKG1zZ0luZm8udG1wSWQgJiYgY2hhdC5tZXNzYWdlc1tpZHhdLnRtcElkICYmIGNoYXQubWVzc2FnZXNbaWR4XS50bXBJZCA9PSBtc2dJbmZvLnRtcElkKSB7CiAgICAgICAgICByZXR1cm4gY2hhdC5tZXNzYWdlc1tpZHhdOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfTs="},{"version":3,"names":["MESSAGE_TYPE","MESSAGE_STATUS","userStore","localForage","cacheChats","state","activeChat","privateMsgMaxId","groupMsgMaxId","loadingPrivateMsg","loadingGroupMsg","chats","mutations","initChats","chatsData","forEach","chat","messages","msg","loadStatus","openChat","chatInfo","getters","findChats","idx","type","targetId","commit","showName","headImage","lastContent","lastSendTime","Date","getTime","unreadCount","atMe","atAll","stored","delete","unshift","resetUnreadCount","readedMessage","pos","findChatByFriend","friendId","m","id","selfSend","status","RECALL","maxId","READED","removeChat","removePrivateChat","removeGroupChat","groupId","moveTop","isLoading","splice","insertMessage","msgInfo","findChat","message","findMessage","Object","assign","content","IMAGE","FILE","AUDIO","ACT_RT_VOICE","ACT_RT_VIDEO","TEXT","TIP_TEXT","sendTime","sendNickName","atUserIds","userId","userInfo","indexOf","lastTimeTip","push","TIP_TIME","insertPos","length","console","log","updateMessage","deleteMessage","updateChatFromFriend","friend","headImageThumb","nickName","updateChatFromGroup","group","findChatByGroup","showGroupName","loading","refreshChats","sort","chat1","chat2","saveToStorage","key","chatKeys","chatKey","removeItem","setItem","filter","clear","actions","loadChat","context","Promise","resolve","reject","getItem","then","promises","all","o","catch","e","findChatIdx","recvId","sendId","fid","find","gid","tmpId"],"sources":["/home/d/github/box-im/im-web/src/store/chatStore.js"],"sourcesContent":["import { MESSAGE_TYPE, MESSAGE_STATUS } from \"../api/enums.js\"\nimport userStore from './userStore';\nimport localForage from 'localforage';\n\n/* 为了加速拉取离线消息效率，拉取时消息暂时存储到cacheChats,等\n待所有离线消息拉取完成后，再统一放至vuex中进行渲染*/\nlet cacheChats = [];\n\nexport default {\n\tstate: {\n\t\tactiveChat: null,\n\t\tprivateMsgMaxId: 0,\n\t\tgroupMsgMaxId: 0,\n\t\tloadingPrivateMsg: false,\n\t\tloadingGroupMsg: false,\n\t\tchats: []\n\t},\n\n\tmutations: {\n\t\tinitChats(state, chatsData) {\n\t\t\tstate.chats = [];\n\t\t\tstate.privateMsgMaxId = chatsData.privateMsgMaxId || 0;\n\t\t\tstate.groupMsgMaxId = chatsData.groupMsgMaxId || 0;\n\t\t\tcacheChats = chatsData.chats || [];\n\t\t\t// 防止图片一直处在加载中状态\n\t\t\tcacheChats.forEach((chat) => {\n\t\t\t\tchat.messages.forEach((msg) => {\n\t\t\t\t\tif (msg.loadStatus == \"loading\") {\n\t\t\t\t\t\tmsg.loadStatus = \"fail\"\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t},\n\t\topenChat(state, chatInfo) {\n\t\t\tlet chats = this.getters.findChats()\n\t\t\tlet chat = null;\n\t\t\tfor (let idx in chats) {\n\t\t\t\tif (chats[idx].type == chatInfo.type &&\n\t\t\t\t\tchats[idx].targetId === chatInfo.targetId) {\n\t\t\t\t\tchat = chats[idx];\n\t\t\t\t\t// 放置头部\n\t\t\t\t\tthis.commit(\"moveTop\", idx)\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// 创建会话\n\t\t\tif (chat == null) {\n\t\t\t\tchat = {\n\t\t\t\t\ttargetId: chatInfo.targetId,\n\t\t\t\t\ttype: chatInfo.type,\n\t\t\t\t\tshowName: chatInfo.showName,\n\t\t\t\t\theadImage: chatInfo.headImage,\n\t\t\t\t\tlastContent: \"\",\n\t\t\t\t\tlastSendTime: new Date().getTime(),\n\t\t\t\t\tunreadCount: 0,\n\t\t\t\t\tmessages: [],\n\t\t\t\t\tatMe: false,\n\t\t\t\t\tatAll: false,\n\t\t\t\t\tstored: false,\n\t\t\t\t\tdelete: false\n\t\t\t\t};\n\t\t\t\tchats.unshift(chat);\n\t\t\t}\n\t\t},\n\t\tactiveChat(state, idx) {\n\t\t\tlet chats = this.getters.findChats();\n\t\t\tstate.activeChat = chats[idx];\n\t\t},\n\t\tresetUnreadCount(state, chatInfo) {\n\t\t\tlet chats = this.getters.findChats();\n\t\t\tfor (let idx in chats) {\n\t\t\t\tif (chats[idx].type == chatInfo.type &&\n\t\t\t\t\tchats[idx].targetId == chatInfo.targetId) {\n\t\t\t\t\tchats[idx].unreadCount = 0;\n\t\t\t\t\tchats[idx].atMe = false;\n\t\t\t\t\tchats[idx].atAll = false;\n\t\t\t\t\tchats[idx].stored = false;\n\t\t\t\t\tthis.commit(\"saveToStorage\");\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\treadedMessage(state, pos) {\n\t\t\tlet chat = this.getters.findChatByFriend(pos.friendId);\n\t\t\tchat.messages.forEach((m) => {\n\t\t\t\tif (m.id && m.selfSend && m.status < MESSAGE_STATUS.RECALL) {\n\t\t\t\t\t// pos.maxId为空表示整个会话已读\n\t\t\t\t\tif (!pos.maxId || m.id <= pos.maxId) {\n\t\t\t\t\t\tm.status = MESSAGE_STATUS.READED\n\t\t\t\t\t\tchat.stored = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\tthis.commit(\"saveToStorage\");\n\t\t},\n\t\tremoveChat(state, idx) {\n\t\t\tlet chats = this.getters.findChats();\n\t\t\tif (chats[idx] == state.activeChat) {\n\t\t\t\tstate.activeChat = null;\n\t\t\t}\n\t\t\tchats[idx].delete = true;\n\t\t\tchats[idx].stored = false;\n\t\t\tthis.commit(\"saveToStorage\");\n\t\t},\n\t\tremovePrivateChat(state, friendId) {\n\t\t\tlet chats = this.getters.findChats();\n\t\t\tfor (let idx in chats) {\n\t\t\t\tif (chats[idx].type == 'PRIVATE' &&\n\t\t\t\t\tchats[idx].targetId === friendId) {\n\t\t\t\t\tthis.commit(\"removeChat\", idx)\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tremoveGroupChat(state, groupId) {\n\t\t\tlet chats = this.getters.findChats();\n\t\t\tfor (let idx in chats) {\n\t\t\t\tif (chats[idx].type == 'GROUP' &&\n\t\t\t\t\tchats[idx].targetId === groupId) {\n\t\t\t\t\tthis.commit(\"removeChat\", idx)\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmoveTop(state, idx) {\n\t\t\t// 加载中不移动，很耗性能\n\t\t\tif (this.getters.isLoading()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (idx > 0) {\n\t\t\t\tlet chats = this.getters.findChats();\n\t\t\t\tlet chat = chats[idx];\n\t\t\t\tchats.splice(idx, 1);\n\t\t\t\tchats.unshift(chat);\n\t\t\t\tchat.lastSendTime = new Date().getTime();\n\t\t\t\tchat.stored = false;\n\t\t\t\tthis.commit(\"saveToStorage\");\n\t\t\t}\n\t\t},\n\t\tinsertMessage(state, msgInfo) {\n\t\t\tlet type = msgInfo.groupId ? 'GROUP' : 'PRIVATE';\n\t\t\t// 记录消息的最大id\n\t\t\tif (msgInfo.id && type == \"PRIVATE\" && msgInfo.id > state.privateMsgMaxId) {\n\t\t\t\tstate.privateMsgMaxId = msgInfo.id;\n\t\t\t}\n\t\t\tif (msgInfo.id && type == \"GROUP\" && msgInfo.id > state.groupMsgMaxId) {\n\t\t\t\tstate.groupMsgMaxId = msgInfo.id;\n\t\t\t}\n\t\t\t// 如果是已存在消息，则覆盖旧的消息数据\n\t\t\tlet chat = this.getters.findChat(msgInfo);\n\t\t\tlet message = this.getters.findMessage(chat, msgInfo);\n\t\t\tif (message) {\n\t\t\t\tObject.assign(message, msgInfo);\n\t\t\t\t// 撤回消息需要显示\n\t\t\t\tif (msgInfo.type == MESSAGE_TYPE.RECALL) {\n\t\t\t\t\tchat.lastContent = msgInfo.content;\n\t\t\t\t}\n\t\t\t\tchat.stored = false;\n\t\t\t\tthis.commit(\"saveToStorage\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// 插入新的数据\n\t\t\tif (msgInfo.type == MESSAGE_TYPE.IMAGE) {\n\t\t\t\tchat.lastContent = \"[图片]\";\n\t\t\t} else if (msgInfo.type == MESSAGE_TYPE.FILE) {\n\t\t\t\tchat.lastContent = \"[文件]\";\n\t\t\t} else if (msgInfo.type == MESSAGE_TYPE.AUDIO) {\n\t\t\t\tchat.lastContent = \"[语音]\";\n\t\t\t} else if (msgInfo.type == MESSAGE_TYPE.ACT_RT_VOICE) {\n\t\t\t\tchat.lastContent = \"[语音通话]\";\n\t\t\t} else if (msgInfo.type == MESSAGE_TYPE.ACT_RT_VIDEO) {\n\t\t\t\tchat.lastContent = \"[视频通话]\";\n\t\t\t} else if (msgInfo.type == MESSAGE_TYPE.TEXT ||\n\t\t\t\tmsgInfo.type == MESSAGE_TYPE.RECALL ||\n\t\t\t\tmsgInfo.type == MESSAGE_TYPE.TIP_TEXT) {\n\t\t\t\tchat.lastContent = msgInfo.content;\n\t\t\t}\n\t\t\tchat.lastSendTime = msgInfo.sendTime;\n\t\t\tchat.sendNickName = msgInfo.sendNickName;\n\t\t\t// 未读加1\n\t\t\tif (!msgInfo.selfSend && msgInfo.status != MESSAGE_STATUS.READED && msgInfo.type != MESSAGE_TYPE.TIP_TEXT) {\n\t\t\t\tchat.unreadCount++;\n\t\t\t}\n\t\t\t// 是否有人@我\n\t\t\tif (!msgInfo.selfSend && chat.type == \"GROUP\" && msgInfo.atUserIds &&\n\t\t\t\tmsgInfo.status != MESSAGE_STATUS.READED) {\n\t\t\t\tlet userId = userStore.state.userInfo.id;\n\t\t\t\tif (msgInfo.atUserIds.indexOf(userId) >= 0) {\n\t\t\t\t\tchat.atMe = true;\n\t\t\t\t}\n\t\t\t\tif (msgInfo.atUserIds.indexOf(-1) >= 0) {\n\t\t\t\t\tchat.atAll = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// 间隔大于10分钟插入时间显示\n\t\t\tif (!chat.lastTimeTip || (chat.lastTimeTip < msgInfo.sendTime - 600 * 1000)) {\n\t\t\t\tchat.messages.push({\n\t\t\t\t\tsendTime: msgInfo.sendTime,\n\t\t\t\t\ttype: MESSAGE_TYPE.TIP_TIME,\n\t\t\t\t});\n\t\t\t\tchat.lastTimeTip = msgInfo.sendTime;\n\t\t\t}\n\t\t\t// 根据id顺序插入，防止消息乱序\n\t\t\tlet insertPos = chat.messages.length;\n\t\t\t// 防止 图片、文件 在发送方 显示 在顶端  因为还没存库，id=0\n\t\t\tif (msgInfo.id && msgInfo.id > 0) {\n\t\t\t\tfor (let idx in chat.messages) {\n\t\t\t\t\tif (chat.messages[idx].id && msgInfo.id < chat.messages[idx].id) {\n\t\t\t\t\t\tinsertPos = idx;\n\t\t\t\t\t\tconsole.log(`消息出现乱序,位置:${chat.messages.length},修正至:${insertPos}`);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tchat.messages.splice(insertPos, 0, msgInfo);\n\t\t\tchat.stored = false;\n\t\t\tthis.commit(\"saveToStorage\");\n\t\t},\n\t\tupdateMessage(state, msgInfo) {\n\t\t\t// 获取对方id或群id\n\t\t\tlet chat = this.getters.findChat(msgInfo);\n\t\t\tlet message = this.getters.findMessage(chat, msgInfo);\n\t\t\tif (message) {\n\t\t\t\t// 属性拷贝\n\t\t\t\tObject.assign(message, msgInfo);\n\t\t\t\tchat.stored = false;\n\t\t\t\tthis.commit(\"saveToStorage\");\n\t\t\t}\n\t\t},\n\t\tdeleteMessage(state, msgInfo) {\n\t\t\tlet chat = this.getters.findChat(msgInfo);\n\t\t\tfor (let idx in chat.messages) {\n\t\t\t\t// 已经发送成功的，根据id删除\n\t\t\t\tif (chat.messages[idx].id && chat.messages[idx].id == msgInfo.id) {\n\t\t\t\t\tchat.messages.splice(idx, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// 正在发送中的消息可能没有id，根据发送时间删除\n\t\t\t\tif (msgInfo.selfSend && chat.messages[idx].selfSend &&\n\t\t\t\t\tchat.messages[idx].sendTime == msgInfo.sendTime) {\n\t\t\t\t\tchat.messages.splice(idx, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tchat.stored = false;\n\t\t\tthis.commit(\"saveToStorage\");\n\t\t},\n\t\tupdateChatFromFriend(state, friend) {\n\t\t\tlet chat = this.getters.findChatByFriend(friend.id);\n\t\t\t// 更新会话中的群名和头像\n\t\t\tif (chat && (chat.headImage != friend.headImageThumb ||\n\t\t\t\t\tchat.showName != friend.nickName)) {\n\t\t\t\tchat.headImage = friend.headImageThumb;\n\t\t\t\tchat.showName = friend.nickName;\n\t\t\t\tchat.stored = false;\n\t\t\t\tthis.commit(\"saveToStorage\")\n\t\t\t}\n\t\t},\n\t\tupdateChatFromGroup(state, group) {\n\t\t\tlet chat = this.getters.findChatByGroup(group.id);\n\t\t\tif (chat && (chat.headImage != group.headImageThumb ||\n\t\t\t\t\tchat.showName != group.showGroupName)) {\n\t\t\t\t// 更新会话中的群名称和头像\n\t\t\t\tchat.headImage = group.headImageThumb;\n\t\t\t\tchat.showName = group.showGroupName;\n\t\t\t\tchat.stored = false;\n\t\t\t\tthis.commit(\"saveToStorage\")\n\t\t\t}\n\t\t},\n\t\tloadingPrivateMsg(state, loading) {\n\t\t\tstate.loadingPrivateMsg = loading;\n\t\t\tif (!this.getters.isLoading()) {\n\t\t\t\tthis.commit(\"refreshChats\")\n\t\t\t}\n\t\t},\n\t\tloadingGroupMsg(state, loading) {\n\t\t\tstate.loadingGroupMsg = loading;\n\t\t\tif (!this.getters.isLoading()) {\n\t\t\t\tthis.commit(\"refreshChats\")\n\t\t\t}\n\t\t},\n\t\trefreshChats(state) {\n\t\t\t// 排序\n\t\t\tcacheChats.sort((chat1, chat2) => {\n\t\t\t\treturn chat2.lastSendTime - chat1.lastSendTime;\n\t\t\t});\n\t\t\t// 将消息一次性装载回来\n\t\t\tstate.chats = cacheChats;\n\t\t\t// 断线重连后不能使用缓存模式，否则会导致聊天窗口的消息不刷新\n\t\t\tcacheChats = state.chats;\n\t\t\tthis.commit(\"saveToStorage\");\n\t\t},\n\t\tsaveToStorage(state) {\n\t\t\t// 加载中不保存，防止卡顿\n\t\t\tif (this.getters.isLoading()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet userId = userStore.state.userInfo.id;\n\t\t\tlet key = \"chats-\" + userId;\n\t\t\tlet chatKeys = [];\n\t\t\t// 按会话为单位存储，\n\t\t\tstate.chats.forEach((chat) => {\n\t\t\t\t// 只存储有改动的会话\n\t\t\t\tlet chatKey = `${key}-${chat.type}-${chat.targetId}`\n\t\t\t\tif (!chat.stored) {\n\t\t\t\t\tconsole.log(chatKey)\n\t\t\t\t\tif (chat.delete) {\n\t\t\t\t\t\tlocalForage.removeItem(chatKey);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlocalForage.setItem(chatKey, chat);\n\t\t\t\t\t}\n\t\t\t\t\tchat.stored = true;\n\t\t\t\t}\n\t\t\t\tif (!chat.delete) {\n\t\t\t\t\tchatKeys.push(chatKey);\n\t\t\t\t}\n\t\t\t})\n\t\t\t// 会话核心信息\n\t\t\tlet chatsData = {\n\t\t\t\tprivateMsgMaxId: state.privateMsgMaxId,\n\t\t\t\tgroupMsgMaxId: state.groupMsgMaxId,\n\t\t\t\tchatKeys: chatKeys\n\t\t\t}\n\t\t\tlocalForage.setItem(key, chatsData)\n\t\t\t// 清理已删除的会话\n\t\t\tstate.chats = state.chats.filter(chat => !chat.delete)\n\t\t},\n\t\tclear(state) {\n\t\t\tcacheChats = []\n\t\t\tstate.chats = [];\n\t\t\tstate.activeChat = null;\n\t\t}\n\t},\n\tactions: {\n\t\tloadChat(context) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tlet userId = userStore.state.userInfo.id;\n\t\t\t\tlet key = \"chats-\" + userId;\n\t\t\t\tlocalForage.getItem(key).then((chatsData) => {\n\t\t\t\t\tif (!chatsData) {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else if (chatsData.chats) {\n\t\t\t\t\t\t// 兼容旧版本\n\t\t\t\t\t\tcontext.commit(\"initChats\", chatsData);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else if (chatsData.chatKeys) {\n\t\t\t\t\t\tconst promises = [];\n\t\t\t\t\t\tchatsData.chatKeys.forEach(key => {\n\t\t\t\t\t\t\tpromises.push(localForage.getItem(key))\n\t\t\t\t\t\t})\n\t\t\t\t\t\tPromise.all(promises).then(chats => {\n\t\t\t\t\t\t\tchatsData.chats = chats.filter(o => o);\n\t\t\t\t\t\t\tcontext.commit(\"initChats\", chatsData);\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}).catch((e) => {\n\t\t\t\t\tconsole.log(\"加载消息失败\")\n\t\t\t\t\treject();\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t},\n\tgetters: {\n\t\tisLoading: (state) => () => {\n\t\t\treturn state.loadingPrivateMsg || state.loadingGroupMsg\n\t\t},\n\t\tfindChats: (state, getters) => () => {\n\t\t\treturn getters.isLoading() ? cacheChats : state.chats;\n\t\t},\n\t\tfindChatIdx: (state, getters) => (chat) => {\n\t\t\tlet chats = getters.findChats();\n\t\t\tfor (let idx in chats) {\n\t\t\t\tif (chats[idx].type == chat.type &&\n\t\t\t\t\tchats[idx].targetId === chat.targetId) {\n\t\t\t\t\tchat = chats[idx];\n\t\t\t\t\treturn idx\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tfindChat: (state, getters) => (msgInfo) => {\n\t\t\tlet chats = getters.findChats();\n\t\t\t// 获取对方id或群id\n\t\t\tlet type = msgInfo.groupId ? 'GROUP' : 'PRIVATE';\n\t\t\tlet targetId = msgInfo.groupId ? msgInfo.groupId : msgInfo.selfSend ? msgInfo.recvId : msgInfo.sendId;\n\t\t\tlet chat = null;\n\t\t\tfor (let idx in chats) {\n\t\t\t\tif (chats[idx].type == type &&\n\t\t\t\t\tchats[idx].targetId === targetId) {\n\t\t\t\t\tchat = chats[idx];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn chat;\n\t\t},\n\t\tfindChatByFriend: (state, getters) => (fid) => {\n\t\t\tlet chats = getters.findChats();\n\t\t\treturn chats.find(chat => chat.type == 'PRIVATE' &&\n\t\t\t\tchat.targetId == fid)\n\t\t},\n\t\tfindChatByGroup: (state, getters) => (gid) => {\n\t\t\tlet chats = getters.findChats();\n\t\t\treturn chats.find(chat => chat.type == 'GROUP' &&\n\t\t\t\tchat.targetId == gid)\n\t\t},\n\t\tfindMessage: (state) => (chat, msgInfo) => {\n\t\t\tif (!chat) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tfor (let idx in chat.messages) {\n\t\t\t\t// 通过id判断\n\t\t\t\tif (msgInfo.id && chat.messages[idx].id == msgInfo.id) {\n\t\t\t\t\treturn chat.messages[idx];\n\t\t\t\t}\n\t\t\t\t// 正在发送中的消息可能没有id,只有tmpId\n\t\t\t\tif (msgInfo.tmpId && chat.messages[idx].tmpId &&\n\t\t\t\t\tchat.messages[idx].tmpId == msgInfo.tmpId) {\n\t\t\t\t\treturn chat.messages[idx];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}"],"mappings":"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","ignoreList":[]}]}