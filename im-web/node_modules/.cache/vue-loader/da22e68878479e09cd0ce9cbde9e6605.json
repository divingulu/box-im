{"remainingRequest":"/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/d/github/box-im/im-web/src/components/chat/ChatGroupReaded.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/d/github/box-im/im-web/src/components/chat/ChatGroupReaded.vue","mtime":1727013808920},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js","mtime":1727014166227},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js","mtime":1727014163811}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBDaGF0R3JvdXBNZW1iZXIgZnJvbSAiLi9DaGF0R3JvdXBNZW1iZXIudnVlIjsKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJjaGF0R3JvdXBSZWFkZWQiLAogICAgY29tcG9uZW50czogewogICAgICAgIENoYXRHcm91cE1lbWJlcgogICAgfSwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc2hvdzogZmFsc2UsCiAgICAgICAgICAgIHBvczogewogICAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgICAgICBhcnJvd1k6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVhZGVkTWVtYmVyczogW10sCiAgICAgICAgICAgIHVucmVhZE1lbWJlcnM6IFtdCiAgICAgICAgfQogICAgfSwKICAgIHByb3BzOiB7CiAgICAgICAgZ3JvdXBNZW1iZXJzOiB7CiAgICAgICAgICAgIHR5cGU6IEFycmF5CiAgICAgICAgfSwKCQltc2dJbmZvOiB7CgkJCXR5cGU6IE9iamVjdAoJCX0KICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgY2xvc2UoKSB7CiAgICAgICAgICAgIHRoaXMuc2hvdyA9IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAgb3BlbihyZWN0KSB7CiAgICAgICAgICAgIHRoaXMuc2hvdyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMucG9zLmFycm93WSA9IDIwMDsKICAgICAgICAgICAgLy8g6K6h566X56qX5Y+j5L2N572uCiAgICAgICAgICAgIGlmICh0aGlzLm1zZ0luZm8uc2VsZlNlbmQpIHsKICAgICAgICAgICAgICAgIC8vIOiHquW3seWPkeeahOa2iOaBr+W8ueWHuuWcqOa2iOaBr+eahOW3pui+uQogICAgICAgICAgICAgICAgdGhpcy5wb3MueCA9IHJlY3QubGVmdCAtIDMxMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIOWIq+S6uuWPkeeahOa2iOaBr+W8ueeql+WcqOa2iOaBr+WPs+i+uQogICAgICAgICAgICAgICAgdGhpcy5wb3MueCA9IHJlY3QucmlnaHQgKyAyMDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnBvcy55ID0gcmVjdC50b3AgKyByZWN0LmhlaWdodCAvIDIgLSAyMTU7CiAgICAgICAgICAgIC8vIOmYsuatoueql+WPo+a6ouWHugogICAgICAgICAgICBpZiAodGhpcy5wb3MueSA8IDApIHsKICAgICAgICAgICAgICAgIHRoaXMucG9zLmFycm93WSArPSB0aGlzLnBvcy55CiAgICAgICAgICAgICAgICB0aGlzLnBvcy55ID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmxvYWRSZWFkZWRVc2VyKCkKICAgICAgICB9LAogICAgICAgIGxvYWRSZWFkZWRVc2VyKCkgewogICAgICAgICAgICB0aGlzLnJlYWRlZE1lbWJlcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy51bnJlYWRNZW1iZXJzID0gW107CiAgICAgICAgICAgIHRoaXMuJGh0dHAoewogICAgICAgICAgICAgICAgdXJsOiAiL21lc3NhZ2UvZ3JvdXAvZmluZFJlYWRlZFVzZXJzIiwKICAgICAgICAgICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgICAgICAgICBwYXJhbXM6IHsgZ3JvdXBJZDogdGhpcy5tc2dJbmZvLmdyb3VwSWQsIG1lc3NhZ2VJZDogdGhpcy5tc2dJbmZvLmlkIH0KICAgICAgICAgICAgfSkudGhlbih1c2VySWRzID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBNZW1iZXJzLmZvckVhY2gobWVtYmVyID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyDlj5HpgIHogIXlkozlt7LpgIDnvqTnmoTkuI3mmL7npLoKICAgICAgICAgICAgICAgICAgICBpZiAobWVtYmVyLnVzZXJJZCA9PSB0aGlzLm1zZ0luZm8uc2VuZElkIHx8IG1lbWJlci5xdWl0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8g5Yy65YiG5bey6K+76L+Y5piv5pyq6K+7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJJZHMuZmluZCh1c2VySWQgPT4gbWVtYmVyLnVzZXJJZCA9PSB1c2VySWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVhZGVkTWVtYmVycy5wdXNoKG1lbWJlcik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5yZWFkTWVtYmVycy5wdXNoKG1lbWJlcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKCQkJCS8vIOabtOaWsOW3suivu+S6uuaVsAoJCQkJdGhpcy4kc3RvcmUuY29tbWl0KCJ1cGRhdGVNZXNzYWdlIiwgewoJCQkJICAgIGlkOiB0aGlzLm1zZ0luZm8uaWQsCgkJCQkgICAgZ3JvdXBJZDogdGhpcy5tc2dJbmZvLmdyb3VwSWQsCgkJCQkgICAgcmVhZGVkQ291bnQ6IHRoaXMucmVhZGVkTWVtYmVycy5sZW5ndGgKCQkJCX0pCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQp9Cg=="},{"version":3,"sources":["ChatGroupReaded.vue"],"names":[],"mappings":";AAoCA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ChatGroupReaded.vue","sourceRoot":"src/components/chat","sourcesContent":["<template>\n    <div v-show=\"show\">\n        <div class=\"chat-group-readed-mask\" @click.self=\"close()\">\n            <div class=\"chat-group-readed\" :style=\"{ 'left': pos.x + 'px', 'top': pos.y + 'px' }\" @click.prevent=\"\">\n                <el-tabs type=\"border-card\" :stretch=\"true\">\n                    <el-tab-pane :label=\"`已读(${readedMembers.length})`\">\n                        <el-scrollbar class=\"scroll-box\">\n                            <div v-for=\"(member) in readedMembers\" :key=\"member.id\">\n                                <chat-group-member :member=\"member\"></chat-group-member>\n                            </div>\n                        </el-scrollbar>\n                    </el-tab-pane>\n                    <el-tab-pane :label=\"`未读(${unreadMembers.length})`\">\n                        <el-scrollbar class=\"scroll-box\">\n                            <div v-for=\"(member) in unreadMembers\" :key=\"member.id\">\n                                <chat-group-member :member=\"member\"></chat-group-member>\n                            </div>\n                        </el-scrollbar>\n                    </el-tab-pane>\n                </el-tabs>\n                <div v-show=\"msgInfo.selfSend\" class=\"arrow-right\" :style=\"{ 'top': pos.arrowY + 'px' }\">\n                    <div class=\"arrow-right-inner\">\n                    </div>\n                </div>\n                <div v-show=\"!msgInfo.selfSend\" class=\"arrow-left\" :style=\"{ 'top': pos.arrowY + 'px' }\">\n                    <div class=\"arrow-left-inner\">\n                    </div>\n                </div>\n            </div>\n        </div>\n\n    </div>\n</template>\n\n\n<script>\nimport ChatGroupMember from \"./ChatGroupMember.vue\";\n\nexport default {\n    name: \"chatGroupReaded\",\n    components: {\n        ChatGroupMember\n    },\n    data() {\n        return {\n            show: false,\n            pos: {\n                x: 0,\n                y: 0,\n                arrowY: 0\n            },\n            readedMembers: [],\n            unreadMembers: []\n        }\n    },\n    props: {\n        groupMembers: {\n            type: Array\n        },\n\t\tmsgInfo: {\n\t\t\ttype: Object\n\t\t}\n    },\n    methods: {\n        close() {\n            this.show = false;\n        },\n        open(rect) {\n            this.show = true;\n            this.pos.arrowY = 200;\n            // 计算窗口位置\n            if (this.msgInfo.selfSend) {\n                // 自己发的消息弹出在消息的左边\n                this.pos.x = rect.left - 310;\n            } else {\n                // 别人发的消息弹窗在消息右边\n                this.pos.x = rect.right + 20;\n            }\n            this.pos.y = rect.top + rect.height / 2 - 215;\n            // 防止窗口溢出\n            if (this.pos.y < 0) {\n                this.pos.arrowY += this.pos.y\n                this.pos.y = 0;\n            }\n            this.loadReadedUser()\n        },\n        loadReadedUser() {\n            this.readedMembers = [];\n            this.unreadMembers = [];\n            this.$http({\n                url: \"/message/group/findReadedUsers\",\n                method: 'get',\n                params: { groupId: this.msgInfo.groupId, messageId: this.msgInfo.id }\n            }).then(userIds => {\n                this.groupMembers.forEach(member => {\n                    // 发送者和已退群的不显示\n                    if (member.userId == this.msgInfo.sendId || member.quit) {\n                        return;\n                    }\n                    // 区分已读还是未读\n                    if (userIds.find(userId => member.userId == userId)) {\n                        this.readedMembers.push(member);\n                    } else  {\n                        this.unreadMembers.push(member);\n                    }\n                })\n\t\t\t\t// 更新已读人数\n\t\t\t\tthis.$store.commit(\"updateMessage\", {\n\t\t\t\t    id: this.msgInfo.id,\n\t\t\t\t    groupId: this.msgInfo.groupId,\n\t\t\t\t    readedCount: this.readedMembers.length\n\t\t\t\t})\n            })\n        }\n    }\n}\n</script>\n\n<style lang=\"scss\">\n.chat-group-readed-mask {\n    position: fixed;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 9999;\n}\n\n.chat-group-readed {\n    position: fixed;\n    box-shadow: 0px 0px 10px #ccc;\n    width: 300px;\n    background-color: #fafafa;\n    border-radius: 8px;\n\n    .scroll-box {\n        height: 400px;\n    }\n\n    .arrow-left {\n\n        position: absolute;\n        left: -15px;\n        width: 0;\n        height: 0;\n        border-top: 15px solid transparent;\n        border-bottom: 15px solid transparent;\n        border-right: 15px solid #ccc;\n\n        .arrow-left-inner {\n            position: absolute;\n            top: -12px;\n            left: 3px;\n            width: 0;\n            height: 0;\n            overflow: hidden;\n            border-top: 12px solid transparent;\n            border-bottom: 12px solid transparent;\n            border-right: 12px solid white;\n        }\n    }\n\n    .arrow-right {\n        position: absolute;\n        right: -15px;\n        width: 0;\n        height: 0;\n        border-top: 15px solid transparent;\n        border-bottom: 15px solid transparent;\n        border-left: 15px solid #ccc;\n\n        .arrow-right-inner {\n            position: absolute;\n            top: -12px;\n            right: 3px;\n            width: 0;\n            height: 0;\n            overflow: hidden;\n            border-top: 12px solid transparent;\n            border-bottom: 12px solid transparent;\n            border-left: 12px solid white;\n        }\n    }\n}\n</style>"]}]}