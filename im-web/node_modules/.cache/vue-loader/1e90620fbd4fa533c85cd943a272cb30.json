{"remainingRequest":"/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/d/github/box-im/im-web/src/components/rtc/RtcPrivateVideo.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/d/github/box-im/im-web/src/components/rtc/RtcPrivateVideo.vue","mtime":1727013808920},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js","mtime":1727014166227},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js","mtime":1727014163811}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CglpbXBvcnQgSGVhZEltYWdlIGZyb20gJy4uL2NvbW1vbi9IZWFkSW1hZ2UudnVlJzsKCWltcG9ydCBSdGNQcml2YXRlQWNjZXB0b3IgZnJvbSAnLi9SdGNQcml2YXRlQWNjZXB0b3IudnVlJzsKCWltcG9ydCBJbVdlYlJ0YyBmcm9tICdAL2FwaS93ZWJydGMnOwoJaW1wb3J0IEltQ2FtZXJhIGZyb20gJ0AvYXBpL2NhbWVyYSc7CglpbXBvcnQgUnRjUHJpdmF0ZUFwaSBmcm9tICdAL2FwaS9ydGNQcml2YXRlQXBpJwoKCWV4cG9ydCBkZWZhdWx0IHsKCQluYW1lOiAncnRjUHJpdmF0ZVZpZGVvJywKCQljb21wb25lbnRzOiB7CgkJCUhlYWRJbWFnZSwKCQkJUnRjUHJpdmF0ZUFjY2VwdG9yCgkJfSwKCQlkYXRhKCkgewoJCQlyZXR1cm4gewoJCQkJY2FtZXJhOiBuZXcgSW1DYW1lcmEoKSwgLy8g5pGE5YOP5aS05ZKM6bqm5YWL6aOOCgkJCQl3ZWJydGM6IG5ldyBJbVdlYlJ0YygpLCAvLyB3ZWJydGPnm7jlhbMKCQkJCUFQSTogbmV3IFJ0Y1ByaXZhdGVBcGkoKSwgLy8gQVBJCgkJCQlhdWRpbzogbmV3IEF1ZGlvKCksIC8vIOWRvOWPq+mfs+mikQoJCQkJc2hvd1Jvb206IGZhbHNlLAoJCQkJZnJpZW5kOiB7fSwKCQkJCWlzSG9zdDogZmFsc2UsIC8vIOaYr+WQpuWPkei1t+S6ugoJCQkJc3RhdGU6ICJDTE9TRSIsIC8vIENMT1NFOuWFs+mXrSAgV0FJVElORzrnrYnlvoXlkbzlj6vmiJbmjqXlkKwgQ0hBVElORzrogYrlpKnkuK0gIEVSUk9SOuWHuueOsOW8guW4uAoJCQkJbW9kZTogJ3ZpZGVvJywgLy8g5qih5byPIHZpZGVvOuinhumikeiBiiB2b2ljZTror63pn7PogYrlpKkKCQkJCWxvY2FsU3RyZWFtOiBudWxsLCAvLyDmnKzlnLDop4bpopHmtYEKCQkJCXJlbW90ZVN0cmVhbTogbnVsbCwgLy8g5a+55pa56KeG6aKR5rWBCgkJCQl2aWRlb1RpbWU6IDAsCgkJCQl2aWRlb1RpbWVyOiBudWxsLAoJCQkJaGVhcnRiZWF0VGltZXI6IG51bGwsCgkJCQljYW5kaWRhdGVzOiBbXSwKCQkJfQoJCX0sCgkJbWV0aG9kczogewoJCQlvcGVuKHJ0Y0luZm8pIHsKCQkJCXRoaXMuc2hvd1Jvb20gPSB0cnVlOwoJCQkJdGhpcy5tb2RlID0gcnRjSW5mby5tb2RlOwoJCQkJdGhpcy5pc0hvc3QgPSBydGNJbmZvLmlzSG9zdDsKCQkJCXRoaXMuZnJpZW5kID0gcnRjSW5mby5mcmllbmQ7CgkJCQlpZiAodGhpcy5pc0hvc3QpIHsKCQkJCQl0aGlzLm9uQ2FsbCgpOwoJCQkJfQoJCQl9LAoJCQlpbml0QXVkaW8oKSB7CgkJCQlsZXQgdXJsID0gcmVxdWlyZShgQC9hc3NldHMvYXVkaW8vY2FsbC53YXZgKTsKCQkJCXRoaXMuYXVkaW8uc3JjID0gdXJsOwoJCQkJdGhpcy5hdWRpby5sb29wID0gdHJ1ZTsKCQkJfSwKCQkJaW5pdFJ0YygpIHsKCQkJCXRoaXMud2VicnRjLmluaXQodGhpcy5jb25maWd1cmF0aW9uKQoJCQkJdGhpcy53ZWJydGMuc2V0dXBQZWVyQ29ubmVjdGlvbigoc3RyZWFtKSA9PiB7CgkJCQkJdGhpcy4kcmVmcy5yZW1vdGVWaWRlby5zcmNPYmplY3QgPSBzdHJlYW07CgkJCQkJdGhpcy5yZW1vdGVTdHJlYW0gPSBzdHJlYW07CgkJCQl9KQoJCQkJLy8g55uR5ZCs5YCZ6YCJ5L+h5oGvCgkJCQl0aGlzLndlYnJ0Yy5vbkljZWNhbmRpZGF0ZSgoY2FuZGlkYXRlKSA9PiB7CgkJCQkJaWYgKHRoaXMuc3RhdGUgPT0gIkNIQVRJTkciKSB7CgkJCQkJCS8vIOi/nuaOpeW3suWwsee7qiznm7TmjqXlj5HpgIEKCQkJCQkJdGhpcy5BUEkuc2VuZENhbmRpZGF0ZSh0aGlzLmZyaWVuZC5pZCwgY2FuZGlkYXRlKTsKCQkJCQl9IGVsc2UgewoJCQkJCQkvLyDov57mjqXmnKrlsLHnu6os57yT5a2Y6LW35p2l77yM6L+e5o6l5ZCO5YaN5Y+R6YCBCgkJCQkJCXRoaXMuY2FuZGlkYXRlcy5wdXNoKGNhbmRpZGF0ZSkKCQkJCQl9CgkJCQl9KQoJCQkJLy8g55uR5ZCs6L+e5o6l5oiQ5Yqf54q25oCBCgkJCQl0aGlzLndlYnJ0Yy5vblN0YXRlQ2hhbmdlKChzdGF0ZSkgPT4gewoJCQkJCWlmIChzdGF0ZSA9PSAiY29ubmVjdGVkIikgewoJCQkJCQljb25zb2xlLmxvZygid2VicnRj6L+e5o6l5oiQ5YqfIikKCQkJCQl9IGVsc2UgaWYgKHN0YXRlID09ICJkaXNjb25uZWN0ZWQiKSB7CgkJCQkJCWNvbnNvbGUubG9nKCJ3ZWJydGPov57mjqXmlq3lvIAiKQoJCQkJCX0KCQkJCX0pCgkJCX0sCgkJCW9uQ2FsbCgpIHsKCQkJCWlmICghdGhpcy5jaGVja0RldkVuYWJsZSgpKSB7CgkJCQkJdGhpcy5jbG9zZSgpOwoJCQkJfQoJCQkJLy8g5Yid5aeL5YyWd2VicnRjCgkJCQl0aGlzLmluaXRSdGMoKTsKCQkJCS8vIOWQr+WKqOW/g+i3swoJCQkJdGhpcy5zdGFydEhlYXJ0QmVhdCgpOwoJCQkJLy8g5omT5byA5pGE5YOP5aS0CgkJCQl0aGlzLm9wZW5TdHJlYW0oKS50aGVuKCgpID0+IHsKCQkJCQl0aGlzLndlYnJ0Yy5zZXRTdHJlYW0odGhpcy5sb2NhbFN0cmVhbSk7CgkJCQkJdGhpcy53ZWJydGMuY3JlYXRlT2ZmZXIoKS50aGVuKChvZmZlcikgPT4gewoJCQkJCQkvLyDlj5Hotbflkbzlj6sKCQkJCQkJdGhpcy5BUEkuY2FsbCh0aGlzLmZyaWVuZC5pZCwgdGhpcy5tb2RlLCBvZmZlcikudGhlbigoKSA9PiB7CgkJCQkJCQkvLyDnm7TmjqXov5vlhaXogYrlpKnnirbmgIEKCQkJCQkJCXRoaXMuc3RhdGUgPSAiV0FJVElORyI7CgkJCQkJCQkvLyDmkq3mlL7lkbzlj6vpk4Plo7AKCQkJCQkJCXRoaXMuYXVkaW8ucGxheSgpOwoJCQkJCQl9KS5jYXRjaCgoKT0+ewoJCQkJCQkJdGhpcy5jbG9zZSgpOwoJCQkJCQl9KQoJCQkJCX0pCgkJCQl9KS5jYXRjaCgoKT0+ewoJCQkJCS8vIOWRvOWPq+aWueW/hemhu+iDveaJk+W8gOaRhOWDj+WktO+8jOWQpuWImeaXoOazleato+W4uOW7uueri+i/nuaOpQoJCQkJCXRoaXMuY2xvc2UoKTsKCQkJCX0pCgkJCX0sCgkJCW9uQWNjZXB0KCkgewoJCQkJaWYgKCF0aGlzLmNoZWNrRGV2RW5hYmxlKCkpIHsKCQkJCQl0aGlzLkFQSS5mYWlsZWQodGhpcy5mcmllbmQuaWQsICLlr7nmlrnorr7lpIfkuI3mlK/mjIHpgJror50iKQoJCQkJCXRoaXMuY2xvc2UoKTsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQkvLyDov5vlhaXmiL/pl7QKCQkJCXRoaXMuc2hvd1Jvb20gPSB0cnVlOwoJCQkJdGhpcy5zdGF0ZSA9ICJDSEFUSU5HIjsKCQkJCS8vIOWBnOatouWRvOWPq+mTg+WjsAoJCQkJdGhpcy5hdWRpby5wYXVzZSgpOwoJCQkJLy8g5Yid5aeL5YyWd2VicnRjCgkJCQl0aGlzLmluaXRSdGMoKTsKCQkJCS8vIOaJk+W8gOaRhOWDj+WktAoJCQkJdGhpcy5vcGVuU3RyZWFtKCkuZmluYWxseSgoKSA9PiB7CgkJCQkJdGhpcy53ZWJydGMuc2V0U3RyZWFtKHRoaXMubG9jYWxTdHJlYW0pOwoJCQkJCXRoaXMud2VicnRjLmNyZWF0ZUFuc3dlcih0aGlzLm9mZmVyKS50aGVuKChhbnN3ZXIpID0+IHsKCQkJCQkJdGhpcy5BUEkuYWNjZXB0KHRoaXMuZnJpZW5kLmlkLCBhbnN3ZXIpOwoJCQkJCQkvLyDorrDlvZXml7bplb8KCQkJCQkJdGhpcy5zdGFydENoYXRUaW1lKCk7CgkJCQkJCS8vIOa4heeQhuWumuaXtuWZqAoJCQkJCQl0aGlzLndhaXRUaW1lciAmJiBjbGVhclRpbWVvdXQodGhpcy53YWl0VGltZXIpOwoJCQkJCX0pCgkJCQl9KQoJCQl9LAoJCQlvblJlamVjdCgpIHsKCQkJCWNvbnNvbGUubG9nKCJvblJlamVjdCIpCgkJCQkvLyDpgIDlh7rpgJror50KCQkJCXRoaXMuQVBJLnJlamVjdCh0aGlzLmZyaWVuZC5pZCk7CgkJCQkvLyDpgIDlh7oKCQkJCXRoaXMuY2xvc2UoKTsKCQkJfSwKCQkJb25IYW5kdXAoKSB7CgkJCQl0aGlzLkFQSS5oYW5kdXAodGhpcy5mcmllbmQuaWQpCgkJCQl0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuaCqOW3suaMguaWrSzpgJror53nu5PmnZ8iKQoJCQkJdGhpcy5jbG9zZSgpOwoJCQl9LAoJCQlvbkNhbmNlbCgpIHsKCQkJCXRoaXMuQVBJLmNhbmNlbCh0aGlzLmZyaWVuZC5pZCkKCQkJCXRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5bey5Y+W5raI5ZG85Y+rLOmAmuivnee7k+adnyIpCgkJCQl0aGlzLmNsb3NlKCk7CgkJCX0sCgkJCW9uUlRDTWVzc2FnZShtc2cpIHsKCQkJCS8vIOmZpOS6huWPkei1t+mAmuivne+8jOWmguaenOWcqOWFs+mXreeKtuaAgeWwseaXoOmcgOWkhOeQhgoJCQkJaWYgKG1zZy50eXBlICE9IHRoaXMuJGVudW1zLk1FU1NBR0VfVFlQRS5SVENfQ0FMTF9WT0lDRSAmJgoJCQkJCW1zZy50eXBlICE9IHRoaXMuJGVudW1zLk1FU1NBR0VfVFlQRS5SVENfQ0FMTF9WSURFTyAmJgoJCQkJCXRoaXMuaXNDbG9zZSkgewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCS8vIFJUQ+S/oeS7pOWkhOeQhgoJCQkJc3dpdGNoIChtc2cudHlwZSkgewoJCQkJCWNhc2UgdGhpcy4kZW51bXMuTUVTU0FHRV9UWVBFLlJUQ19DQUxMX1ZPSUNFOgoJCQkJCQl0aGlzLm9uUlRDQ2FsbChtc2csICd2b2ljZScpCgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgdGhpcy4kZW51bXMuTUVTU0FHRV9UWVBFLlJUQ19DQUxMX1ZJREVPOgoJCQkJCQl0aGlzLm9uUlRDQ2FsbChtc2csICd2aWRlbycpCgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgdGhpcy4kZW51bXMuTUVTU0FHRV9UWVBFLlJUQ19BQ0NFUFQ6CgkJCQkJCXRoaXMub25SVENBY2NlcHQobXNnKQoJCQkJCQlicmVhazsKCQkJCQljYXNlIHRoaXMuJGVudW1zLk1FU1NBR0VfVFlQRS5SVENfUkVKRUNUOgoJCQkJCQl0aGlzLm9uUlRDUmVqZWN0KG1zZykKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSB0aGlzLiRlbnVtcy5NRVNTQUdFX1RZUEUuUlRDX0NBTkNFTDoKCQkJCQkJdGhpcy5vblJUQ0NhbmNlbChtc2cpCgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgdGhpcy4kZW51bXMuTUVTU0FHRV9UWVBFLlJUQ19GQUlMRUQ6CgkJCQkJCXRoaXMub25SVENGYWlsZWQobXNnKQoJCQkJCQlicmVhazsKCQkJCQljYXNlIHRoaXMuJGVudW1zLk1FU1NBR0VfVFlQRS5SVENfSEFORFVQOgoJCQkJCQl0aGlzLm9uUlRDSGFuZHVwKG1zZykKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSB0aGlzLiRlbnVtcy5NRVNTQUdFX1RZUEUuUlRDX0NBTkRJREFURToKCQkJCQkJdGhpcy5vblJUQ0NhbmRpZGF0ZShtc2cpCgkJCQkJCWJyZWFrOwoJCQkJfQoJCQl9LAoJCQlvblJUQ0NhbGwobXNnLCBtb2RlKSB7CgkJCQl0aGlzLm9mZmVyID0gSlNPTi5wYXJzZShtc2cuY29udGVudCk7CgkJCQl0aGlzLmlzSG9zdCA9IGZhbHNlOwoJCQkJdGhpcy5tb2RlID0gbW9kZTsKCQkJCXRoaXMuJGh0dHAoewoJCQkJCXVybDogYC9mcmllbmQvZmluZC8ke21zZy5zZW5kSWR9YCwKCQkJCQltZXRob2Q6ICdnZXQnCgkJCQl9KS50aGVuKChmcmllbmQpID0+IHsKCQkJCQl0aGlzLmZyaWVuZCA9IGZyaWVuZDsKCQkJCQl0aGlzLnN0YXRlID0gIldBSVRJTkciOwoJCQkJCXRoaXMuYXVkaW8ucGxheSgpOwoJCQkJCXRoaXMuc3RhcnRIZWFydEJlYXQoKTsKCQkJCQkvLyAzMHPmnKrmjqXlkKzoh6rliqjmjILmjokKCQkJCQl0aGlzLndhaXRUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gewoJCQkJCQl0aGlzLkFQSS5mYWlsZWQodGhpcy5mcmllbmQuaWQsIuWvueaWueaXoOW6lOetlCIpOwoJCQkJCQl0aGlzLiRtZXNzYWdlLmVycm9yKCLmgqjmnKrmjqXlkKwiKTsKCQkJCQkJdGhpcy5jbG9zZSgpOwoJCQkJCX0sIDMwMDAwKQoJCQkJfSkKCQkJfSwKCQkJb25SVENBY2NlcHQobXNnKSB7CgkJCQlpZiAobXNnLnNlbGZTZW5kKSB7CgkJCQkJLy8g5Zyo5YW25LuW6K6+5aSH5o6l5ZCsCgkJCQkJdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLlt7LlnKjlhbbku5borr7lpIfmjqXlkKwiKTsKCQkJCQl0aGlzLmNsb3NlKCk7CgkJCQl9IGVsc2UgewoJCQkJCS8vIOWvueaWueaOpeWPl+S6hueahOmAmuivnQoJCQkJCWxldCBvZmZlciA9IEpTT04ucGFyc2UobXNnLmNvbnRlbnQpOwoJCQkJCXRoaXMud2VicnRjLnNldFJlbW90ZURlc2NyaXB0aW9uKG9mZmVyKTsKCQkJCQkvLyDnirbmgIHkuLrogYrlpKnkuK0KCQkJCQl0aGlzLnN0YXRlID0gJ0NIQVRJTkcnCgkJCQkJLy8g5YGc5q2i5pKt5pS+6K+t6Z+zCgkJCQkJdGhpcy5hdWRpby5wYXVzZSgpOwoJCQkJCS8vIOWPkemAgWNhbmRpZGF0ZQoJCQkJCXRoaXMuY2FuZGlkYXRlcy5mb3JFYWNoKChjYW5kaWRhdGUpID0+IHsKCQkJCQkJdGhpcy5BUEkuc2VuZENhbmRpZGF0ZSh0aGlzLmZyaWVuZC5pZCwgY2FuZGlkYXRlKTsKCQkJCQl9KQoJCQkJCQoJCQkJfQoJCQl9LAoJCQlvblJUQ1JlamVjdChtc2cpIHsKCQkJCWlmIChtc2cuc2VsZlNlbmQpIHsKCQkJCQl0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuW3suWcqOWFtuS7luiuvuWkh+aLkue7nSIpOwoJCQkJCXRoaXMuY2xvc2UoKTsKCQkJCX0gZWxzZSB7CgkJCQkJdGhpcy4kbWVzc2FnZS5lcnJvcigi5a+55pa55ouS57ud5LqG5oKo55qE6YCa6K+d6K+35rGCIik7CgkJCQkJdGhpcy5jbG9zZSgpOwoJCQkJfQoJCQl9LAoJCQlvblJUQ0ZhaWxlZChtc2cpIHsKCQkJCS8vIOWRvOWPq+Wksei0pQoJCQkJdGhpcy4kbWVzc2FnZS5lcnJvcihtc2cuY29udGVudCkKCQkJCXRoaXMuY2xvc2UoKTsKCQkJfSwKCQkJb25SVENDYW5jZWwoKSB7CgkJCQkvLyDlr7nmlrnlj5bmtojpgJror50KCQkJCXRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5a+55pa55Y+W5raI5LqG5ZG85Y+rIik7CgkJCQl0aGlzLmNsb3NlKCk7CgkJCX0sCgkJCW9uUlRDSGFuZHVwKCkgewoJCQkJLy8g5a+55pa55oyC5patCgkJCQl0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuWvueaWueW3suaMguaWrSIpOwoJCQkJdGhpcy5jbG9zZSgpOwoJCQl9LAoJCQlvblJUQ0NhbmRpZGF0ZShtc2cpIHsKCQkJCWxldCBjYW5kaWRhdGUgPSBKU09OLnBhcnNlKG1zZy5jb250ZW50KTsKCQkJCXRoaXMud2VicnRjLmFkZEljZUNhbmRpZGF0ZShjYW5kaWRhdGUpOwoJCQl9LAoKCQkJb3BlblN0cmVhbSgpIHsKCQkJCXJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CgkJCQkJaWYgKHRoaXMuaXNWaWRlbykgewoJCQkJCQkvLyDmiZPlvIDmkYTlg4/lpLQr6bqm5YWL6aOOCgkJCQkJCXRoaXMuY2FtZXJhLm9wZW5WaWRlbygpLnRoZW4oKHN0cmVhbSkgPT4gewoJCQkJCQkJdGhpcy5sb2NhbFN0cmVhbSA9IHN0cmVhbTsKCQkJCQkJCXRoaXMuJG5leHRUaWNrKCgpID0+IHsKCQkJCQkJCQl0aGlzLiRyZWZzLmxvY2FsVmlkZW8uc3JjT2JqZWN0ID0gc3RyZWFtOwoJCQkJCQkJCXRoaXMuJHJlZnMubG9jYWxWaWRlby5tdXRlZCA9IHRydWU7CgkJCQkJCQl9KQoJCQkJCQkJcmVzb2x2ZShzdHJlYW0pOwoJCQkJCQl9KS5jYXRjaCgoZSkgPT4gewoJCQkJCQkJdGhpcy4kbWVzc2FnZS5lcnJvcigi5omT5byA5pGE5YOP5aS05aSx6LSlIikKCQkJCQkJCWNvbnNvbGUubG9nKCLmnKzmkYTlg4/lpLTmiZPlvIDlpLHotKU6IiArIGUubWVzc2FnZSkKCQkJCQkJCXJlamVjdChlKTsKCQkJCQkJfSkKCQkJCQl9IGVsc2UgewoJCQkJCQkvLyDmiZPlvIDpuqblhYvpo44KCQkJCQkJdGhpcy5jYW1lcmEub3BlbkF1ZGlvKCkudGhlbigoc3RyZWFtKSA9PiB7CgkJCQkJCQl0aGlzLmxvY2FsU3RyZWFtID0gc3RyZWFtOwoJCQkJCQkJdGhpcy4kcmVmcy5sb2NhbFZpZGVvLnNyY09iamVjdCA9IHN0cmVhbTsKCQkJCQkJCXJlc29sdmUoc3RyZWFtKTsKCQkJCQkJfSkuY2F0Y2goKGUpID0+IHsKCQkJCQkJCXRoaXMuJG1lc3NhZ2UuZXJyb3IoIuaJk+W8gOm6puWFi+mjjuWksei0pSIpCgkJCQkJCQljb25zb2xlLmxvZygi5omT5byA6bqm5YWL6aOO5aSx6LSlOiIgKyBlLm1lc3NhZ2UpCgkJCQkJCQlyZWplY3QoZSk7CgkJCQkJCX0pCgkJCQkJfQoJCQkJfSkKCQkJfSwKCQkJc3RhcnRDaGF0VGltZSgpIHsKCQkJCXRoaXMudmlkZW9UaW1lID0gMDsKCQkJCXRoaXMudmlkZW9UaW1lciAmJiBjbGVhckludGVydmFsKHRoaXMudmlkZW9UaW1lcik7CgkJCQl0aGlzLnZpZGVvVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CgkJCQkJdGhpcy52aWRlb1RpbWUrKzsKCQkJCX0sIDEwMDApCgkJCX0sCgkJCWNoZWNrRGV2RW5hYmxlKCkgewoJCQkJLy8g5qOA5rWL5pGE5YOP5aS0CgkJCQlpZiAoIXRoaXMuY2FtZXJhLmlzRW5hYmxlKCkpIHsKCQkJCQl0aGlzLm1lc3NhZ2UuZXJyb3IoIuiuv+mXruaRhOWDj+WktOWksei0pSIpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJCS8vIOajgOa1i3dlYnJ0YwoJCQkJaWYgKCF0aGlzLndlYnJ0Yy5pc0VuYWJsZSgpKSB7CgkJCQkJdGhpcy5tZXNzYWdlLmVycm9yKCLliJ3lp4vljJZSVEPlpLHotKXvvIzljp/lm6Dlj6/og73mmK86IDEu5pyN5Yqh5Zmo57y65bCRc3Ns6K+B5LmmIDIu5oKo55qE6K6+5aSH5LiN5pSv5oyBV2ViUlRDIik7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQkJcmV0dXJuIHRydWU7CgkJCX0sCgkJCXN0YXJ0SGVhcnRCZWF0KCkgewoJCQkJLy8g5q+PMTVz5o6o6YCB5LiA5qyh5b+D6LezCgkJCQl0aGlzLmhlYXJ0YmVhdFRpbWVyICYmIGNsZWFySW50ZXJ2YWwodGhpcy5oZWFydGJlYXRUaW1lcik7CgkJCQl0aGlzLmhlYXJ0YmVhdFRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gewoJCQkJCXRoaXMuQVBJLmhlYXJ0YmVhdCh0aGlzLmZyaWVuZC5pZCk7CgkJCQl9LCAxNTAwMCkKCQkJfSwKCQkJY2xvc2UoKSB7CgkJCQl0aGlzLnNob3dSb29tID0gZmFsc2U7CgkJCQl0aGlzLmNhbWVyYS5jbG9zZSgpOwoJCQkJdGhpcy53ZWJydGMuY2xvc2UoKTsKCQkJCXRoaXMuYXVkaW8ucGF1c2UoKTsKCQkJCXRoaXMudmlkZW9UaW1lID0gMDsKCQkJCXRoaXMudmlkZW9UaW1lciAmJiBjbGVhckludGVydmFsKHRoaXMudmlkZW9UaW1lcik7CgkJCQl0aGlzLmhlYXJ0YmVhdFRpbWVyICYmIGNsZWFySW50ZXJ2YWwodGhpcy5oZWFydGJlYXRUaW1lcik7CgkJCQl0aGlzLndhaXRUaW1lciAmJiBjbGVhclRpbWVvdXQodGhpcy53YWl0VGltZXIpOwoJCQkJdGhpcy52aWRlb1RpbWVyID0gbnVsbDsKCQkJCXRoaXMuaGVhcnRiZWF0VGltZXIgPSBudWxsOwoJCQkJdGhpcy53YWl0VGltZXIgPSBudWxsOwoJCQkJdGhpcy5zdGF0ZSA9ICdDTE9TRSc7CgkJCQl0aGlzLmNhbmRpZGF0ZXMgPSBbXTsKCQkJfSwKCQkJb25RdWl0KCkgewoJCQkJaWYgKHRoaXMuaXNDaGF0aW5nKSB7CgkJCQkJdGhpcy5vbkhhbmR1cCgpCgkJCQl9IGVsc2UgaWYgKHRoaXMuaXNXYWl0aW5nKSB7CgkJCQkJdGhpcy5vbkNhbmNlbCgpOwoJCQkJfSBlbHNlIHsKCQkJCQl0aGlzLmNsb3NlKCk7CgkJCQl9CgkJCX0KCQl9LAoJCWNvbXB1dGVkOiB7CgkJCXRpdGxlKCkgewoJCQkJbGV0IHN0clRpdGxlID0gYCR7dGhpcy5tb2RlVGV4dH3pgJror50tJHt0aGlzLmZyaWVuZC5uaWNrTmFtZX1gOwoJCQkJaWYgKHRoaXMuaXNDaGF0aW5nKSB7CgkJCQkJc3RyVGl0bGUgKz0gYCgke3RoaXMuY3VycmVudFRpbWV9KWA7CgkJCQl9IGVsc2UgaWYgKHRoaXMuaXNXYWl0aW5nKSB7CgkJCQkJc3RyVGl0bGUgKz0gYCjlkbzlj6vkuK0pYDsKCQkJCX0KCQkJCXJldHVybiBzdHJUaXRsZTsKCQkJfSwKCQkJY3VycmVudFRpbWUoKSB7CgkJCQlsZXQgbWluID0gTWF0aC5mbG9vcih0aGlzLnZpZGVvVGltZSAvIDYwKTsKCQkJCWxldCBzZWMgPSB0aGlzLnZpZGVvVGltZSAlIDYwOwoJCQkJbGV0IHN0clRpbWUgPSBtaW4gPCAxMCA/ICIwIiA6ICIiOwoJCQkJc3RyVGltZSArPSBtaW47CgkJCQlzdHJUaW1lICs9ICI6IgoJCQkJc3RyVGltZSArPSBzZWMgPCAxMCA/ICIwIiA6ICIiOwoJCQkJc3RyVGltZSArPSBzZWM7CgkJCQlyZXR1cm4gc3RyVGltZTsKCQkJfSwKCQkJY29uZmlndXJhdGlvbigpIHsKCQkJCWNvbnN0IGljZVNlcnZlcnMgPSB0aGlzLiRzdG9yZS5zdGF0ZS5jb25maWdTdG9yZS53ZWJydGMuaWNlU2VydmVyczsKCQkJCXJldHVybiB7CgkJCQkJaWNlU2VydmVyczogaWNlU2VydmVycwoJCQkJfQoJCQl9LAoJCQlpc1ZpZGVvKCkgewoJCQkJcmV0dXJuIHRoaXMubW9kZSA9PSAidmlkZW8iCgkJCX0sCgkJCW1vZGVUZXh0KCkgewoJCQkJcmV0dXJuIHRoaXMuaXNWaWRlbyA/ICLop4bpopEiIDogIuivremfsyI7CgkJCX0sCgkJCWlzQ2hhdGluZygpIHsKCQkJCXJldHVybiB0aGlzLnN0YXRlID09ICJDSEFUSU5HIjsKCQkJfSwKCQkJaXNXYWl0aW5nKCkgewoJCQkJcmV0dXJuIHRoaXMuc3RhdGUgPT0gIldBSVRJTkciOwoJCQl9LAoJCQlpc0Nsb3NlKCkgewoJCQkJcmV0dXJuIHRoaXMuc3RhdGUgPT0gIkNMT1NFIjsKCQkJfQoJCX0sCgkJbW91bnRlZCgpIHsKCQkJLy8g5Yid5aeL5YyW6Z+z6aKR5paH5Lu2CgkJCXRoaXMuaW5pdEF1ZGlvKCk7CgkJfSwKCQljcmVhdGVkKCkgewoJCQkvLyDnm5HlkKzpobXpnaLliLfmlrDkuovku7YKCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsICgpID0+IHsKCQkJCXRoaXMub25RdWl0KCk7CgkJCX0pOwoJCX0sCgkJYmVmb3JlVW5tb3VudCgpIHsKCQkJdGhpcy5vblF1aXQoKTsKCQl9Cgl9Cg=="},{"version":3,"sources":["RtcPrivateVideo.vue"],"names":[],"mappings":";AAoCA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RtcPrivateVideo.vue","sourceRoot":"src/components/rtc","sourcesContent":["<template>\n\t<div>\n\t\t<el-dialog v-dialogDrag :title=\"title\" top=\"5vh\" :close-on-click-modal=\"false\" :close-on-press-escape=\"false\"\n\t\t\t:visible.sync=\"showRoom\" width=\"50%\" height=\"70%\" :before-close=\"onQuit\">\n\t\t\t<div class=\"rtc-private-video\">\n\t\t\t\t<div v-show=\"isVideo\" class=\"rtc-video-box\">\n\t\t\t\t\t<div class=\"rtc-video-friend\" v-loading=\"!isChating\"  element-loading-text=\"等待对方接听...\"\n\t\t\t\t\t\telement-loading-background=\"rgba(0, 0, 0, 0.3)\" >\n\t\t\t\t\t\t<head-image class=\"friend-head-image\" :id=\"friend.id\" :size=\"80\" :name=\"friend.nickName\"\n\t\t\t\t\t\t\t:url=\"friend.headImage\">\n\t\t\t\t\t\t</head-image>\n\t\t\t\t\t\t<video ref=\"remoteVideo\" autoplay=\"\"></video>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"rtc-video-mine\">\n\t\t\t\t\t\t<video ref=\"localVideo\" autoplay=\"\"></video>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-show=\"!isVideo\" class=\"rtc-voice-box\" v-loading=\"!isChating\" element-loading-text=\"等待对方接听...\"\n\t\t\t\t\telement-loading-background=\"rgba(0, 0, 0, 0.3)\">\n\t\t\t\t\t<head-image class=\"friend-head-image\" :id=\"friend.id\" :size=\"200\" :name=\"friend.nickName\"\n\t\t\t\t\t\t:url=\"friend.headImage\">\n\t\t\t\t\t\t<div class=\"rtc-voice-name\">{{friend.nickName}}</div>\n\t\t\t\t\t</head-image>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"rtc-control-bar\">\n\t\t\t\t\t<div title=\"取消\" class=\"icon iconfont icon-phone-reject reject\"\n\t\t\t\t\t\tstyle=\"color: red;\" @click=\"onQuit()\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</el-dialog>\n\t\t<rtc-private-acceptor v-if=\"!isHost&&isWaiting\" ref=\"acceptor\" :friend=\"friend\" :mode=\"mode\" @accept=\"onAccept\"\n\t\t\t@reject=\"onReject\"></rtc-private-acceptor>\n\t</div>\n</template>\n\n<script>\n\timport HeadImage from '../common/HeadImage.vue';\n\timport RtcPrivateAcceptor from './RtcPrivateAcceptor.vue';\n\timport ImWebRtc from '@/api/webrtc';\n\timport ImCamera from '@/api/camera';\n\timport RtcPrivateApi from '@/api/rtcPrivateApi'\n\n\texport default {\n\t\tname: 'rtcPrivateVideo',\n\t\tcomponents: {\n\t\t\tHeadImage,\n\t\t\tRtcPrivateAcceptor\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tcamera: new ImCamera(), // 摄像头和麦克风\n\t\t\t\twebrtc: new ImWebRtc(), // webrtc相关\n\t\t\t\tAPI: new RtcPrivateApi(), // API\n\t\t\t\taudio: new Audio(), // 呼叫音频\n\t\t\t\tshowRoom: false,\n\t\t\t\tfriend: {},\n\t\t\t\tisHost: false, // 是否发起人\n\t\t\t\tstate: \"CLOSE\", // CLOSE:关闭  WAITING:等待呼叫或接听 CHATING:聊天中  ERROR:出现异常\n\t\t\t\tmode: 'video', // 模式 video:视频聊 voice:语音聊天\n\t\t\t\tlocalStream: null, // 本地视频流\n\t\t\t\tremoteStream: null, // 对方视频流\n\t\t\t\tvideoTime: 0,\n\t\t\t\tvideoTimer: null,\n\t\t\t\theartbeatTimer: null,\n\t\t\t\tcandidates: [],\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\topen(rtcInfo) {\n\t\t\t\tthis.showRoom = true;\n\t\t\t\tthis.mode = rtcInfo.mode;\n\t\t\t\tthis.isHost = rtcInfo.isHost;\n\t\t\t\tthis.friend = rtcInfo.friend;\n\t\t\t\tif (this.isHost) {\n\t\t\t\t\tthis.onCall();\n\t\t\t\t}\n\t\t\t},\n\t\t\tinitAudio() {\n\t\t\t\tlet url = require(`@/assets/audio/call.wav`);\n\t\t\t\tthis.audio.src = url;\n\t\t\t\tthis.audio.loop = true;\n\t\t\t},\n\t\t\tinitRtc() {\n\t\t\t\tthis.webrtc.init(this.configuration)\n\t\t\t\tthis.webrtc.setupPeerConnection((stream) => {\n\t\t\t\t\tthis.$refs.remoteVideo.srcObject = stream;\n\t\t\t\t\tthis.remoteStream = stream;\n\t\t\t\t})\n\t\t\t\t// 监听候选信息\n\t\t\t\tthis.webrtc.onIcecandidate((candidate) => {\n\t\t\t\t\tif (this.state == \"CHATING\") {\n\t\t\t\t\t\t// 连接已就绪,直接发送\n\t\t\t\t\t\tthis.API.sendCandidate(this.friend.id, candidate);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 连接未就绪,缓存起来，连接后再发送\n\t\t\t\t\t\tthis.candidates.push(candidate)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// 监听连接成功状态\n\t\t\t\tthis.webrtc.onStateChange((state) => {\n\t\t\t\t\tif (state == \"connected\") {\n\t\t\t\t\t\tconsole.log(\"webrtc连接成功\")\n\t\t\t\t\t} else if (state == \"disconnected\") {\n\t\t\t\t\t\tconsole.log(\"webrtc连接断开\")\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tonCall() {\n\t\t\t\tif (!this.checkDevEnable()) {\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t\t// 初始化webrtc\n\t\t\t\tthis.initRtc();\n\t\t\t\t// 启动心跳\n\t\t\t\tthis.startHeartBeat();\n\t\t\t\t// 打开摄像头\n\t\t\t\tthis.openStream().then(() => {\n\t\t\t\t\tthis.webrtc.setStream(this.localStream);\n\t\t\t\t\tthis.webrtc.createOffer().then((offer) => {\n\t\t\t\t\t\t// 发起呼叫\n\t\t\t\t\t\tthis.API.call(this.friend.id, this.mode, offer).then(() => {\n\t\t\t\t\t\t\t// 直接进入聊天状态\n\t\t\t\t\t\t\tthis.state = \"WAITING\";\n\t\t\t\t\t\t\t// 播放呼叫铃声\n\t\t\t\t\t\t\tthis.audio.play();\n\t\t\t\t\t\t}).catch(()=>{\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}).catch(()=>{\n\t\t\t\t\t// 呼叫方必须能打开摄像头，否则无法正常建立连接\n\t\t\t\t\tthis.close();\n\t\t\t\t})\n\t\t\t},\n\t\t\tonAccept() {\n\t\t\t\tif (!this.checkDevEnable()) {\n\t\t\t\t\tthis.API.failed(this.friend.id, \"对方设备不支持通话\")\n\t\t\t\t\tthis.close();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// 进入房间\n\t\t\t\tthis.showRoom = true;\n\t\t\t\tthis.state = \"CHATING\";\n\t\t\t\t// 停止呼叫铃声\n\t\t\t\tthis.audio.pause();\n\t\t\t\t// 初始化webrtc\n\t\t\t\tthis.initRtc();\n\t\t\t\t// 打开摄像头\n\t\t\t\tthis.openStream().finally(() => {\n\t\t\t\t\tthis.webrtc.setStream(this.localStream);\n\t\t\t\t\tthis.webrtc.createAnswer(this.offer).then((answer) => {\n\t\t\t\t\t\tthis.API.accept(this.friend.id, answer);\n\t\t\t\t\t\t// 记录时长\n\t\t\t\t\t\tthis.startChatTime();\n\t\t\t\t\t\t// 清理定时器\n\t\t\t\t\t\tthis.waitTimer && clearTimeout(this.waitTimer);\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t},\n\t\t\tonReject() {\n\t\t\t\tconsole.log(\"onReject\")\n\t\t\t\t// 退出通话\n\t\t\t\tthis.API.reject(this.friend.id);\n\t\t\t\t// 退出\n\t\t\t\tthis.close();\n\t\t\t},\n\t\t\tonHandup() {\n\t\t\t\tthis.API.handup(this.friend.id)\n\t\t\t\tthis.$message.success(\"您已挂断,通话结束\")\n\t\t\t\tthis.close();\n\t\t\t},\n\t\t\tonCancel() {\n\t\t\t\tthis.API.cancel(this.friend.id)\n\t\t\t\tthis.$message.success(\"已取消呼叫,通话结束\")\n\t\t\t\tthis.close();\n\t\t\t},\n\t\t\tonRTCMessage(msg) {\n\t\t\t\t// 除了发起通话，如果在关闭状态就无需处理\n\t\t\t\tif (msg.type != this.$enums.MESSAGE_TYPE.RTC_CALL_VOICE &&\n\t\t\t\t\tmsg.type != this.$enums.MESSAGE_TYPE.RTC_CALL_VIDEO &&\n\t\t\t\t\tthis.isClose) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// RTC信令处理\n\t\t\t\tswitch (msg.type) {\n\t\t\t\t\tcase this.$enums.MESSAGE_TYPE.RTC_CALL_VOICE:\n\t\t\t\t\t\tthis.onRTCCall(msg, 'voice')\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase this.$enums.MESSAGE_TYPE.RTC_CALL_VIDEO:\n\t\t\t\t\t\tthis.onRTCCall(msg, 'video')\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase this.$enums.MESSAGE_TYPE.RTC_ACCEPT:\n\t\t\t\t\t\tthis.onRTCAccept(msg)\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase this.$enums.MESSAGE_TYPE.RTC_REJECT:\n\t\t\t\t\t\tthis.onRTCReject(msg)\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase this.$enums.MESSAGE_TYPE.RTC_CANCEL:\n\t\t\t\t\t\tthis.onRTCCancel(msg)\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase this.$enums.MESSAGE_TYPE.RTC_FAILED:\n\t\t\t\t\t\tthis.onRTCFailed(msg)\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase this.$enums.MESSAGE_TYPE.RTC_HANDUP:\n\t\t\t\t\t\tthis.onRTCHandup(msg)\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase this.$enums.MESSAGE_TYPE.RTC_CANDIDATE:\n\t\t\t\t\t\tthis.onRTCCandidate(msg)\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonRTCCall(msg, mode) {\n\t\t\t\tthis.offer = JSON.parse(msg.content);\n\t\t\t\tthis.isHost = false;\n\t\t\t\tthis.mode = mode;\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: `/friend/find/${msg.sendId}`,\n\t\t\t\t\tmethod: 'get'\n\t\t\t\t}).then((friend) => {\n\t\t\t\t\tthis.friend = friend;\n\t\t\t\t\tthis.state = \"WAITING\";\n\t\t\t\t\tthis.audio.play();\n\t\t\t\t\tthis.startHeartBeat();\n\t\t\t\t\t// 30s未接听自动挂掉\n\t\t\t\t\tthis.waitTimer = setTimeout(() => {\n\t\t\t\t\t\tthis.API.failed(this.friend.id,\"对方无应答\");\n\t\t\t\t\t\tthis.$message.error(\"您未接听\");\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t}, 30000)\n\t\t\t\t})\n\t\t\t},\n\t\t\tonRTCAccept(msg) {\n\t\t\t\tif (msg.selfSend) {\n\t\t\t\t\t// 在其他设备接听\n\t\t\t\t\tthis.$message.success(\"已在其他设备接听\");\n\t\t\t\t\tthis.close();\n\t\t\t\t} else {\n\t\t\t\t\t// 对方接受了的通话\n\t\t\t\t\tlet offer = JSON.parse(msg.content);\n\t\t\t\t\tthis.webrtc.setRemoteDescription(offer);\n\t\t\t\t\t// 状态为聊天中\n\t\t\t\t\tthis.state = 'CHATING'\n\t\t\t\t\t// 停止播放语音\n\t\t\t\t\tthis.audio.pause();\n\t\t\t\t\t// 发送candidate\n\t\t\t\t\tthis.candidates.forEach((candidate) => {\n\t\t\t\t\t\tthis.API.sendCandidate(this.friend.id, candidate);\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t},\n\t\t\tonRTCReject(msg) {\n\t\t\t\tif (msg.selfSend) {\n\t\t\t\t\tthis.$message.success(\"已在其他设备拒绝\");\n\t\t\t\t\tthis.close();\n\t\t\t\t} else {\n\t\t\t\t\tthis.$message.error(\"对方拒绝了您的通话请求\");\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonRTCFailed(msg) {\n\t\t\t\t// 呼叫失败\n\t\t\t\tthis.$message.error(msg.content)\n\t\t\t\tthis.close();\n\t\t\t},\n\t\t\tonRTCCancel() {\n\t\t\t\t// 对方取消通话\n\t\t\t\tthis.$message.success(\"对方取消了呼叫\");\n\t\t\t\tthis.close();\n\t\t\t},\n\t\t\tonRTCHandup() {\n\t\t\t\t// 对方挂断\n\t\t\t\tthis.$message.success(\"对方已挂断\");\n\t\t\t\tthis.close();\n\t\t\t},\n\t\t\tonRTCCandidate(msg) {\n\t\t\t\tlet candidate = JSON.parse(msg.content);\n\t\t\t\tthis.webrtc.addIceCandidate(candidate);\n\t\t\t},\n\n\t\t\topenStream() {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tif (this.isVideo) {\n\t\t\t\t\t\t// 打开摄像头+麦克风\n\t\t\t\t\t\tthis.camera.openVideo().then((stream) => {\n\t\t\t\t\t\t\tthis.localStream = stream;\n\t\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\t\tthis.$refs.localVideo.srcObject = stream;\n\t\t\t\t\t\t\t\tthis.$refs.localVideo.muted = true;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tresolve(stream);\n\t\t\t\t\t\t}).catch((e) => {\n\t\t\t\t\t\t\tthis.$message.error(\"打开摄像头失败\")\n\t\t\t\t\t\t\tconsole.log(\"本摄像头打开失败:\" + e.message)\n\t\t\t\t\t\t\treject(e);\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 打开麦克风\n\t\t\t\t\t\tthis.camera.openAudio().then((stream) => {\n\t\t\t\t\t\t\tthis.localStream = stream;\n\t\t\t\t\t\t\tthis.$refs.localVideo.srcObject = stream;\n\t\t\t\t\t\t\tresolve(stream);\n\t\t\t\t\t\t}).catch((e) => {\n\t\t\t\t\t\t\tthis.$message.error(\"打开麦克风失败\")\n\t\t\t\t\t\t\tconsole.log(\"打开麦克风失败:\" + e.message)\n\t\t\t\t\t\t\treject(e);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tstartChatTime() {\n\t\t\t\tthis.videoTime = 0;\n\t\t\t\tthis.videoTimer && clearInterval(this.videoTimer);\n\t\t\t\tthis.videoTimer = setInterval(() => {\n\t\t\t\t\tthis.videoTime++;\n\t\t\t\t}, 1000)\n\t\t\t},\n\t\t\tcheckDevEnable() {\n\t\t\t\t// 检测摄像头\n\t\t\t\tif (!this.camera.isEnable()) {\n\t\t\t\t\tthis.message.error(\"访问摄像头失败\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t// 检测webrtc\n\t\t\t\tif (!this.webrtc.isEnable()) {\n\t\t\t\t\tthis.message.error(\"初始化RTC失败，原因可能是: 1.服务器缺少ssl证书 2.您的设备不支持WebRTC\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tstartHeartBeat() {\n\t\t\t\t// 每15s推送一次心跳\n\t\t\t\tthis.heartbeatTimer && clearInterval(this.heartbeatTimer);\n\t\t\t\tthis.heartbeatTimer = setInterval(() => {\n\t\t\t\t\tthis.API.heartbeat(this.friend.id);\n\t\t\t\t}, 15000)\n\t\t\t},\n\t\t\tclose() {\n\t\t\t\tthis.showRoom = false;\n\t\t\t\tthis.camera.close();\n\t\t\t\tthis.webrtc.close();\n\t\t\t\tthis.audio.pause();\n\t\t\t\tthis.videoTime = 0;\n\t\t\t\tthis.videoTimer && clearInterval(this.videoTimer);\n\t\t\t\tthis.heartbeatTimer && clearInterval(this.heartbeatTimer);\n\t\t\t\tthis.waitTimer && clearTimeout(this.waitTimer);\n\t\t\t\tthis.videoTimer = null;\n\t\t\t\tthis.heartbeatTimer = null;\n\t\t\t\tthis.waitTimer = null;\n\t\t\t\tthis.state = 'CLOSE';\n\t\t\t\tthis.candidates = [];\n\t\t\t},\n\t\t\tonQuit() {\n\t\t\t\tif (this.isChating) {\n\t\t\t\t\tthis.onHandup()\n\t\t\t\t} else if (this.isWaiting) {\n\t\t\t\t\tthis.onCancel();\n\t\t\t\t} else {\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\ttitle() {\n\t\t\t\tlet strTitle = `${this.modeText}通话-${this.friend.nickName}`;\n\t\t\t\tif (this.isChating) {\n\t\t\t\t\tstrTitle += `(${this.currentTime})`;\n\t\t\t\t} else if (this.isWaiting) {\n\t\t\t\t\tstrTitle += `(呼叫中)`;\n\t\t\t\t}\n\t\t\t\treturn strTitle;\n\t\t\t},\n\t\t\tcurrentTime() {\n\t\t\t\tlet min = Math.floor(this.videoTime / 60);\n\t\t\t\tlet sec = this.videoTime % 60;\n\t\t\t\tlet strTime = min < 10 ? \"0\" : \"\";\n\t\t\t\tstrTime += min;\n\t\t\t\tstrTime += \":\"\n\t\t\t\tstrTime += sec < 10 ? \"0\" : \"\";\n\t\t\t\tstrTime += sec;\n\t\t\t\treturn strTime;\n\t\t\t},\n\t\t\tconfiguration() {\n\t\t\t\tconst iceServers = this.$store.state.configStore.webrtc.iceServers;\n\t\t\t\treturn {\n\t\t\t\t\ticeServers: iceServers\n\t\t\t\t}\n\t\t\t},\n\t\t\tisVideo() {\n\t\t\t\treturn this.mode == \"video\"\n\t\t\t},\n\t\t\tmodeText() {\n\t\t\t\treturn this.isVideo ? \"视频\" : \"语音\";\n\t\t\t},\n\t\t\tisChating() {\n\t\t\t\treturn this.state == \"CHATING\";\n\t\t\t},\n\t\t\tisWaiting() {\n\t\t\t\treturn this.state == \"WAITING\";\n\t\t\t},\n\t\t\tisClose() {\n\t\t\t\treturn this.state == \"CLOSE\";\n\t\t\t}\n\t\t},\n\t\tmounted() {\n\t\t\t// 初始化音频文件\n\t\t\tthis.initAudio();\n\t\t},\n\t\tcreated() {\n\t\t\t// 监听页面刷新事件\n\t\t\twindow.addEventListener('beforeunload', () => {\n\t\t\t\tthis.onQuit();\n\t\t\t});\n\t\t},\n\t\tbeforeUnmount() {\n\t\t\tthis.onQuit();\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.rtc-private-video {\n\t\tposition: relative;\n\n\t\t.el-loading-text {\n\t\t\tcolor: white !important;\n\t\t\tfont-size: 16px !important;\n\t\t}\n\n\t\t.path {\n\t\t\tstroke: white !important;\n\t\t}\n\n\t\t.rtc-video-box {\n\t\t\tposition: relative;\n\t\t\tborder: #4880b9 solid 1px;\n\t\t\tbackground-color: #eeeeee;\n\n\t\t\t.rtc-video-friend {\n\t\t\t\theight: 70vh;\n\n\t\t\t\t.friend-head-image {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t}\n\n\t\t\t\tvideo {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tobject-fit: cover;\n\t\t\t\t\ttransform: rotateY(180deg);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t.rtc-video-mine {\n\t\t\t\tposition: absolute;\n\t\t\t\tz-index: 99999;\n\t\t\t\twidth: 25vh;\n\t\t\t\tright: 0;\n\t\t\t\tbottom: 0;\n\t\t\t\tbox-shadow: 0px 0px 5px #ccc;\n\t\t\t\tbackground-color: #cccccc;\n\n\t\t\t\tvideo {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tobject-fit: cover;\n\t\t\t\t\ttransform: rotateY(180deg);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t.rtc-voice-box {\n\t\t\tposition: relative;\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\tborder: #4880b9 solid 1px;\n\t\t\twidth: 100%;\n\t\t\theight: 50vh;\n\t\t\tpadding-top: 10vh;\n\t\t\tbackground-color: aliceblue;\n\n\t\t\t.rtc-voice-name {\n\t\t\t\ttext-align: center;\n\t\t\t\tfont-size: 22px;\n\t\t\t\tfont-weight: 600;\n\t\t\t}\n\t\t}\n\n\t\t.rtc-control-bar {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-around;\n\t\t\tpadding: 10px;\n\n\t\t\t.icon {\n\t\t\t\tfont-size: 50px;\n\t\t\t\tcursor: pointer;\n\t\t\t}\n\t\t}\n\t}\n</style>"]}]}