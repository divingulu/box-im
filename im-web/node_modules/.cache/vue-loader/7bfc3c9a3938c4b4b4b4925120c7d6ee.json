{"remainingRequest":"/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/d/github/box-im/im-web/src/components/chat/ChatRecord.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/d/github/box-im/im-web/src/components/chat/ChatRecord.vue","mtime":1727013808920},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js","mtime":1727014166227},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js","mtime":1727014163811}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CglpbXBvcnQgUmVjb3JkZXIgZnJvbSAnanMtYXVkaW8tcmVjb3JkZXInOwoKCWV4cG9ydCBkZWZhdWx0IHsKCQluYW1lOiAnY2hhdFJlY29yZCcsCgkJcHJvcHM6IHsKCQkJdmlzaWJsZTogewoJCQkJdHlwZTogQm9vbGVhbgoJCQl9CgkJfSwKCQlkYXRhKCkgewoJCQlyZXR1cm4gewoJCQkJcmM6IG5ldyBSZWNvcmRlcigpLAoJCQkJYXVkaW86IG5ldyBBdWRpbygpLAoJCQkJc3RhdGU6ICdTVE9QJywgLy8gU1RPUOOAgVJVTk5JTkfjgIFQQVVTReOAgUNPTVBMRVRFCgkJCQlzdGF0ZVRpcDogIuacquW8gOWniyIsCgkJCQltb2RlOiAnUkVDT1JEJywgLy8gUkVDT1JEIOOAgVBMQVkKCQkJCWR1cmF0aW9uOiAwLAoJCQkJdXJsOiAiIgoJCQl9CgkJfSwKCQltZXRob2RzOiB7CgkJCW9uQ2xvc2UoKSB7CgkJCQkvLyDlhbPpl63liY3muIXpmaTmlbDmja4KCQkJCXRoaXMucmMuZGVzdHJveSgpOwoJCQkJdGhpcy5yYyA9IG5ldyBSZWNvcmRlcigpOwoJCQkJdGhpcy5hdWRpby5wYXVzZSgpOwoJCQkJdGhpcy5tb2RlID0gJ1JFQ09SRCc7CgkJCQl0aGlzLnN0YXRlID0gJ1NUT1AnOwoJCQkJdGhpcy5zdGF0ZVRpcCA9ICfmnKrlvIDlp4snOwoJCQkJdGhpcy4kZW1pdCgiY2xvc2UiKTsKCQkJfSwKCQkJb25TdGFydFJlY29yZCgpIHsKCQkJCXRoaXMucmMuc3RhcnQoKS50aGVuKChzdHJlYW0pID0+IHsKCQkJCQl0aGlzLnN0YXRlID0gJ1JVTk5JTkcnOwoJCQkJCXRoaXMuc3RhdGVUaXAgPSAi5q2j5Zyo5b2V6Z+zLi4uIjsKCQkJCX0pLmNhdGNoKGVycm9yID0+IHsKCQkJCQl0aGlzLiRtZXNzYWdlLmVycm9yKGVycm9yKTsKCQkJCX0pOwoKCgkJCX0sCgkJCW9uUGF1c2VSZWNvcmQoKSB7CgkJCQl0aGlzLnJjLnBhdXNlKCk7CgkJCQl0aGlzLnN0YXRlID0gJ1BBVVNFJzsKCQkJCXRoaXMuc3RhdGVUaXAgPSAi5bey5pqC5YGc5b2V6Z+zIjsKCQkJfSwKCQkJb25SZXN1bWVSZWNvcmQoKSB7CgkJCQl0aGlzLnJjLnJlc3VtZSgpOwoJCQkJdGhpcy5zdGF0ZSA9ICdSVU5OSU5HJzsKCQkJCXRoaXMuc3RhdGVUaXAgPSAi5q2j5Zyo5b2V6Z+zLi4uIjsKCQkJfSwKCQkJb25Db21wbGV0ZVJlY29yZCgpIHsKCQkJCXRoaXMucmMucGF1c2UoKTsKCQkJCXRoaXMuc3RhdGUgPSAnQ09NUExFVEUnOwoJCQkJdGhpcy5zdGF0ZVRpcCA9ICLlt7Lnu5PmnZ/lvZXpn7MiOwoJCQl9LAoJCQlvblBsYXlBdWRpbygpIHsKCQkJCWxldCB3YXYgPSB0aGlzLnJjLmdldFdBVkJsb2IoKTsKCQkJCWxldCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKHdhdik7CgkJCQl0aGlzLiRyZWZzLmF1ZGlvLnNyYyA9IHVybDsKCQkJCXRoaXMuJHJlZnMuYXVkaW8ucGxheSgpOwoJCQkJdGhpcy5tb2RlID0gJ1BMQVknOwoJCQl9LAoJCQlvblN0b3BBdWRpbygpIHsKCQkJCXRoaXMuJHJlZnMuYXVkaW8ucGF1c2UoKTsKCQkJCXRoaXMubW9kZSA9ICdSRUNPUkQnOwoJCQl9LAoJCQlvblJlc3RhcnRSZWNvcmQoKSB7CgkJCQl0aGlzLnJjLmRlc3Ryb3koKTsKCQkJCXRoaXMucmMgPSBuZXcgUmVjb3JkZXIoKQoJCQkJdGhpcy5yYy5zdGFydCgpOwoJCQkJdGhpcy5zdGF0ZSA9ICdSVU5OSU5HJzsKCQkJCXRoaXMubW9kZSA9ICdSRUNPUkQnOwoJCQkJdGhpcy5zdGF0ZVRpcCA9ICLmraPlnKjlvZXpn7MuLi4iOwoJCQl9LAoJCQlvblNlbmRSZWNvcmQoKSB7CgkJCQlsZXQgd2F2ID0gdGhpcy5yYy5nZXRXQVZCbG9iKCk7CgkJCQlsZXQgbmFtZSA9IG5ldyBEYXRlKCkuZ2V0RGF0ZSgpICsgJy53YXYnOwoJCQkJdmFyIGZvcm1EYXRhID0gbmV3IHdpbmRvdy5Gb3JtRGF0YSgpCgkJCQlmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCB3YXYsIG5hbWUpOwoJCQkJdGhpcy4kaHR0cCh7CgkJCQkJdXJsOiAnL2ZpbGUvdXBsb2FkJywKCQkJCQlkYXRhOiBmb3JtRGF0YSwKCQkJCQltZXRob2Q6ICdwb3N0JywKCQkJCQloZWFkZXJzOiB7CgkJCQkJCSdDb250ZW50LVR5cGUnOiAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScKCQkJCQl9CgkJCQl9KS50aGVuKCh1cmwpID0+IHsKCQkJCQlsZXQgZGF0YSA9IHsKCQkJCQkJZHVyYXRpb246IHBhcnNlSW50KHRoaXMucmMuZHVyYXRpb24pLAoJCQkJCQl1cmw6IHVybAoJCQkJCX0KCQkJCQl0aGlzLiRlbWl0KCJzZW5kIiwgZGF0YSk7CgkJCQkJdGhpcy5vbkNsb3NlKCk7CgkJCQl9KQoJCQl9CgkJfQoKCX0K"},{"version":3,"sources":["ChatRecord.vue"],"names":[],"mappings":";AA0BA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"ChatRecord.vue","sourceRoot":"src/components/chat","sourcesContent":["<template>\n\t<el-dialog class=\"chat-record\" title=\"语音录制\" :visible.sync=\"visible\" width=\"600px\" :before-close=\"onClose\">\n\t\t<div v-show=\"mode=='RECORD'\">\n\t\t\t<div class=\"tip\">{{stateTip}}</div>\n\t\t\t<div>时长: {{state=='STOP'?0:parseInt(rc.duration)}}s</div>\n\t\t</div>\n\t\t<audio v-show=\"mode=='PLAY'\" :src=\"url\" controls ref=\"audio\" @ended=\"onStopAudio()\"></audio>\n\t\t<el-divider content-position=\"center\"></el-divider>\n\t\t<el-row class=\"btn-group\">\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='STOP'\" @click=\"onStartRecord()\">开始录音</el-button>\n\t\t\t<el-button round type=\"warning\" v-show=\"state=='RUNNING'\" @click=\"onPauseRecord()\">暂停录音</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='PAUSE'\" @click=\"onResumeRecord()\">继续录音</el-button>\n\t\t\t<el-button round type=\"danger\" v-show=\"state=='RUNNING'||state=='PAUSE'\" @click=\"onCompleteRecord()\">\n\t\t\t\t结束录音</el-button>\n\t\t\t<el-button round type=\"success\" v-show=\"state=='COMPLETE' && mode!='PLAY'\" @click=\"onPlayAudio()\">播放录音\n\t\t\t</el-button>\n\t\t\t<el-button round type=\"warning\" v-show=\"state=='COMPLETE' && mode=='PLAY'\" @click=\"onStopAudio()\">停止播放\n\t\t\t</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='COMPLETE'\" @click=\"onRestartRecord()\">重新录音</el-button>\n\t\t\t<el-button round type=\"primary\" v-show=\"state=='COMPLETE'\" @click=\"onSendRecord()\">立即发送</el-button>\n\t\t</el-row>\n\t</el-dialog>\n\n</template>\n\n<script>\n\timport Recorder from 'js-audio-recorder';\n\n\texport default {\n\t\tname: 'chatRecord',\n\t\tprops: {\n\t\t\tvisible: {\n\t\t\t\ttype: Boolean\n\t\t\t}\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\trc: new Recorder(),\n\t\t\t\taudio: new Audio(),\n\t\t\t\tstate: 'STOP', // STOP、RUNNING、PAUSE、COMPLETE\n\t\t\t\tstateTip: \"未开始\",\n\t\t\t\tmode: 'RECORD', // RECORD 、PLAY\n\t\t\t\tduration: 0,\n\t\t\t\turl: \"\"\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tonClose() {\n\t\t\t\t// 关闭前清除数据\n\t\t\t\tthis.rc.destroy();\n\t\t\t\tthis.rc = new Recorder();\n\t\t\t\tthis.audio.pause();\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t\tthis.state = 'STOP';\n\t\t\t\tthis.stateTip = '未开始';\n\t\t\t\tthis.$emit(\"close\");\n\t\t\t},\n\t\t\tonStartRecord() {\n\t\t\t\tthis.rc.start().then((stream) => {\n\t\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tthis.$message.error(error);\n\t\t\t\t});\n\n\n\t\t\t},\n\t\t\tonPauseRecord() {\n\t\t\t\tthis.rc.pause();\n\t\t\t\tthis.state = 'PAUSE';\n\t\t\t\tthis.stateTip = \"已暂停录音\";\n\t\t\t},\n\t\t\tonResumeRecord() {\n\t\t\t\tthis.rc.resume();\n\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t},\n\t\t\tonCompleteRecord() {\n\t\t\t\tthis.rc.pause();\n\t\t\t\tthis.state = 'COMPLETE';\n\t\t\t\tthis.stateTip = \"已结束录音\";\n\t\t\t},\n\t\t\tonPlayAudio() {\n\t\t\t\tlet wav = this.rc.getWAVBlob();\n\t\t\t\tlet url = URL.createObjectURL(wav);\n\t\t\t\tthis.$refs.audio.src = url;\n\t\t\t\tthis.$refs.audio.play();\n\t\t\t\tthis.mode = 'PLAY';\n\t\t\t},\n\t\t\tonStopAudio() {\n\t\t\t\tthis.$refs.audio.pause();\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t},\n\t\t\tonRestartRecord() {\n\t\t\t\tthis.rc.destroy();\n\t\t\t\tthis.rc = new Recorder()\n\t\t\t\tthis.rc.start();\n\t\t\t\tthis.state = 'RUNNING';\n\t\t\t\tthis.mode = 'RECORD';\n\t\t\t\tthis.stateTip = \"正在录音...\";\n\t\t\t},\n\t\t\tonSendRecord() {\n\t\t\t\tlet wav = this.rc.getWAVBlob();\n\t\t\t\tlet name = new Date().getDate() + '.wav';\n\t\t\t\tvar formData = new window.FormData()\n\t\t\t\tformData.append('file', wav, name);\n\t\t\t\tthis.$http({\n\t\t\t\t\turl: '/file/upload',\n\t\t\t\t\tdata: formData,\n\t\t\t\t\tmethod: 'post',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'multipart/form-data'\n\t\t\t\t\t}\n\t\t\t\t}).then((url) => {\n\t\t\t\t\tlet data = {\n\t\t\t\t\t\tduration: parseInt(this.rc.duration),\n\t\t\t\t\t\turl: url\n\t\t\t\t\t}\n\t\t\t\t\tthis.$emit(\"send\", data);\n\t\t\t\t\tthis.onClose();\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.chat-record {\n\n\t\t.tip {\n\t\t\tfont-size: 18px;\n\t\t}\n\n\t\t.btn-group {\n\t\t\tmargin-bottom: 20px;\n\t\t}\n\t}\n</style>\n"]}]}