{"remainingRequest":"/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/d/github/box-im/im-web/src/components/chat/ChatInput.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/d/github/box-im/im-web/src/components/chat/ChatInput.vue","mtime":1727013808920},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/babel-loader/lib/index.js","mtime":1727014166227},{"path":"/home/d/github/box-im/im-web/node_modules/cache-loader/dist/cjs.js","mtime":1727014166207},{"path":"/home/d/github/box-im/im-web/node_modules/vue-loader/lib/index.js","mtime":1727014163811}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CglpbXBvcnQgQ2hhdEF0Qm94IGZyb20gIi4vQ2hhdEF0Qm94IjsKCglleHBvcnQgZGVmYXVsdCB7CgkJbmFtZTogIkNoYXRJbnB1dCIsCgkJY29tcG9uZW50czogeyBDaGF0QXRCb3ggfSwKCQlwcm9wczogewoJCQlvd25lcklkOiB7CgkJCQl0eXBlOiBOdW1iZXIsCgkJCX0sCgkJCWdyb3VwTWVtYmVyczogewoJCQkJdHlwZTogQXJyYXksCgkJCX0sCgkJfSwKCQlkYXRhKCkgewoJCQlyZXR1cm4gewoJCQkJaW1hZ2VMaXN0OiBbXSwKCQkJCWZpbGVMaXN0OiBbXSwKCQkJCWN1cnJlbnRJZDogMCwKCQkJCWF0U2VhcmNoVGV4dDogbnVsbCwKCQkJCWNvbXBvc2l0aW9uRmxhZzogZmFsc2UsCgkJCQlhdEluZzogZmFsc2UsCgkJCQlpc0VtcHR5OiB0cnVlLAoJCQkJY2hhbmdlU3RvcmVkOiB0cnVlLAoJCQkJYmx1clJhbmdlOiBudWxsCgkJCX0KCQl9LAoJCW1ldGhvZHM6IHsKCQkJb25QYXN0ZShlKSB7CgkJCQl0aGlzLmlzRW1wdHkgPSBmYWxzZTsKCQkJCWxldCB0eHQgPSBlLmNsaXBib2FyZERhdGEuZ2V0RGF0YSgnVGV4dCcpCgkJCQlsZXQgcmFuZ2UgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKQoJCQkJaWYgKHJhbmdlLnN0YXJ0Q29udGFpbmVyICE9PSByYW5nZS5lbmRDb250YWluZXIgfHwgcmFuZ2Uuc3RhcnRPZmZzZXQgIT09IHJhbmdlLmVuZE9mZnNldCkgewoJCQkJCXJhbmdlLmRlbGV0ZUNvbnRlbnRzKCk7CgkJCQl9CgkJCQkvLyDnspjotLTlm77niYflkozmlofku7bml7bvvIzov5nph4zmsqHmnInmlbDmja4KCQkJCWlmICh0eHQgJiYgdHlwZW9mKHR4dCkgPT0gJ3N0cmluZycpIHsKCQkJCQlsZXQgdGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0eHQpOwoJCQkJCXJhbmdlLmluc2VydE5vZGUodGV4dE5vZGUpCgkJCQkJcmFuZ2UuY29sbGFwc2UoKTsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQlsZXQgaXRlbXMgPSAoZS5jbGlwYm9hcmREYXRhIHx8IHdpbmRvdy5jbGlwYm9hcmREYXRhKS5pdGVtcwoJCQkJaWYgKGl0ZW1zLmxlbmd0aCkgewoJCQkJCWZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsKCQkJCQkJaWYgKGl0ZW1zW2ldLnR5cGUuaW5kZXhPZignaW1hZ2UnKSAhPT0gLTEpIHsKCQkJCQkJCWxldCBmaWxlID0gaXRlbXNbaV0uZ2V0QXNGaWxlKCk7CgkJCQkJCQlsZXQgaW1hZ2VQdXNoID0gewoJCQkJCQkJCWZpbGVJZDogdGhpcy5nZW5lcmF0ZUlkKCksCgkJCQkJCQkJZmlsZTogZmlsZSwKCQkJCQkJCQl1cmw6IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSkKCQkJCQkJCX07CgkJCQkJCQl0aGlzLmltYWdlTGlzdFtpbWFnZVB1c2guZmlsZUlkXSA9IChpbWFnZVB1c2gpOwoJCQkJCQkJbGV0IGxpbmUgPSB0aGlzLm5ld0xpbmUoKTsKCQkJCQkJCWxldCBpbWFnZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKCQkJCQkJCWltYWdlRWxlbWVudC5jbGFzc05hbWUgPSAnY2hhdC1pbWFnZSBuby10ZXh0JzsKCQkJCQkJCWltYWdlRWxlbWVudC5zcmMgPSBpbWFnZVB1c2gudXJsOwoJCQkJCQkJaW1hZ2VFbGVtZW50LmRhdGFzZXQuaW1nSWQgPSBpbWFnZVB1c2guZmlsZUlkOwoJCQkJCQkJbGluZS5hcHBlbmRDaGlsZChpbWFnZUVsZW1lbnQpOwoJCQkJCQkJbGV0IGFmdGVyID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1x1MDBBMCcpOwoJCQkJCQkJbGluZS5hcHBlbmRDaGlsZChhZnRlcik7CgkJCQkJCQl0aGlzLnNlbGVjdEVsZW1lbnQoYWZ0ZXIsIDEpOwkJCgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlsZXQgYXNGaWxlID0gaXRlbXNbaV0uZ2V0QXNGaWxlKCk7CgkJCQkJCQlpZiAoIWFzRmlsZSkgewoJCQkJCQkJCWNvbnRpbnVlOwoJCQkJCQkJfQoJCQkJCQkJbGV0IGZpbGVQdXNoID0geyBmaWxlSWQ6IHRoaXMuZ2VuZXJhdGVJZCgpLCBmaWxlOiBhc0ZpbGUgfTsKCQkJCQkJCXRoaXMuZmlsZUxpc3RbZmlsZVB1c2guZmlsZUlkXSA9IChmaWxlUHVzaCkKCQkJCQkJCWxldCBsaW5lID0gdGhpcy5uZXdMaW5lKCk7CgkJCQkJCQlsZXQgZmlsZUVsZW1lbnQgPSB0aGlzLmNyZWF0ZUZpbGUoZmlsZVB1c2gpOwoJCQkJCQkJbGluZS5hcHBlbmRDaGlsZChmaWxlRWxlbWVudCk7CgkJCQkJCQlsZXQgYWZ0ZXIgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnXHUwMEEwJyk7CgkJCQkJCQlsaW5lLmFwcGVuZENoaWxkKGFmdGVyKTsKCQkJCQkJCXRoaXMuc2VsZWN0RWxlbWVudChhZnRlciwgMSk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQlyYW5nZS5jb2xsYXBzZSgpOwoJCQl9LAoJCQlzZWxlY3RFbGVtZW50KGVsZW1lbnQsIGVuZE9mZnNldCkgewoJCQkJbGV0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKCQkJCS8vIOaPkuWFpeWFg+e0oOWPr+iDveS4jeaYr+eri+WNs+aJp+ihjOeahO+8jHZ1ZeWPr+iDveS8muWcqOaPkuWFpeWFg+e0oOWQjuWGjeabtOaWsGRvbQoJCQkJdGhpcy4kbmV4dFRpY2soKCkgPT4gewoJCQkJCWxldCB0MSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7CgkJCQkJdDEuc2V0U3RhcnQoZWxlbWVudCwgMCk7CgkJCQkJdDEuc2V0RW5kKGVsZW1lbnQsIGVuZE9mZnNldCB8fCAwKTsKCQkJCQlpZiAoZWxlbWVudC5maXJzdENoaWxkKSB7CgkJCQkJCXQxLnNlbGVjdE5vZGVDb250ZW50cyhlbGVtZW50LmZpcnN0Q2hpbGQpOwoJCQkJCX0KCQkJCQl0MS5jb2xsYXBzZSgpOwoJCQkJCXNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTsKCQkJCQlzZWxlY3Rpb24uYWRkUmFuZ2UodDEpOwoJCQkJCS8vIOmcgOimgeaXtuiHquWKqOiBmueEpgoJCQkJCWlmIChlbGVtZW50LmZvY3VzKSB7CgkJCQkJCWVsZW1lbnQuZm9jdXMoKTsKCQkJCQl9CgkJCQl9KQoJCQl9LAoJCQlvbkNvbXBvc2l0aW9uRW5kKGUpIHsKCQkJCXRoaXMuY29tcG9zaXRpb25GbGFnID0gZmFsc2U7CgkJCQl0aGlzLm9uRWRpdG9ySW5wdXQoZSk7CgkJCX0sCgkJCW9uS2V5ZG93bihlKSB7CgkJCQlpZiAoZS5rZXlDb2RlID09PSAxMykgewoJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQllLnN0b3BQcm9wYWdhdGlvbigpOwoJCQkJCWlmICh0aGlzLmF0SW5nKSB7CgkJCQkJCWNvbnNvbGUubG9nKCfpgInkuK1hdOeahOS6uicpCgkJCQkJCXRoaXMuJHJlZnMuYXRCb3guc2VsZWN0KCk7CgkJCQkJCXJldHVybjsKCQkJCQl9CgkJCQkJaWYgKGUuY3RybEtleSkgewoJCQkJCQlsZXQgbGluZSA9IHRoaXMubmV3TGluZSgpOwoJCQkJCQlsZXQgYWZ0ZXIgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnXHUwMEEwJyk7CgkJCQkJCWxpbmUuYXBwZW5kQ2hpbGQoYWZ0ZXIpOwoJCQkJCQl0aGlzLnNlbGVjdEVsZW1lbnQobGluZS5jaGlsZE5vZGVzWzBdLCAwKTsKCQkJCQl9IGVsc2UgewoJCQkJCQkvLyDkuK3mlofovpPlhaXmoIforrAKCQkJCQkJaWYgKHRoaXMuY29tcG9zaXRpb25GbGFnKSB7CgkJCQkJCQlyZXR1cm47CgkJCQkJCX0KCQkJCQkJdGhpcy5zdWJtaXQoKTsKCQkJCQl9CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJLy8g5Yig6Zmk6ZSuCgkJCQlpZiAoZS5rZXlDb2RlID09PSA4KSB7CgkJCQkJY29uc29sZS5sb2coImRlbGV0ZSIpCgkJCQkJLy8g562J5b6FZG9t5pu05pawCgkJCQkJc2V0VGltZW91dCgoKSA9PiB7CgkJCQkJCWxldCBzID0gdGhpcy4kcmVmcy5jb250ZW50LmlubmVySFRNTC50cmltKCk7CgkJCQkJCS8vIOepumRvbeaXtu+8jOmcgOimgeWIt+aWsGRvbQoJCQkJCQljb25zb2xlLmxvZyhzKTsKCQkJCQkJaWYgKHMgPT09ICcnIHx8IHMgPT09ICc8YnI+JyB8fCBzID09PSAnPGRpdj4mbmJzcDs8L2Rpdj4nICkgewoJCQkJCQkJLy8g5ou85o6l6ZqP5py66ZW/5bqm55qE56m65qC877yM5Lul5Yi35pawZG9tCgkJCQkJCQl0aGlzLmVtcHR5KCk7CgkJCQkJCQl0aGlzLmlzRW1wdHkgPSB0cnVlOwoJCQkJCQkJdGhpcy5zZWxlY3RFbGVtZW50KHRoaXMuJHJlZnMuY29udGVudCk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl0aGlzLmlzRW1wdHkgPSBmYWxzZTsKCQkJCQkJfQoJCQkJCX0pCgkJCQl9CgkJCQkvLyBhdOahhuaJk+W8gOaXtu+8jOS4iuS4i+mUruenu+WKqOeJueauiuWkhOeQhgoJCQkJaWYgKHRoaXMuYXRJbmcpIHsKCQkJCQlpZiAoZS5rZXlDb2RlID09PSAzOCkgewoJCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJCQkJCXRoaXMuJHJlZnMuYXRCb3gubW92ZVVwKCk7CgkJCQkJfQoJCQkJCWlmIChlLmtleUNvZGUgPT09IDQwKSB7CgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQkJCQkJdGhpcy4kcmVmcy5hdEJveC5tb3ZlRG93bigpOwoJCQkJCX0KCQkJCX0KCgkJCX0sCgkJCW9uQXRTZWxlY3QobWVtYmVyKSB7CgkJCQl0aGlzLmF0SW5nID0gZmFsc2U7CgkJCQkvLyDpgInkuK3ovpPlhaXnmoQgQHh4IOespgoJCQkJbGV0IGJsdXJSYW5nZSA9IHRoaXMuYmx1clJhbmdlOwoJCQkJbGV0IGVuZENvbnRhaW5lciA9IGJsdXJSYW5nZS5lbmRDb250YWluZXIKCQkJCWxldCBzdGFydE9mZnNldCA9IGVuZENvbnRhaW5lci5kYXRhLmluZGV4T2YoIkAiK3RoaXMuYXRTZWFyY2hUZXh0KTsKCQkJCWxldCBlbmRPZmZzZXQgPSBzdGFydE9mZnNldCArIHRoaXMuYXRTZWFyY2hUZXh0Lmxlbmd0aCArIDE7CgkJCQlibHVyUmFuZ2Uuc2V0U3RhcnQoYmx1clJhbmdlLmVuZENvbnRhaW5lciwgc3RhcnRPZmZzZXQpOwoJCQkJYmx1clJhbmdlLnNldEVuZChibHVyUmFuZ2UuZW5kQ29udGFpbmVyLCAgZW5kT2Zmc2V0KTsKCQkJCWJsdXJSYW5nZS5kZWxldGVDb250ZW50cygpCgkJCQlibHVyUmFuZ2UuY29sbGFwc2UoKTsKCQkJCWNvbnNvbGUubG9nKCJvbkF0U2VsZWN0IikKCQkJCXRoaXMuZm9jdXMoKTsKCQkJCS8vIOWIm+W7uuWFg+e0oOiKgueCuQoJCQkJbGV0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdTUEFOJykKCQkJCWVsZW1lbnQuY2xhc3NOYW1lID0gImNoYXQtYXQtdXNlciI7CgkJCQllbGVtZW50LmRhdGFzZXQuaWQgPSBtZW1iZXIudXNlcklkOwoJCQkJZWxlbWVudC5jb250ZW50RWRpdGFibGUgPSAnZmFsc2UnCgkJCQllbGVtZW50LmlubmVyVGV4dCA9IGBAJHttZW1iZXIuc2hvd05pY2tOYW1lfWAKCQkJCWJsdXJSYW5nZS5pbnNlcnROb2RlKGVsZW1lbnQpCgkJCQkvLyDlhYnmoIfnp7vliqjliLDmnKvlsL4KCQkJCWJsdXJSYW5nZS5jb2xsYXBzZSgpCgoJCQkJLy8g5o+S5YWl56m65qC8CgkJCQlsZXQgdGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnXHUwMEEwJyk7CgkJCQlibHVyUmFuZ2UuaW5zZXJ0Tm9kZSh0ZXh0Tm9kZSk7CgoJCQkJYmx1clJhbmdlLmNvbGxhcHNlKCkKCQkJCXRoaXMuYXRTZWFyY2hUZXh0ID0gIiI7CgkJCQl0aGlzLnNlbGVjdEVsZW1lbnQodGV4dE5vZGUsIDEpOwoJCQl9LAoJCQlvbkVkaXRvcklucHV0KGUpIHsKCQkJCXRoaXMuaXNFbXB0eSA9IGZhbHNlOwoJCQkJdGhpcy5jaGFuZ2VTdG9yZWQgPSBmYWxzZTsKCQkJCWlmICh0aGlzLiRwcm9wcy5ncm91cE1lbWJlcnMgJiYgIXRoaXMuY29tcG9zaXRpb25GbGFnKSB7CgkJCQkJbGV0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKQoJCQkJCWxldCByYW5nZSA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KDApOwoJCQkJCS8vIOaIquWPlkDlkI7pnaLnmoTlkI3np7DkvZzkuLrov4fmu6TmnaHku7bvvIzlubbku6XnqbrmoLznu5PmnZ8KCQkJCQlsZXQgZW5kQ29udGFpbmVyID0gcmFuZ2UuZW5kQ29udGFpbmVyOwoJCQkJCWxldCBlbmRPZmZzZXQgPSByYW5nZS5lbmRPZmZzZXQ7CgkJCQkJbGV0IHRleHRDb250ZW50ID0gZW5kQ29udGFpbmVyLnRleHRDb250ZW50OwoJCQkJCWxldCBzdGFydEluZGV4ID0gLTE7CgkJCQkJZm9yIChsZXQgaSA9IGVuZE9mZnNldDsgaSA+PSAwOyBpLS0pIHsKCQkJCQkJaWYgKHRleHRDb250ZW50W2ldID09PSAnQCcpIHsKCQkJCQkJCXN0YXJ0SW5kZXggPSBpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJLy8g5rKh5pyJYXTnrKblj7fvvIzliJnlhbPpl63lvLnnqpcKCQkJCQlpZiAoc3RhcnRJbmRleCA9PT0gLTEpIHsKCQkJCQkJdGhpcy4kcmVmcy5hdEJveC5jbG9zZSgpOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoKCQkJCQlsZXQgZW5kSW5kZXggPSBlbmRPZmZzZXQ7CgkJCQkJZm9yIChsZXQgaSA9IGVuZE9mZnNldDsgaSA8IHRleHRDb250ZW50Lmxlbmd0aDsgaSsrKSB7CgkJCQkJCWlmICh0ZXh0Q29udGVudFtpXSA9PT0gJyAnKSB7CgkJCQkJCQllbmRJbmRleCA9IGk7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCQl0aGlzLmF0U2VhcmNoVGV4dCA9IHRleHRDb250ZW50LnN1YnN0cmluZyhzdGFydEluZGV4ICsgMSwgZW5kSW5kZXgpLnRyaW0oKTsKCQkJCQkvLyDmiZPlvIDpgInmi6nlvLnnqpcKCQkJCQlpZiAodGhpcy5hdFNlYXJjaFRleHQgPT0gJycpIHsKCQkJCQkJdGhpcy5zaG93QXRCb3goZSkKCQkJCQl9CgkJCQl9CgoJCQl9LAoJCQlvbkJsdXIoZSkgewoJCQkJdGhpcy51cGRhdGVSYW5nZSgpOwoJCQkJCgkJCX0sCgkJCW9uTW91c2Vkb3duKCkgewoJCQkJaWYgKHRoaXMuYXRJbmcpIHsKCQkJCQl0aGlzLiRyZWZzLmF0Qm94LmNsb3NlKCk7CgkJCQkJdGhpcy5hdEluZyA9IGZhbHNlOwoJCQkJfQoJCQl9LAoJCQlpbnNlcnRFbW9qaShlbW9qaVRleHQpIHsKCQkJCWxldCBlbW9qaUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKCQkJCWVtb2ppRWxlbWVudC5jbGFzc05hbWUgPSAnY2hhdC1lbW9qaSBuby10ZXh0JzsKCQkJCWVtb2ppRWxlbWVudC5kYXRhc2V0LmVtb2ppQ29kZSA9IGVtb2ppVGV4dDsKCQkJCWVtb2ppRWxlbWVudC5zcmMgPSB0aGlzLiRlbW8udGV4dFRvVXJsKGVtb2ppVGV4dCk7CgoJCQkJbGV0IGJsdXJSYW5nZSA9IHRoaXMuYmx1clJhbmdlOwoJCQkJaWYgKCFibHVyUmFuZ2UpIHsKCQkJCQl0aGlzLmZvY3VzKCk7CgkJCQkJdGhpcy51cGRhdGVSYW5nZSgpOwoJCQkJCWJsdXJSYW5nZSA9IHRoaXMuYmx1clJhbmdlOwoJCQkJfQoJCQkJaWYgKGJsdXJSYW5nZS5zdGFydENvbnRhaW5lciAhPT0gYmx1clJhbmdlLmVuZENvbnRhaW5lciB8fCBibHVyUmFuZ2Uuc3RhcnRPZmZzZXQgIT09IGJsdXJSYW5nZS5lbmRPZmZzZXQpIHsKCQkJCQlibHVyUmFuZ2UuZGVsZXRlQ29udGVudHMoKTsKCQkJCX0KCQkJCWJsdXJSYW5nZS5pbnNlcnROb2RlKGVtb2ppRWxlbWVudCk7CgkJCQlibHVyUmFuZ2UuY29sbGFwc2UoKQoKCQkJCWxldCB0ZXh0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdcdTAwQTAnKTsKCQkJCWJsdXJSYW5nZS5pbnNlcnROb2RlKHRleHROb2RlKQoJCQkJYmx1clJhbmdlLmNvbGxhcHNlKCkKCgkJCQl0aGlzLnNlbGVjdEVsZW1lbnQodGV4dE5vZGUpOwoJCQkJdGhpcy51cGRhdGVSYW5nZSgpOwoJCQkJdGhpcy5pc0VtcHR5ID0gZmFsc2U7CgkJCX0sCgkJCWdlbmVyYXRlSWQoKSB7CgkJCQlyZXR1cm4gdGhpcy5jdXJyZW50SWQrKzsKCQkJfSwKCQkJY3JlYXRlRmlsZShmaWxlUHVzaCkgewoJCQkJbGV0IGZpbGUgPSBmaWxlUHVzaC5maWxlOwoJCQkJbGV0IGZpbGVJZCA9IGZpbGVQdXNoLmZpbGVJZDsKCQkJCWxldCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJCWNvbnRhaW5lci5jbGFzc05hbWUgPSAnY2hhdC1maWxlLWNvbnRhaW5lciBuby10ZXh0JzsKCQkJCWNvbnRhaW5lci5jb250ZW50RWRpdGFibGUgPSAnZmFsc2UnOwoJCQkJY29udGFpbmVyLmRhdGFzZXQuZmlsZUlkID0gZmlsZUlkOwoKCQkJCWxldCBsZWZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCQlsZWZ0LmNsYXNzTmFtZSA9ICdmaWxlLXBvc2l0aW9uLWxlZnQnOwoJCQkJY29udGFpbmVyLmFwcGVuZENoaWxkKGxlZnQpOwoKCQkJCWxldCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCQlpY29uLmNsYXNzTmFtZSA9ICdlbC1pY29uLWRvY3VtZW50JzsKCQkJCWxlZnQuYXBwZW5kQ2hpbGQoaWNvbik7CgoJCQkJbGV0IHJpZ2h0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCQlyaWdodC5jbGFzc05hbWUgPSAnZmlsZS1wb3NpdGlvbi1yaWdodCc7CgkJCQljb250YWluZXIuYXBwZW5kQ2hpbGQocmlnaHQpOwoKCQkJCWxldCBmaWxlTmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkJZmlsZU5hbWUuY2xhc3NOYW1lID0gJ2ZpbGUtbmFtZSc7CgkJCQlmaWxlTmFtZS5pbm5lclRleHQgPSBmaWxlLm5hbWU7CgoJCQkJbGV0IGZpbGVTaXplID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCQlmaWxlU2l6ZS5jbGFzc05hbWUgPSAnZmlsZS1zaXplJzsKCQkJCWZpbGVTaXplLmlubmVyVGV4dCA9IHRoaXMuc2l6ZUNvbnZlcnQoZmlsZS5zaXplKTsKCgkJCQlyaWdodC5hcHBlbmRDaGlsZChmaWxlTmFtZSk7CgkJCQlyaWdodC5hcHBlbmRDaGlsZChmaWxlU2l6ZSk7CgoJCQkJcmV0dXJuIGNvbnRhaW5lcjsKCQkJfSwKCQkJc2l6ZUNvbnZlcnQobGVuKSB7CgkJCQlpZiAobGVuIDwgMTAyNCkgewoJCQkJCXJldHVybiBsZW4gKyAnQic7CgkJCQl9IGVsc2UgaWYgKGxlbiA8IDEwMjQgKiAxMDI0KSB7CgkJCQkJcmV0dXJuIChsZW4gLyAxMDI0KS50b0ZpeGVkKDIpICsgJ0tCJzsKCQkJCX0gZWxzZSBpZiAobGVuIDwgMTAyNCAqIDEwMjQgKiAxMDI0KSB7CgkJCQkJcmV0dXJuIChsZW4gLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgyKSArICdNQic7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAobGVuIC8gMTAyNCAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpICsgJ0dCJzsKCQkJCX0KCQkJfSwKCQkJdXBkYXRlUmFuZ2UoKSB7CgkJCQlsZXQgc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpOwoJCQkJdGhpcy5ibHVyUmFuZ2UgPSBzZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKTsKCQkJfSwKCQkJbmV3TGluZSgpIHsKCQkJCWxldCBzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7CgkJCQlsZXQgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKTsKCQkJCWxldCBkaXZFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCQlsZXQgZW5kQ29udGFpbmVyID0gcmFuZ2UuZW5kQ29udGFpbmVyOwoJCQkJbGV0IHBhcmVudEVsZW1lbnQgPSBlbmRDb250YWluZXIucGFyZW50RWxlbWVudDsKCQkJCWlmIChwYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQgPT09IHRoaXMuJHJlZnMuY29udGVudCkgewoJCQkJCWRpdkVsZW1lbnQuaW5uZXJIVE1MICA9IGVuZENvbnRhaW5lci50ZXh0Q29udGVudC5zdWJzdHJpbmcocmFuZ2UuZW5kT2Zmc2V0KS50cmltKCk7IAoJCQkJCWVuZENvbnRhaW5lci50ZXh0Q29udGVudCA9IGVuZENvbnRhaW5lci50ZXh0Q29udGVudC5zdWJzdHJpbmcoMCwgcmFuZ2UuZW5kT2Zmc2V0KTsKCQkJCQkvLyDmj5LlhaXliLDlvZPliY1kaXbvvIjlvZPliY3ooYzvvInlkI7pnaIKCQkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJlbmQnLCBkaXZFbGVtZW50KTsKCQkJCX0gZWxzZSB7CgkJCQkJZGl2RWxlbWVudC5pbm5lckhUTUwgPSAnJzsKCQkJCQl0aGlzLiRyZWZzLmNvbnRlbnQuYXBwZW5kKGRpdkVsZW1lbnQpOwoJCQkJfQoJCQkJcmV0dXJuIGRpdkVsZW1lbnQ7CgkJCX0sCgkJCWNsZWFyKCkgewoJCQkJdGhpcy5lbXB0eSgpOwoJCQkJdGhpcy5pbWFnZUxpc3QgPSBbXTsKCQkJCXRoaXMuZmlsZUxpc3QgPSBbXTsKCQkJfSwKCQkJZW1wdHkoKSB7CgkJCQl0aGlzLiRyZWZzLmNvbnRlbnQuaW5uZXJIVE1MID0gIiI7CgkJCQlsZXQgbGluZSA9IHRoaXMubmV3TGluZSgpOwoJCQkJbGV0IGFmdGVyID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1x1MDBBMCcpOwoJCQkJbGluZS5hcHBlbmRDaGlsZChhZnRlcik7CgkJCQl0aGlzLiRuZXh0VGljaygoKT0+dGhpcy5zZWxlY3RFbGVtZW50KGFmdGVyKSk7CgkJCX0sCgkJCXNob3dBdEJveChlKSB7CgkJCQl0aGlzLmF0SW5nID0gdHJ1ZTsKCQkJCS8vIHNob3fkuYvlkI7kvJroh6rliqjmm7TmlrDlvZPliY3mkJzntKLnmoR0ZXh0CgkJCQkvLyB0aGlzLmF0U2VhcmNoVGV4dCA9ICIiOwoJCQkJbGV0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKQoJCQkJbGV0IHJhbmdlID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCkKCQkJCS8vIOWFieagh+aJgOWcqOWdkOaghwoJCQkJbGV0IHBvcyA9IHJhbmdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoJCQkJdGhpcy4kcmVmcy5hdEJveC5vcGVuKHsKCQkJCQl4OiBwb3MueCwKCQkJCQl5OiBwb3MueQoJCQkJfSkKCQkJCS8vIOiusOW9leWFieagh+aJgOWcqOS9jee9rgoJCQkJdGhpcy51cGRhdGVSYW5nZSgpOwoJCQl9LAoJCQlodG1sMkVzY2FwZShzdHJIdG1sKSB7CgkJCQlyZXR1cm4gc3RySHRtbC5yZXBsYWNlKC9bPD4mIl0vZywgZnVuY3Rpb24oYykgewoJCQkJCXJldHVybiB7CgkJCQkJCSc8JzogJyZsdDsnLAoJCQkJCQknPic6ICcmZ3Q7JywKCQkJCQkJJyYnOiAnJmFtcDsnLAoJCQkJCQknIic6ICcmcXVvdDsnCgkJCQkJfSBbY107CgkJCQl9KTsKCQkJfSwKCQkJc3VibWl0KCkgewoJCQkJbGV0IG5vZGVzID0gdGhpcy4kcmVmcy5jb250ZW50LmNoaWxkTm9kZXM7CgkJCQlsZXQgZnVsbExpc3QgPSBbXTsKCQkJCWxldCB0ZW1wVGV4dCA9ICcnOwoJCQkJbGV0IGF0VXNlcklkcyA9IFtdOwoJCQkJbGV0IGVhY2ggPSAobm9kZXMpID0+IHsKCQkJCQlmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7CgkJCQkJCWxldCBub2RlID0gbm9kZXNbaV07CgkJCQkJCWlmICghbm9kZSkgewoJCQkJCQkJY29udGludWU7CgkJCQkJCX0KCQkJCQkJaWYgKG5vZGUubm9kZVR5cGUgPT09IDMpIHsKCQkJCQkJCXRlbXBUZXh0ICs9IHRoaXMuaHRtbDJFc2NhcGUobm9kZS50ZXh0Q29udGVudCk7CgkJCQkJCQljb250aW51ZTsKCQkJCQkJfQoJCQkJCQlsZXQgbm9kZU5hbWUgPSBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJCWlmIChub2RlTmFtZSA9PT0gJ3NjcmlwdCcpIHsKCQkJCQkJCWNvbnRpbnVlOwoJCQkJCQl9CgkJCQkJCWxldCB0ZXh0ID0gdGVtcFRleHQudHJpbSgpOwoJCQkJCQlpZiAobm9kZU5hbWUgPT09ICdpbWcnKSB7CgkJCQkJCQlsZXQgaW1nSWQgPSBub2RlLmRhdGFzZXQuaW1nSWQ7CgkJCQkJCQlpZiAoaW1nSWQpIHsKCQkJCQkJCQlpZiAodGV4dCkgewoJCQkJCQkJCQlmdWxsTGlzdC5wdXNoKHsKCQkJCQkJCQkJCXR5cGU6ICd0ZXh0JywKCQkJCQkJCQkJCWNvbnRlbnQ6IHRleHQsCgkJCQkJCQkJCQlhdFVzZXJJZHM6IGF0VXNlcklkcwoJCQkJCQkJCQl9KQoJCQkJCQkJCQl0ZW1wVGV4dCA9ICcnOwoJCQkJCQkJCQlhdFVzZXJJZHMgPSBbXQoJCQkJCQkJCX0KCQkJCQkJCQlmdWxsTGlzdC5wdXNoKHsKCQkJCQkJCQkJdHlwZTogJ2ltYWdlJywKCQkJCQkJCQkJY29udGVudDogdGhpcy5pbWFnZUxpc3RbaW1nSWRdCgkJCQkJCQkJfSkKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJbGV0IGVtb2ppQ29kZSA9IG5vZGUuZGF0YXNldC5lbW9qaUNvZGU7CgkJCQkJCQkJdGVtcFRleHQgKz0gZW1vamlDb2RlOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgaWYgKG5vZGVOYW1lID09PSAnZGl2JykgewoJCQkJCQkJbGV0IGZpbGVJZCA9IG5vZGUuZGF0YXNldC5maWxlSWQKCQkJCQkJCS8vIOaWh+S7tgoJCQkJCQkJaWYgKGZpbGVJZCkgewoJCQkJCQkJCWlmICh0ZXh0KSB7CgkJCQkJCQkJCWZ1bGxMaXN0LnB1c2goewoJCQkJCQkJCQkJdHlwZTogJ3RleHQnLAoJCQkJCQkJCQkJY29udGVudDogdGV4dCwKCQkJCQkJCQkJCWF0VXNlcklkczogYXRVc2VySWRzCgkJCQkJCQkJCX0pCgkJCQkJCQkJCXRlbXBUZXh0ID0gJyc7CgkJCQkJCQkJCWF0VXNlcklkcyA9IFtdCgkJCQkJCQkJfQoJCQkJCQkJCWZ1bGxMaXN0LnB1c2goewoJCQkJCQkJCQl0eXBlOiAnZmlsZScsCgkJCQkJCQkJCWNvbnRlbnQ6IHRoaXMuZmlsZUxpc3RbZmlsZUlkXQoJCQkJCQkJCX0pCgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXRlbXBUZXh0ICs9ICdcbic7CgkJCQkJCQkJZWFjaChub2RlLmNoaWxkTm9kZXMpOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgaWYgKG5vZGVOYW1lID09PSAnc3BhbicpIHsKCQkJCQkJCWlmKG5vZGUuZGF0YXNldC5pZCl7CgkJCQkJCQkJdGVtcFRleHQgKz0gbm9kZS5pbm5lckhUTUw7CgkJCQkJCQkJYXRVc2VySWRzLnB1c2gobm9kZS5kYXRhc2V0LmlkKQoJCQkJCQkJfWVsc2UgewoJCQkJCQkJCXRlbXBUZXh0ICs9IG5vZGUub3V0ZXJIdG1sOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJZWFjaChub2RlcykKCQkJCWxldCB0ZXh0ID0gdGVtcFRleHQudHJpbSgpOwoJCQkJaWYgKHRleHQgIT09ICcnKSB7CgkJCQkJZnVsbExpc3QucHVzaCh7CgkJCQkJCXR5cGU6ICd0ZXh0JywKCQkJCQkJY29udGVudDogdGV4dCwKCQkJCQkJYXRVc2VySWRzOiBhdFVzZXJJZHMKCQkJCQl9KQoJCQkJfQoJCQkJdGhpcy4kZW1pdCgnc3VibWl0JywgZnVsbExpc3QpOwoJCQl9LAoJCQlmb2N1cygpIHsKCQkJCXRoaXMuJHJlZnMuY29udGVudC5mb2N1cygpOwoJCQl9CgoJCX0KCX0K"},{"version":3,"sources":["ChatInput.vue"],"names":[],"mappings":";AAYA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"ChatInput.vue","sourceRoot":"src/components/chat","sourcesContent":["<template>\n\t<div class=\"chat-input-area\">\n\t\t<div :class=\"['edit-chat-container',isEmpty?'':'not-empty']\" contenteditable=\"true\" @paste.prevent=\"onPaste\"\n\t\t\t@keydown=\"onKeydown\" @compositionstart=\"compositionFlag=true\" @compositionend=\"onCompositionEnd\"\n\t\t\t@input=\"onEditorInput\" @mousedown=\"onMousedown\" ref=\"content\" @blur=\"onBlur\">\n\t\t</div>\n\t\t<chat-at-box @select=\"onAtSelect\" :search-text=\"atSearchText\" ref=\"atBox\" :ownerId=\"ownerId\"\n\t\t\t:members=\"groupMembers\"></chat-at-box>\n\t</div>\n</template>\n\n<script>\n\timport ChatAtBox from \"./ChatAtBox\";\n\n\texport default {\n\t\tname: \"ChatInput\",\n\t\tcomponents: { ChatAtBox },\n\t\tprops: {\n\t\t\townerId: {\n\t\t\t\ttype: Number,\n\t\t\t},\n\t\t\tgroupMembers: {\n\t\t\t\ttype: Array,\n\t\t\t},\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\timageList: [],\n\t\t\t\tfileList: [],\n\t\t\t\tcurrentId: 0,\n\t\t\t\tatSearchText: null,\n\t\t\t\tcompositionFlag: false,\n\t\t\t\tatIng: false,\n\t\t\t\tisEmpty: true,\n\t\t\t\tchangeStored: true,\n\t\t\t\tblurRange: null\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tonPaste(e) {\n\t\t\t\tthis.isEmpty = false;\n\t\t\t\tlet txt = e.clipboardData.getData('Text')\n\t\t\t\tlet range = window.getSelection().getRangeAt(0)\n\t\t\t\tif (range.startContainer !== range.endContainer || range.startOffset !== range.endOffset) {\n\t\t\t\t\trange.deleteContents();\n\t\t\t\t}\n\t\t\t\t// 粘贴图片和文件时，这里没有数据\n\t\t\t\tif (txt && typeof(txt) == 'string') {\n\t\t\t\t\tlet textNode = document.createTextNode(txt);\n\t\t\t\t\trange.insertNode(textNode)\n\t\t\t\t\trange.collapse();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet items = (e.clipboardData || window.clipboardData).items\n\t\t\t\tif (items.length) {\n\t\t\t\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\t\t\t\tif (items[i].type.indexOf('image') !== -1) {\n\t\t\t\t\t\t\tlet file = items[i].getAsFile();\n\t\t\t\t\t\t\tlet imagePush = {\n\t\t\t\t\t\t\t\tfileId: this.generateId(),\n\t\t\t\t\t\t\t\tfile: file,\n\t\t\t\t\t\t\t\turl: URL.createObjectURL(file)\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tthis.imageList[imagePush.fileId] = (imagePush);\n\t\t\t\t\t\t\tlet line = this.newLine();\n\t\t\t\t\t\t\tlet imageElement = document.createElement('img');\n\t\t\t\t\t\t\timageElement.className = 'chat-image no-text';\n\t\t\t\t\t\t\timageElement.src = imagePush.url;\n\t\t\t\t\t\t\timageElement.dataset.imgId = imagePush.fileId;\n\t\t\t\t\t\t\tline.appendChild(imageElement);\n\t\t\t\t\t\t\tlet after = document.createTextNode('\\u00A0');\n\t\t\t\t\t\t\tline.appendChild(after);\n\t\t\t\t\t\t\tthis.selectElement(after, 1);\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet asFile = items[i].getAsFile();\n\t\t\t\t\t\t\tif (!asFile) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet filePush = { fileId: this.generateId(), file: asFile };\n\t\t\t\t\t\t\tthis.fileList[filePush.fileId] = (filePush)\n\t\t\t\t\t\t\tlet line = this.newLine();\n\t\t\t\t\t\t\tlet fileElement = this.createFile(filePush);\n\t\t\t\t\t\t\tline.appendChild(fileElement);\n\t\t\t\t\t\t\tlet after = document.createTextNode('\\u00A0');\n\t\t\t\t\t\t\tline.appendChild(after);\n\t\t\t\t\t\t\tthis.selectElement(after, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trange.collapse();\n\t\t\t},\n\t\t\tselectElement(element, endOffset) {\n\t\t\t\tlet selection = window.getSelection();\n\t\t\t\t// 插入元素可能不是立即执行的，vue可能会在插入元素后再更新dom\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tlet t1 = document.createRange();\n\t\t\t\t\tt1.setStart(element, 0);\n\t\t\t\t\tt1.setEnd(element, endOffset || 0);\n\t\t\t\t\tif (element.firstChild) {\n\t\t\t\t\t\tt1.selectNodeContents(element.firstChild);\n\t\t\t\t\t}\n\t\t\t\t\tt1.collapse();\n\t\t\t\t\tselection.removeAllRanges();\n\t\t\t\t\tselection.addRange(t1);\n\t\t\t\t\t// 需要时自动聚焦\n\t\t\t\t\tif (element.focus) {\n\t\t\t\t\t\telement.focus();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tonCompositionEnd(e) {\n\t\t\t\tthis.compositionFlag = false;\n\t\t\t\tthis.onEditorInput(e);\n\t\t\t},\n\t\t\tonKeydown(e) {\n\t\t\t\tif (e.keyCode === 13) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tif (this.atIng) {\n\t\t\t\t\t\tconsole.log('选中at的人')\n\t\t\t\t\t\tthis.$refs.atBox.select();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\t\tlet line = this.newLine();\n\t\t\t\t\t\tlet after = document.createTextNode('\\u00A0');\n\t\t\t\t\t\tline.appendChild(after);\n\t\t\t\t\t\tthis.selectElement(line.childNodes[0], 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 中文输入标记\n\t\t\t\t\t\tif (this.compositionFlag) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.submit();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// 删除键\n\t\t\t\tif (e.keyCode === 8) {\n\t\t\t\t\tconsole.log(\"delete\")\n\t\t\t\t\t// 等待dom更新\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tlet s = this.$refs.content.innerHTML.trim();\n\t\t\t\t\t\t// 空dom时，需要刷新dom\n\t\t\t\t\t\tconsole.log(s);\n\t\t\t\t\t\tif (s === '' || s === '<br>' || s === '<div>&nbsp;</div>' ) {\n\t\t\t\t\t\t\t// 拼接随机长度的空格，以刷新dom\n\t\t\t\t\t\t\tthis.empty();\n\t\t\t\t\t\t\tthis.isEmpty = true;\n\t\t\t\t\t\t\tthis.selectElement(this.$refs.content);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.isEmpty = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t// at框打开时，上下键移动特殊处理\n\t\t\t\tif (this.atIng) {\n\t\t\t\t\tif (e.keyCode === 38) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tthis.$refs.atBox.moveUp();\n\t\t\t\t\t}\n\t\t\t\t\tif (e.keyCode === 40) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tthis.$refs.atBox.moveDown();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tonAtSelect(member) {\n\t\t\t\tthis.atIng = false;\n\t\t\t\t// 选中输入的 @xx 符\n\t\t\t\tlet blurRange = this.blurRange;\n\t\t\t\tlet endContainer = blurRange.endContainer\n\t\t\t\tlet startOffset = endContainer.data.indexOf(\"@\"+this.atSearchText);\n\t\t\t\tlet endOffset = startOffset + this.atSearchText.length + 1;\n\t\t\t\tblurRange.setStart(blurRange.endContainer, startOffset);\n\t\t\t\tblurRange.setEnd(blurRange.endContainer,  endOffset);\n\t\t\t\tblurRange.deleteContents()\n\t\t\t\tblurRange.collapse();\n\t\t\t\tconsole.log(\"onAtSelect\")\n\t\t\t\tthis.focus();\n\t\t\t\t// 创建元素节点\n\t\t\t\tlet element = document.createElement('SPAN')\n\t\t\t\telement.className = \"chat-at-user\";\n\t\t\t\telement.dataset.id = member.userId;\n\t\t\t\telement.contentEditable = 'false'\n\t\t\t\telement.innerText = `@${member.showNickName}`\n\t\t\t\tblurRange.insertNode(element)\n\t\t\t\t// 光标移动到末尾\n\t\t\t\tblurRange.collapse()\n\n\t\t\t\t// 插入空格\n\t\t\t\tlet textNode = document.createTextNode('\\u00A0');\n\t\t\t\tblurRange.insertNode(textNode);\n\n\t\t\t\tblurRange.collapse()\n\t\t\t\tthis.atSearchText = \"\";\n\t\t\t\tthis.selectElement(textNode, 1);\n\t\t\t},\n\t\t\tonEditorInput(e) {\n\t\t\t\tthis.isEmpty = false;\n\t\t\t\tthis.changeStored = false;\n\t\t\t\tif (this.$props.groupMembers && !this.compositionFlag) {\n\t\t\t\t\tlet selection = window.getSelection()\n\t\t\t\t\tlet range = selection.getRangeAt(0);\n\t\t\t\t\t// 截取@后面的名称作为过滤条件，并以空格结束\n\t\t\t\t\tlet endContainer = range.endContainer;\n\t\t\t\t\tlet endOffset = range.endOffset;\n\t\t\t\t\tlet textContent = endContainer.textContent;\n\t\t\t\t\tlet startIndex = -1;\n\t\t\t\t\tfor (let i = endOffset; i >= 0; i--) {\n\t\t\t\t\t\tif (textContent[i] === '@') {\n\t\t\t\t\t\t\tstartIndex = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// 没有at符号，则关闭弹窗\n\t\t\t\t\tif (startIndex === -1) {\n\t\t\t\t\t\tthis.$refs.atBox.close();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet endIndex = endOffset;\n\t\t\t\t\tfor (let i = endOffset; i < textContent.length; i++) {\n\t\t\t\t\t\tif (textContent[i] === ' ') {\n\t\t\t\t\t\t\tendIndex = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.atSearchText = textContent.substring(startIndex + 1, endIndex).trim();\n\t\t\t\t\t// 打开选择弹窗\n\t\t\t\t\tif (this.atSearchText == '') {\n\t\t\t\t\t\tthis.showAtBox(e)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tonBlur(e) {\n\t\t\t\tthis.updateRange();\n\t\t\t\t\n\t\t\t},\n\t\t\tonMousedown() {\n\t\t\t\tif (this.atIng) {\n\t\t\t\t\tthis.$refs.atBox.close();\n\t\t\t\t\tthis.atIng = false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tinsertEmoji(emojiText) {\n\t\t\t\tlet emojiElement = document.createElement('img');\n\t\t\t\temojiElement.className = 'chat-emoji no-text';\n\t\t\t\temojiElement.dataset.emojiCode = emojiText;\n\t\t\t\temojiElement.src = this.$emo.textToUrl(emojiText);\n\n\t\t\t\tlet blurRange = this.blurRange;\n\t\t\t\tif (!blurRange) {\n\t\t\t\t\tthis.focus();\n\t\t\t\t\tthis.updateRange();\n\t\t\t\t\tblurRange = this.blurRange;\n\t\t\t\t}\n\t\t\t\tif (blurRange.startContainer !== blurRange.endContainer || blurRange.startOffset !== blurRange.endOffset) {\n\t\t\t\t\tblurRange.deleteContents();\n\t\t\t\t}\n\t\t\t\tblurRange.insertNode(emojiElement);\n\t\t\t\tblurRange.collapse()\n\n\t\t\t\tlet textNode = document.createTextNode('\\u00A0');\n\t\t\t\tblurRange.insertNode(textNode)\n\t\t\t\tblurRange.collapse()\n\n\t\t\t\tthis.selectElement(textNode);\n\t\t\t\tthis.updateRange();\n\t\t\t\tthis.isEmpty = false;\n\t\t\t},\n\t\t\tgenerateId() {\n\t\t\t\treturn this.currentId++;\n\t\t\t},\n\t\t\tcreateFile(filePush) {\n\t\t\t\tlet file = filePush.file;\n\t\t\t\tlet fileId = filePush.fileId;\n\t\t\t\tlet container = document.createElement('div');\n\t\t\t\tcontainer.className = 'chat-file-container no-text';\n\t\t\t\tcontainer.contentEditable = 'false';\n\t\t\t\tcontainer.dataset.fileId = fileId;\n\n\t\t\t\tlet left = document.createElement('div');\n\t\t\t\tleft.className = 'file-position-left';\n\t\t\t\tcontainer.appendChild(left);\n\n\t\t\t\tlet icon = document.createElement('div');\n\t\t\t\ticon.className = 'el-icon-document';\n\t\t\t\tleft.appendChild(icon);\n\n\t\t\t\tlet right = document.createElement('div');\n\t\t\t\tright.className = 'file-position-right';\n\t\t\t\tcontainer.appendChild(right);\n\n\t\t\t\tlet fileName = document.createElement('div');\n\t\t\t\tfileName.className = 'file-name';\n\t\t\t\tfileName.innerText = file.name;\n\n\t\t\t\tlet fileSize = document.createElement('div');\n\t\t\t\tfileSize.className = 'file-size';\n\t\t\t\tfileSize.innerText = this.sizeConvert(file.size);\n\n\t\t\t\tright.appendChild(fileName);\n\t\t\t\tright.appendChild(fileSize);\n\n\t\t\t\treturn container;\n\t\t\t},\n\t\t\tsizeConvert(len) {\n\t\t\t\tif (len < 1024) {\n\t\t\t\t\treturn len + 'B';\n\t\t\t\t} else if (len < 1024 * 1024) {\n\t\t\t\t\treturn (len / 1024).toFixed(2) + 'KB';\n\t\t\t\t} else if (len < 1024 * 1024 * 1024) {\n\t\t\t\t\treturn (len / 1024 / 1024).toFixed(2) + 'MB';\n\t\t\t\t} else {\n\t\t\t\t\treturn (len / 1024 / 1024 / 1024).toFixed(2) + 'GB';\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdateRange() {\n\t\t\t\tlet selection = window.getSelection();\n\t\t\t\tthis.blurRange = selection.getRangeAt(0);\n\t\t\t},\n\t\t\tnewLine() {\n\t\t\t\tlet selection = window.getSelection();\n\t\t\t\tlet range = selection.getRangeAt(0);\n\t\t\t\tlet divElement = document.createElement('div');\n\t\t\t\tlet endContainer = range.endContainer;\n\t\t\t\tlet parentElement = endContainer.parentElement;\n\t\t\t\tif (parentElement.parentElement === this.$refs.content) {\n\t\t\t\t\tdivElement.innerHTML  = endContainer.textContent.substring(range.endOffset).trim(); \n\t\t\t\t\tendContainer.textContent = endContainer.textContent.substring(0, range.endOffset);\n\t\t\t\t\t// 插入到当前div（当前行）后面\n\t\t\t\t\tparentElement.insertAdjacentElement('afterend', divElement);\n\t\t\t\t} else {\n\t\t\t\t\tdivElement.innerHTML = '';\n\t\t\t\t\tthis.$refs.content.append(divElement);\n\t\t\t\t}\n\t\t\t\treturn divElement;\n\t\t\t},\n\t\t\tclear() {\n\t\t\t\tthis.empty();\n\t\t\t\tthis.imageList = [];\n\t\t\t\tthis.fileList = [];\n\t\t\t},\n\t\t\tempty() {\n\t\t\t\tthis.$refs.content.innerHTML = \"\";\n\t\t\t\tlet line = this.newLine();\n\t\t\t\tlet after = document.createTextNode('\\u00A0');\n\t\t\t\tline.appendChild(after);\n\t\t\t\tthis.$nextTick(()=>this.selectElement(after));\n\t\t\t},\n\t\t\tshowAtBox(e) {\n\t\t\t\tthis.atIng = true;\n\t\t\t\t// show之后会自动更新当前搜索的text\n\t\t\t\t// this.atSearchText = \"\";\n\t\t\t\tlet selection = window.getSelection()\n\t\t\t\tlet range = selection.getRangeAt(0)\n\t\t\t\t// 光标所在坐标\n\t\t\t\tlet pos = range.getBoundingClientRect();\n\t\t\t\tthis.$refs.atBox.open({\n\t\t\t\t\tx: pos.x,\n\t\t\t\t\ty: pos.y\n\t\t\t\t})\n\t\t\t\t// 记录光标所在位置\n\t\t\t\tthis.updateRange();\n\t\t\t},\n\t\t\thtml2Escape(strHtml) {\n\t\t\t\treturn strHtml.replace(/[<>&\"]/g, function(c) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'<': '&lt;',\n\t\t\t\t\t\t'>': '&gt;',\n\t\t\t\t\t\t'&': '&amp;',\n\t\t\t\t\t\t'\"': '&quot;'\n\t\t\t\t\t} [c];\n\t\t\t\t});\n\t\t\t},\n\t\t\tsubmit() {\n\t\t\t\tlet nodes = this.$refs.content.childNodes;\n\t\t\t\tlet fullList = [];\n\t\t\t\tlet tempText = '';\n\t\t\t\tlet atUserIds = [];\n\t\t\t\tlet each = (nodes) => {\n\t\t\t\t\tfor (let i = 0; i < nodes.length; i++) {\n\t\t\t\t\t\tlet node = nodes[i];\n\t\t\t\t\t\tif (!node) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\t\ttempText += this.html2Escape(node.textContent);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet nodeName = node.nodeName.toLowerCase();\n\t\t\t\t\t\tif (nodeName === 'script') {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet text = tempText.trim();\n\t\t\t\t\t\tif (nodeName === 'img') {\n\t\t\t\t\t\t\tlet imgId = node.dataset.imgId;\n\t\t\t\t\t\t\tif (imgId) {\n\t\t\t\t\t\t\t\tif (text) {\n\t\t\t\t\t\t\t\t\tfullList.push({\n\t\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\t\tcontent: text,\n\t\t\t\t\t\t\t\t\t\tatUserIds: atUserIds\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\ttempText = '';\n\t\t\t\t\t\t\t\t\tatUserIds = []\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfullList.push({\n\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\tcontent: this.imageList[imgId]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlet emojiCode = node.dataset.emojiCode;\n\t\t\t\t\t\t\t\ttempText += emojiCode;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (nodeName === 'div') {\n\t\t\t\t\t\t\tlet fileId = node.dataset.fileId\n\t\t\t\t\t\t\t// 文件\n\t\t\t\t\t\t\tif (fileId) {\n\t\t\t\t\t\t\t\tif (text) {\n\t\t\t\t\t\t\t\t\tfullList.push({\n\t\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\t\tcontent: text,\n\t\t\t\t\t\t\t\t\t\tatUserIds: atUserIds\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\ttempText = '';\n\t\t\t\t\t\t\t\t\tatUserIds = []\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfullList.push({\n\t\t\t\t\t\t\t\t\ttype: 'file',\n\t\t\t\t\t\t\t\t\tcontent: this.fileList[fileId]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttempText += '\\n';\n\t\t\t\t\t\t\t\teach(node.childNodes);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (nodeName === 'span') {\n\t\t\t\t\t\t\tif(node.dataset.id){\n\t\t\t\t\t\t\t\ttempText += node.innerHTML;\n\t\t\t\t\t\t\t\tatUserIds.push(node.dataset.id)\n\t\t\t\t\t\t\t}else {\n\t\t\t\t\t\t\t\ttempText += node.outerHtml;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\teach(nodes)\n\t\t\t\tlet text = tempText.trim();\n\t\t\t\tif (text !== '') {\n\t\t\t\t\tfullList.push({\n\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\tcontent: text,\n\t\t\t\t\t\tatUserIds: atUserIds\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tthis.$emit('submit', fullList);\n\t\t\t},\n\t\t\tfocus() {\n\t\t\t\tthis.$refs.content.focus();\n\t\t\t}\n\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.chat-input-area {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tposition: relative;\n\n\t\t.edit-chat-container {\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\tbottom: 0;\n\t\t\tborder: 1px solid #c3c3c3;\n\t\t\toutline: none;\n\t\t\tpadding: 5px;\n\t\t\tline-height: 30px;\n\t\t\tfont-size: 16px;\n\t\t\ttext-align: left;\n\t\t\toverflow-y: scroll;\n\n\t\t\t// 单独一行时，无法在前面输入的bug\n\t\t\t>div:before {\n\t\t\t\tcontent: \"\\00a0\";\n\t\t\t\tfont-size: 14px;\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t}\n\n\t\t\t.chat-image {\n\t\t\t\tdisplay: block;\n\t\t\t\tmax-width: 200px;\n\t\t\t\tmax-height: 100px;\n\t\t\t\tborder: 1px solid #e6e6e6;\n\t\t\t\tcursor: pointer;\n\t\t\t}\n\n\t\t\t.chat-emoji {\n\t\t\t\twidth: 30px;\n\t\t\t\theight: 30px;\n\t\t\t\tvertical-align: top;\n\t\t\t\tcursor: pointer;\n\t\t\t}\n\n\t\t\t.chat-file-container {\n\t\t\t\tmax-width: 65%;\n\t\t\t\tpadding: 10px;\n\t\t\t\tborder: 2px solid #587ff0;\n\t\t\t\tdisplay: flex;\n\t\t\t\tbackground: #eeeC;\n\t\t\t\tborder-radius: 10px;\n\n\t\t\t\t.file-position-left {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\twidth: 80px;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\talign-items: center;\n\n\t\t\t\t\t.el-icon-document {\n\t\t\t\t\t\tfont-size: 40px;\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\tcolor: #d42e07;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t.file-position-right {\n\t\t\t\t\tflex: 1;\n\n\t\t\t\t\t.file-name {\n\t\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\t\tcolor: #66b1ff;\n\t\t\t\t\t}\n\n\t\t\t\t\t.file-size {\n\t\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\t\tcolor: black;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t.chat-at-user {\n\t\t\t\tcolor: #00f;\n\t\t\t\tfont-weight: 600;\n\n\t\t\t\tborder-radius: 3px;\n\t\t\t}\n\t\t}\n\n\t\t.edit-chat-container>div:nth-of-type(1):after {\n\t\t\tcontent: '请输入消息（按Ctrl+Enter键换行）';\n\t\t\tcolor: gray;\n\t\t}\n\n\t\t.edit-chat-container.not-empty>div:nth-of-type(1):after {\n\t\t\tcontent: none;\n\t\t}\n\n\t}\n</style>"]}]}